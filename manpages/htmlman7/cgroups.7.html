<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>cgroups(7) — Linux manual pages</title>
  <link rel="stylesheet" type="text/css" href="../stylesheet/manpages.css" />
  
  <link rel="home" href="../index.html" title="cgroups(7) — Linux manual pages" />
  <script type="text/javascript" src="../stylesheet/manpages.js" xml:space="preserve"> </script>
  <link rel="icon" href="../stylesheet/icon.gif" type="image/gif" />
</head>
<body onload="javascript:init()">
  <div class="navheader">
    <table width="100%">
      <tbody>
        <tr>
          <td style="width: 33%" rowspan="1" colspan="1"><a href="../index.html" shape="rect">Linux
          manual pages</a></td>
          <th rowspan="1" colspan="1"><a href="../index7.html" shape="rect">Section 7</a></th>
          <td style="width: 33%" rowspan="1" colspan="1"> </td>
        </tr>
      </tbody>
    </table>
    <hr />
  </div>
  <div class="refentry">
    <a id="cgroups.7" name="cgroups.7" shape="rect"> </a>
    <div class="titlepage"> </div>
    <div class="refnamediv">
      <h2>Name</h2>
      <p>cgroups — Linux control groups</p>
    </div>
    <div class="refsect1">
      <a id="cgroups-7_sect1" name="cgroups-7_sect1" shape="rect"> </a>
      <h2>DESCRIPTION</h2>
      <p>Control groups, usually referred to as cgroups, are a
      Linux kernel feature which allow processes to be organized
      into hierarchical groups whose usage of various types of
      resources can then be limited and monitored. The kernel's
      cgroup interface is provided through a pseudo-filesystem
      called cgroupfs. Grouping is implemented in the core cgroup
      kernel code, while resource tracking and limits are
      implemented in a set of per-resource-type subsystems (memory,
      CPU, and so on).</p>
      <div class="refsect2">
        <a id="cgroups-7_sect2" name="cgroups-7_sect2" shape="rect"> </a>
        <h3>Terminology</h3>
        <p>A <em class="replaceable"><code>cgroup</code></em> is a
        collection of processes that are bound to a set of limits
        or parameters defined via the cgroup filesystem.</p>
        <p>A <em class="replaceable"><code>subsystem</code></em> is
        a kernel component that modifies the behavior of the
        processes in a cgroup. Various subsystems have been
        implemented, making it possible to do things such as
        limiting the amount of CPU time and memory available to a
        cgroup, accounting for the CPU time used by a cgroup, and
        freezing and resuming execution of the processes in a
        cgroup. Subsystems are sometimes also known as <span class="emphasis"><em>resource controllers</em></span> (or simply,
        controllers).</p>
        <p>The cgroups for a controller are arranged in a
        <em class="replaceable"><code>hierarchy</code></em>. This
        hierarchy is defined by creating, removing, and renaming
        subdirectories within the cgroup filesystem. At each level
        of the hierarchy, attributes (e.g., limits) can be defined.
        The limits, control, and accounting provided by cgroups
        generally have effect throughout the subhierarchy
        underneath the cgroup where the attributes are defined.
        Thus, for example, the limits placed on a cgroup at a
        higher level in the hierarchy cannot be exceeded by
        descendant cgroups.</p>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect3" name="cgroups-7_sect3" shape="rect"> </a>
        <h3>Cgroups version 1 and version 2</h3>
        <p>The initial release of the cgroups implementation was in
        Linux 2.6.24. Over time, various cgroup controllers have
        been added to allow the management of various types of
        resources. However, the development of these controllers
        was largely uncoordinated, with the result that many
        inconsistencies arose between controllers and management of
        the cgroup hierarchies became rather complex. A longer
        description of these problems can be found in the kernel
        source file <code class="filename">Documentation/admin−guide/cgroup−v2.rst</code>
        (or <code class="filename">Documentation/cgroup−v2.txt</code> in
        Linux 4.17 and earlier).</p>
        <p>Because of the problems with the initial cgroups
        implementation (cgroups version 1), starting in Linux 3.10,
        work began on a new, orthogonal implementation to remedy
        these problems. Initially marked experimental, and hidden
        behind the <code class="option">−o
        __DEVEL__sane_behavior</code> mount option, the new version
        (cgroups version 2) was eventually made official with the
        release of Linux 4.5. Differences between the two versions
        are described in the text below. The file <em class="replaceable"><code>cgroup.sane_behavior</code></em>,
        present in cgroups v1, is a relic of this mount option. The
        file always reports "0" and is only retained for backward
        compatibility.</p>
        <p>Although cgroups v2 is intended as a replacement for
        cgroups v1, the older system continues to exist (and for
        compatibility reasons is unlikely to be removed).
        Currently, cgroups v2 implements only a subset of the
        controllers available in cgroups v1. The two systems are
        implemented so that both v1 controllers and v2 controllers
        can be mounted on the same system. Thus, for example, it is
        possible to use those controllers that are supported under
        version 2, while also using version 1 controllers where
        version 2 does not yet support those controllers. The only
        restriction here is that a controller can't be
        simultaneously employed in both a cgroups v1 hierarchy and
        in the cgroups v2 hierarchy.</p>
      </div>
    </div>
    <div class="refsect1">
      <a id="cgroups-7_sect4" name="cgroups-7_sect4" shape="rect"> </a>
      <h2>CGROUPS VERSION 1</h2>
      <p>Under cgroups v1, each controller may be mounted against a
      separate cgroup filesystem that provides its own hierarchical
      organization of the processes on the system. It is also
      possible to comount multiple (or even all) cgroups v1
      controllers against the same cgroup filesystem, meaning that
      the comounted controllers manage the same hierarchical
      organization of processes.</p>
      <p>For each mounted hierarchy, the directory tree mirrors the
      control group hierarchy. Each control group is represented by
      a directory, with each of its child control cgroups
      represented as a child directory. For instance, <code class="filename">/user/joe/1.session</code> represents control
      group <em class="replaceable"><code>1.session</code></em>,
      which is a child of cgroup <em class="replaceable"><code>joe</code></em>, which is a child of
      <code class="filename">/user</code>. Under each cgroup
      directory is a set of files which can be read or written to,
      reflecting resource limits and a few general cgroup
      properties.</p>
      <div class="refsect2">
        <a id="cgroups-7_sect5" name="cgroups-7_sect5" shape="rect"> </a>
        <h3>Tasks (threads) versus processes</h3>
        <p>In cgroups v1, a distinction is drawn between <em class="replaceable"><code>processes</code></em> and <em class="replaceable"><code>tasks</code></em>. In this view, a
        process can consist of multiple tasks (more commonly called
        threads, from a user-space perspective, and called such in
        the remainder of this man page). In cgroups v1, it is
        possible to independently manipulate the cgroup memberships
        of the threads in a process.</p>
        <p>The cgroups v1 ability to split threads across different
        cgroups caused problems in some cases. For example, it made
        no sense for the <em class="replaceable"><code>memory</code></em> controller, since
        all of the threads of a process share a single address
        space. Because of these problems, the ability to
        independently manipulate the cgroup memberships of the
        threads in a process was removed in the initial cgroups v2
        implementation, and subsequently restored in a more limited
        form (see the discussion of "thread mode" below).</p>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect6" name="cgroups-7_sect6" shape="rect"> </a>
        <h3>Mounting v1 controllers</h3>
        <p>The use of cgroups requires a kernel built with the
        <code class="constant">CONFIG_CGROUP</code> option. In
        addition, each of the v1 controllers has an associated
        configuration option that must be set in order to employ
        that controller.</p>
        <p>In order to use a v1 controller, it must be mounted
        against a cgroup filesystem. The usual place for such
        mounts is under a <a class="link" href="../htmlman5/tmpfs.5.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">tmpfs</span>(5)</span></a> filesystem
        mounted at <code class="filename">/sys/fs/cgroup</code>.
        Thus, one might mount the <em class="replaceable"><code>cpu</code></em> controller as
        follows:</p>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="informalexample">
              <pre class="programlisting" xml:space="preserve">
mount −t cgroup −o cpu none /sys/fs/cgroup/cpu
</pre>
            </div>
          </blockquote>
        </div>
        <p>It is possible to comount multiple controllers against
        the same hierarchy. For example, here the <em class="replaceable"><code>cpu</code></em> and <em class="replaceable"><code>cpuacct</code></em> controllers are
        comounted against a single hierarchy:</p>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="informalexample">
              <pre class="programlisting" xml:space="preserve">
mount −t cgroup −o cpu,cpuacct none /sys/fs/cgroup/cpu,cpuacct
</pre>
            </div>
          </blockquote>
        </div>
        <p>Comounting controllers has the effect that a process is
        in the same cgroup for all of the comounted controllers.
        Separately mounting controllers allows a process to be in
        cgroup <code class="filename">/foo1</code> for one
        controller while being in <code class="filename">/foo2/foo3</code> for another.</p>
        <p>It is possible to comount all v1 controllers against the
        same hierarchy:</p>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="informalexample">
              <pre class="programlisting" xml:space="preserve">
mount −t cgroup −o all cgroup /sys/fs/cgroup
</pre>
            </div>
          </blockquote>
        </div>
        <p>(One can achieve the same result by omitting
        <code class="option">−o all</code>, since it is the
        default if no controllers are explicitly specified.)</p>
        <p>It is not possible to mount the same controller against
        multiple cgroup hierarchies. For example, it is not
        possible to mount both the <em class="replaceable"><code>cpu</code></em> and <em class="replaceable"><code>cpuacct</code></em> controllers against
        one hierarchy, and to mount the <em class="replaceable"><code>cpu</code></em> controller alone
        against another hierarchy. It is possible to create
        multiple mount points with exactly the same set of
        comounted controllers. However, in this case all that
        results is multiple mount points providing a view of the
        same hierarchy.</p>
        <p>Note that on many systems, the v1 controllers are
        automatically mounted under <code class="filename">/sys/fs/cgroup</code>; in particular,
        <span class="citerefentry"><span class="refentrytitle">systemd</span>(1)</span> automatically
        creates such mount points.</p>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect7" name="cgroups-7_sect7" shape="rect"> </a>
        <h3>Unmounting v1 controllers</h3>
        <p>A mounted cgroup filesystem can be unmounted using the
        <a class="link" href="../htmlman8/umount.8.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">umount</span>(8)</span></a> command, as in
        the following example:</p>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="informalexample">
              <pre class="programlisting" xml:space="preserve">
umount /sys/fs/cgroup/pids
</pre>
            </div>
          </blockquote>
        </div>
        <p><span class="emphasis"><em>But note well</em></span>: a
        cgroup filesystem is unmounted only if it is not busy, that
        is, it has no child cgroups. If this is not the case, then
        the only effect of the <a class="link" href="../htmlman8/umount.8.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">umount</span>(8)</span></a> is to make the
        mount invisible. Thus, to ensure that the mount point is
        really removed, one must first remove all child cgroups,
        which in turn can be done only after all member processes
        have been moved from those cgroups to the root cgroup.</p>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect8" name="cgroups-7_sect8" shape="rect"> </a>
        <h3>Cgroups version 1 controllers</h3>
        <p>Each of the cgroups version 1 controllers is governed by
        a kernel configuration option (listed below). Additionally,
        the availability of the cgroups feature is governed by the
        <code class="constant">CONFIG_CGROUPS</code> kernel
        configuration option.</p>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><em class="replaceable"><code>cpu</code></em> (since Linux
            2.6.24; <em class="replaceable"><code><code class="constant">CONFIG_CGROUP_SCHED</code></code></em>)</span></dt>
            <dd>
              <p>Cgroups can be guaranteed a minimum number of "CPU
              shares" when a system is busy. This does not limit a
              cgroup's CPU usage if the CPUs are not busy. For
              further information, see <code class="filename">Documentation/scheduler/sched−design−CFS.rst</code>
              (or <code class="filename">Documentation/scheduler/sched−design−CFS.txt</code>
              in Linux 5.2 and earlier).</p>
              <p>In Linux 3.2, this controller was extended to
              provide CPU "bandwidth" control. If the kernel is
              configured with <code class="constant">CONFIG_CFS_BANDWIDTH</code>, then within
              each scheduling period (defined via a file in the
              cgroup directory), it is possible to define an upper
              limit on the CPU time allocated to the processes in a
              cgroup. This upper limit applies even if there is no
              other competition for the CPU. Further information
              can be found in the kernel source file <code class="filename">Documentation/scheduler/sched−bwc.rst</code>
              (or <code class="filename">Documentation/scheduler/sched−bwc.txt</code>
              in Linux 5.2 and earlier).</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>cpuacct</code></em> (since Linux
            2.6.24; <em class="replaceable"><code><code class="constant">CONFIG_CGROUP_CPUACCT</code></code></em>)</span></dt>
            <dd>
              <p>This provides accounting for CPU usage by groups
              of processes.</p>
              <p>Further information can be found in the kernel
              source file <code class="filename">Documentation/admin−guide/cgroup−v1/cpuacct.rst</code>
              (or <code class="filename">Documentation/cgroup−v1/cpuacct.txt</code>
              in Linux 5.2 and earlier).</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>cpuset</code></em> (since Linux
            2.6.24; <em class="replaceable"><code><code class="constant">CONFIG_CPUSETS</code></code></em>)</span></dt>
            <dd>
              <p>This cgroup can be used to bind the processes in a
              cgroup to a specified set of CPUs and NUMA nodes.</p>
              <p>Further information can be found in the kernel
              source file <code class="filename">Documentation/admin−guide/cgroup−v1/cpusets.rst</code>
              (or <code class="filename">Documentation/cgroup−v1/cpusets.txt</code>
              in Linux 5.2 and earlier).</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>memory</code></em> (since Linux
            2.6.25; <em class="replaceable"><code><code class="constant">CONFIG_MEMCG</code></code></em>)</span></dt>
            <dd>
              <p>The memory controller supports reporting and
              limiting of process memory, kernel memory, and swap
              used by cgroups.</p>
              <p>Further information can be found in the kernel
              source file <code class="filename">Documentation/admin−guide/cgroup−v1/memory.rst</code>
              (or <code class="filename">Documentation/cgroup−v1/memory.txt</code>
              in Linux 5.2 and earlier).</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>devices</code></em> (since Linux
            2.6.26; <em class="replaceable"><code><code class="constant">CONFIG_CGROUP_DEVICE</code></code></em>)</span></dt>
            <dd>
              <p>This supports controlling which processes may
              create (mknod) devices as well as open them for
              reading or writing. The policies may be specified as
              allow-lists and deny-lists. Hierarchy is enforced, so
              new rules must not violate existing rules for the
              target or ancestor cgroups.</p>
              <p>Further information can be found in the kernel
              source file <code class="filename">Documentation/admin−guide/cgroup−v1/devices.rst</code>
              (or <code class="filename">Documentation/cgroup−v1/devices.txt</code>
              in Linux 5.2 and earlier).</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>freezer</code></em> (since Linux
            2.6.28; <em class="replaceable"><code><code class="constant">CONFIG_CGROUP_FREEZER</code></code></em>)</span></dt>
            <dd>
              <p>The <em class="replaceable"><code>freezer</code></em> cgroup can
              suspend and restore (resume) all processes in a
              cgroup. Freezing a cgroup <code class="filename">/A</code> also causes its children, for
              example, processes in <code class="filename">/A/B</code>, to be frozen.</p>
              <p>Further information can be found in the kernel
              source file <code class="filename">Documentation/admin−guide/cgroup−v1/freezer−subsystem.rst</code>
              (or <code class="filename">Documentation/cgroup−v1/freezer−subsystem.txt</code>
              in Linux 5.2 and earlier).</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>net_cls</code></em> (since Linux
            2.6.29; <em class="replaceable"><code><code class="constant">CONFIG_CGROUP_NET_CLASSID</code></code></em>)</span></dt>
            <dd>
              <p>This places a classid, specified for the cgroup,
              on network packets created by a cgroup. These
              classids can then be used in firewall rules, as well
              as used to shape traffic using <span class="citerefentry"><span class="refentrytitle">tc</span>(8)</span>. This applies
              only to packets leaving the cgroup, not to traffic
              arriving at the cgroup.</p>
              <p>Further information can be found in the kernel
              source file <code class="filename">Documentation/admin−guide/cgroup−v1/net_cls.rst</code>
              (or <code class="filename">Documentation/cgroup−v1/net_cls.txt</code>
              in Linux 5.2 and earlier).</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>blkio</code></em> (since Linux
            2.6.33; <em class="replaceable"><code><code class="constant">CONFIG_BLK_CGROUP</code></code></em>)</span></dt>
            <dd>
              <p>The <em class="replaceable"><code>blkio</code></em> cgroup controls
              and limits access to specified block devices by
              applying IO control in the form of throttling and
              upper limits against leaf nodes and intermediate
              nodes in the storage hierarchy.</p>
              <p>Two policies are available. The first is a
              proportional-weight time-based division of disk
              implemented with CFQ. This is in effect for leaf
              nodes using CFQ. The second is a throttling policy
              which specifies upper I/O rate limits on a
              device.</p>
              <p>Further information can be found in the kernel
              source file <code class="filename">Documentation/admin−guide/cgroup−v1/blkio−controller.rst</code>
              (or <code class="filename">Documentation/cgroup−v1/blkio−controller.txt</code>
              in Linux 5.2 and earlier).</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>perf_event</code></em> (since Linux
            2.6.39; <em class="replaceable"><code><code class="constant">CONFIG_CGROUP_PERF</code></code></em>)</span></dt>
            <dd>
              <p>This controller allows <em class="replaceable"><code>perf</code></em> monitoring of
              the set of processes grouped in a cgroup.</p>
              <p>Further information can be found in the kernel
              source files</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>net_prio</code></em> (since Linux
            3.3; <em class="replaceable"><code><code class="constant">CONFIG_CGROUP_NET_PRIO</code></code></em>)</span></dt>
            <dd>
              <p>This allows priorities to be specified, per
              network interface, for cgroups.</p>
              <p>Further information can be found in the kernel
              source file <code class="filename">Documentation/admin−guide/cgroup−v1/net_prio.rst</code>
              (or <code class="filename">Documentation/cgroup−v1/net_prio.txt</code>
              in Linux 5.2 and earlier).</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>hugetlb</code></em> (since Linux
            3.5; <em class="replaceable"><code><code class="constant">CONFIG_CGROUP_HUGETLB</code></code></em>)</span></dt>
            <dd>
              <p>This supports limiting the use of huge pages by
              cgroups.</p>
              <p>Further information can be found in the kernel
              source file <code class="filename">Documentation/admin−guide/cgroup−v1/hugetlb.rst</code>
              (or <code class="filename">Documentation/cgroup−v1/hugetlb.txt</code>
              in Linux 5.2 and earlier).</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>pids</code></em> (since Linux 4.3;
            <em class="replaceable"><code><code class="constant">CONFIG_CGROUP_PIDS</code></code></em>)</span></dt>
            <dd>
              <p>This controller permits limiting the number of
              process that may be created in a cgroup (and its
              descendants).</p>
              <p>Further information can be found in the kernel
              source file <code class="filename">Documentation/admin−guide/cgroup−v1/pids.rst</code>
              (or <code class="filename">Documentation/cgroup−v1/pids.txt</code>
              in Linux 5.2 and earlier).</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>rdma</code></em> (since Linux 4.11;
            <em class="replaceable"><code><code class="constant">CONFIG_CGROUP_RDMA</code></code></em>)</span></dt>
            <dd>
              <p>The RDMA controller permits limiting the use of
              RDMA/IB-specific resources per cgroup.</p>
              <p>Further information can be found in the kernel
              source file <code class="filename">Documentation/admin−guide/cgroup−v1/rdma.rst</code>
              (or <code class="filename">Documentation/cgroup−v1/rdma.txt</code>
              in Linux 5.2 and earlier).</p>
            </dd>
          </dl>
        </div>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect9" name="cgroups-7_sect9" shape="rect"> </a>
        <h3>Creating cgroups and moving processes</h3>
        <p>A cgroup filesystem initially contains a single root
        cgroup, '/', which all processes belong to. A new cgroup is
        created by creating a directory in the cgroup
        filesystem:</p>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="informalexample">
              <pre class="programlisting" xml:space="preserve">
mkdir /sys/fs/cgroup/cpu/cg1
</pre>
            </div>
          </blockquote>
        </div>
        <p>This creates a new empty cgroup.</p>
        <p>A process may be moved to this cgroup by writing its PID
        into the cgroup's <em class="replaceable"><code>cgroup.procs</code></em> file:</p>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="informalexample">
              <pre class="programlisting" xml:space="preserve">
echo $$ &gt; /sys/fs/cgroup/cpu/cg1/cgroup.procs
</pre>
            </div>
          </blockquote>
        </div>
        <p>Only one PID at a time should be written to this
        file.</p>
        <p>Writing the value 0 to a <em class="replaceable"><code>cgroup.procs</code></em> file causes
        the writing process to be moved to the corresponding
        cgroup.</p>
        <p>When writing a PID into the <em class="replaceable"><code>cgroup.procs</code></em>, all threads
        in the process are moved into the new cgroup at once.</p>
        <p>Within a hierarchy, a process can be a member of exactly
        one cgroup. Writing a process's PID to a <em class="replaceable"><code>cgroup.procs</code></em> file
        automatically removes it from the cgroup of which it was
        previously a member.</p>
        <p>The <em class="replaceable"><code>cgroup.procs</code></em> file can be
        read to obtain a list of the processes that are members of
        a cgroup. The returned list of PIDs is not guaranteed to be
        in order. Nor is it guaranteed to be free of duplicates.
        (For example, a PID may be recycled while reading from the
        list.)</p>
        <p>In cgroups v1, an individual thread can be moved to
        another cgroup by writing its thread ID (i.e., the kernel
        thread ID returned by <a class="link" href="../htmlman2/clone.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">clone</span>(2)</span></a> and <a class="link" href="../htmlman2/gettid.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">gettid</span>(2)</span></a>) to the
        <em class="replaceable"><code>tasks</code></em> file in a
        cgroup directory. This file can be read to discover the set
        of threads that are members of the cgroup.</p>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect10" name="cgroups-7_sect10" shape="rect"> </a>
        <h3>Removing cgroups</h3>
        <p>To remove a cgroup, it must first have no child cgroups
        and contain no (nonzombie) processes. So long as that is
        the case, one can simply remove the corresponding directory
        pathname. Note that files in a cgroup directory cannot and
        need not be removed.</p>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect11" name="cgroups-7_sect11" shape="rect"> </a>
        <h3>Cgroups v1 release notification</h3>
        <p>Two files can be used to determine whether the kernel
        provides notifications when a cgroup becomes empty. A
        cgroup is considered to be empty when it contains no child
        cgroups and no member processes.</p>
        <p>A special file in the root directory of each cgroup
        hierarchy, <em class="replaceable"><code>release_agent</code></em>, can be used
        to register the pathname of a program that may be invoked
        when a cgroup in the hierarchy becomes empty. The pathname
        of the newly empty cgroup (relative to the cgroup mount
        point) is provided as the sole command-line argument when
        the <em class="replaceable"><code>release_agent</code></em>
        program is invoked. The <em class="replaceable"><code>release_agent</code></em> program might
        remove the cgroup directory, or perhaps repopulate it with
        a process.</p>
        <p>The default value of the <em class="replaceable"><code>release_agent</code></em> file is
        empty, meaning that no release agent is invoked.</p>
        <p>The content of the <em class="replaceable"><code>release_agent</code></em> file can also
        be specified via a mount option when the cgroup filesystem
        is mounted:</p>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="informalexample">
              <pre class="programlisting" xml:space="preserve">
mount −o release_agent=pathname ...
</pre>
            </div>
          </blockquote>
        </div>
        <p>Whether or not the <em class="replaceable"><code>release_agent</code></em> program is
        invoked when a particular cgroup becomes empty is
        determined by the value in the <em class="replaceable"><code>notify_on_release</code></em> file in
        the corresponding cgroup directory. If this file contains
        the value 0, then the <em class="replaceable"><code>release_agent</code></em> program is
        not invoked. If it contains the value 1, the <em class="replaceable"><code>release_agent</code></em> program is
        invoked. The default value for this file in the root cgroup
        is 0. At the time when a new cgroup is created, the value
        in this file is inherited from the corresponding file in
        the parent cgroup.</p>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect12" name="cgroups-7_sect12" shape="rect"> </a>
        <h3>Cgroup v1 named hierarchies</h3>
        <p>In cgroups v1, it is possible to mount a cgroup
        hierarchy that has no attached controllers:</p>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="informalexample">
              <pre class="programlisting" xml:space="preserve">
mount −t cgroup −o none,name=somename none /some/mount/point
</pre>
            </div>
          </blockquote>
        </div>
        <p>Multiple instances of such hierarchies can be mounted;
        each hierarchy must have a unique name. The only purpose of
        such hierarchies is to track processes. (See the discussion
        of release notification below.) An example of this is the
        <em class="replaceable"><code>name=systemd</code></em>
        cgroup hierarchy that is used by <span class="citerefentry"><span class="refentrytitle">systemd</span>(1)</span> to track services
        and user sessions.</p>
        <p>Since Linux 5.0, the <em class="replaceable"><code>cgroup_no_v1</code></em> kernel boot
        option (described below) can be used to disable cgroup v1
        named hierarchies, by specifying <em class="replaceable"><code>cgroup_no_v1=named</code></em>.</p>
      </div>
    </div>
    <div class="refsect1">
      <a id="cgroups-7_sect13" name="cgroups-7_sect13" shape="rect"> </a>
      <h2>CGROUPS VERSION 2</h2>
      <p>In cgroups v2, all mounted controllers reside in a single
      unified hierarchy. While (different) controllers may be
      simultaneously mounted under the v1 and v2 hierarchies, it is
      not possible to mount the same controller simultaneously
      under both the v1 and the v2 hierarchies.</p>
      <p>The new behaviors in cgroups v2 are summarized here, and
      in some cases elaborated in the following subsections.</p>
      <div class="orderedlist">
        <ol class="orderedlist" type="1">
          <li class="listitem">
            <p>Cgroups v2 provides a unified hierarchy against
            which all controllers are mounted.</p>
          </li>
          <li class="listitem">
            <p>"Internal" processes are not permitted. With the
            exception of the root cgroup, processes may reside only
            in leaf nodes (cgroups that do not themselves contain
            child cgroups). The details are somewhat more subtle
            than this, and are described below.</p>
          </li>
          <li class="listitem">
            <p>Active cgroups must be specified via the files
            <em class="replaceable"><code>cgroup.controllers</code></em> and
            <em class="replaceable"><code>cgroup.subtree_control</code></em>.</p>
          </li>
          <li class="listitem">
            <p>The <em class="replaceable"><code>tasks</code></em>
            file has been removed. In addition, the <em class="replaceable"><code>cgroup.clone_children</code></em>
            file that is employed by the <em class="replaceable"><code>cpuset</code></em> controller has
            been removed.</p>
          </li>
          <li class="listitem">
            <p>An improved mechanism for notification of empty
            cgroups is provided by the <em class="replaceable"><code>cgroup.events</code></em> file.</p>
          </li>
        </ol>
      </div>
      <p>For more changes, see the <code class="filename">Documentation/admin−guide/cgroup−v2.rst</code>
      file in the kernel source (or <code class="filename">Documentation/cgroup−v2.txt</code> in Linux
      4.17 and earlier).</p>
      <p>Some of the new behaviors listed above saw subsequent
      modification with the addition in Linux 4.14 of "thread mode"
      (described below).</p>
      <div class="refsect2">
        <a id="cgroups-7_sect14" name="cgroups-7_sect14" shape="rect"> </a>
        <h3>Cgroups v2 unified hierarchy</h3>
        <p>In cgroups v1, the ability to mount different
        controllers against different hierarchies was intended to
        allow great flexibility for application design. In
        practice, though, the flexibility turned out to be less
        useful than expected, and in many cases added complexity.
        Therefore, in cgroups v2, all available controllers are
        mounted against a single hierarchy. The available
        controllers are automatically mounted, meaning that it is
        not necessary (or possible) to specify the controllers when
        mounting the cgroup v2 filesystem using a command such as
        the following:</p>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="informalexample">
              <pre class="programlisting" xml:space="preserve">
mount −t cgroup2 none /mnt/cgroup2
</pre>
            </div>
          </blockquote>
        </div>
        <p>A cgroup v2 controller is available only if it is not
        currently in use via a mount against a cgroup v1 hierarchy.
        Or, to put things another way, it is not possible to employ
        the same controller against both a v1 hierarchy and the
        unified v2 hierarchy. This means that it may be necessary
        first to unmount a v1 controller (as described above)
        before that controller is available in v2. Since
        <span class="citerefentry"><span class="refentrytitle">systemd</span>(1)</span> makes heavy use of
        some v1 controllers by default, it can in some cases be
        simpler to boot the system with selected v1 controllers
        disabled. To do this, specify the <em class="replaceable"><code>cgroup_no_v1=list</code></em> option on
        the kernel boot command line; <em class="replaceable"><code>list</code></em> is a comma-separated
        list of the names of the controllers to disable, or the
        word <em class="replaceable"><code>all</code></em> to
        disable all v1 controllers. (This situation is correctly
        handled by <span class="citerefentry"><span class="refentrytitle">systemd</span>(1)</span>, which falls back
        to operating without the specified controllers.)</p>
        <p>Note that on many modern systems, <span class="citerefentry"><span class="refentrytitle">systemd</span>(1)</span> automatically
        mounts the <em class="replaceable"><code>cgroup2</code></em> filesystem at
        <code class="filename">/sys/fs/cgroup/unified</code> during
        the boot process.</p>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect15" name="cgroups-7_sect15" shape="rect"> </a>
        <h3>Cgroups v2 mount options</h3>
        <p>The following options (<span class="emphasis"><em>mount
        −o</em></span>) can be specified when mounting the
        group v2 filesystem:</p>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><em class="replaceable"><code>nsdelegate</code></em> (since Linux
            4.15)</span></dt>
            <dd>
              <p>Treat cgroup namespaces as delegation boundaries.
              For details, see below.</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>memory_localevents</code></em>
            (since Linux 5.2)</span></dt>
            <dd>
              <p>The <em class="replaceable"><code>memory.events</code></em> should
              show statistics only for the cgroup itself, and not
              for any descendant cgroups. This was the behavior
              before Linux 5.2. Starting in Linux 5.2, the default
              behavior is to include statistics for descendant
              cgroups in <em class="replaceable"><code>memory.events</code></em>, and
              this mount option can be used to revert to the legacy
              behavior. This option is system wide and can be set
              on mount or modified through remount only from the
              initial mount namespace; it is silently ignored in
              noninitial namespaces.</p>
            </dd>
          </dl>
        </div>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect16" name="cgroups-7_sect16" shape="rect"> </a>
        <h3>Cgroups v2 controllers</h3>
        <p>The following controllers, documented in the kernel
        source file <code class="filename">Documentation/admin−guide/cgroup−v2.rst</code>
        (or <code class="filename">Documentation/cgroup−v2.txt</code> in
        Linux 4.17 and earlier), are supported in cgroups version
        2:</p>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><em class="replaceable"><code>cpu</code></em> (since Linux
            4.15)</span></dt>
            <dd>
              <p>This is the successor to the version 1 <em class="replaceable"><code>cpu</code></em> and <em class="replaceable"><code>cpuacct</code></em>
              controllers.</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>cpuset</code></em> (since Linux
            5.0)</span></dt>
            <dd>
              <p>This is the successor of the version 1 <em class="replaceable"><code>cpuset</code></em>
              controller.</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>freezer</code></em> (since Linux
            5.2)</span></dt>
            <dd>
              <p>This is the successor of the version 1 <em class="replaceable"><code>freezer</code></em>
              controller.</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>hugetlb</code></em> (since Linux
            5.6)</span></dt>
            <dd>
              <p>This is the successor of the version 1 <em class="replaceable"><code>hugetlb</code></em>
              controller.</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>io</code></em> (since Linux
            4.5)</span></dt>
            <dd>
              <p>This is the successor of the version 1 <em class="replaceable"><code>blkio</code></em> controller.</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>memory</code></em> (since Linux
            4.5)</span></dt>
            <dd>
              <p>This is the successor of the version 1 <em class="replaceable"><code>memory</code></em>
              controller.</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>perf_event</code></em> (since Linux
            4.11)</span></dt>
            <dd>
              <p>This is the same as the version 1 <em class="replaceable"><code>perf_event</code></em>
              controller.</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>pids</code></em> (since Linux
            4.5)</span></dt>
            <dd>
              <p>This is the same as the version 1 <em class="replaceable"><code>pids</code></em> controller.</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>rdma</code></em> (since Linux
            4.11)</span></dt>
            <dd>
              <p>This is the same as the version 1 <em class="replaceable"><code>rdma</code></em> controller.</p>
            </dd>
          </dl>
        </div>
        <p>There is no direct equivalent of the <em class="replaceable"><code>net_cls</code></em> and <em class="replaceable"><code>net_prio</code></em> controllers from
        cgroups version 1. Instead, support has been added to
        <span class="citerefentry"><span class="refentrytitle">iptables</span>(8)</span> to allow eBPF
        filters that hook on cgroup v2 pathnames to make decisions
        about network traffic on a per-cgroup basis.</p>
        <p>The v2 <em class="replaceable"><code>devices</code></em>
        controller provides no interface files; instead, device
        control is gated by attaching an eBPF (<code class="constant">BPF_CGROUP_DEVICE</code>) program to a v2
        cgroup.</p>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect17" name="cgroups-7_sect17" shape="rect"> </a>
        <h3>Cgroups v2 subtree control</h3>
        <p>Each cgroup in the v2 hierarchy contains the following
        two files:</p>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><em class="replaceable"><code>cgroup.controllers</code></em></span></dt>
            <dd>
              <p>This read-only file exposes a list of the
              controllers that are <em class="replaceable"><code>available</code></em> in this
              cgroup. The contents of this file match the contents
              of the <em class="replaceable"><code>cgroup.subtree_control</code></em>
              file in the parent cgroup.</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>cgroup.subtree_control</code></em></span></dt>
            <dd>
              <p>This is a list of controllers that are <em class="replaceable"><code>active</code></em> (<em class="replaceable"><code>enabled</code></em>) in the
              cgroup. The set of controllers in this file is a
              subset of the set in the <em class="replaceable"><code>cgroup.controllers</code></em> of
              this cgroup. The set of active controllers is
              modified by writing strings to this file containing
              space-delimited controller names, each preceded by
              '+' (to enable a controller) or '−' (to disable
              a controller), as in the following example:</p>
              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="informalexample">
                    <pre class="programlisting" xml:space="preserve">
echo '+pids −memory' &gt; x/y/cgroup.subtree_control
</pre>
                  </div>
                </blockquote>
              </div>
              <p>An attempt to enable a controller that is not
              present in <em class="replaceable"><code>cgroup.controllers</code></em>
              leads to an <span class="errorname">ENOENT</span>
              error when writing to the <em class="replaceable"><code>cgroup.subtree_control</code></em>
              file.</p>
            </dd>
          </dl>
        </div>
        <p>Because the list of controllers in <em class="replaceable"><code>cgroup.subtree_control</code></em> is a
        subset of those <em class="replaceable"><code>cgroup.controllers</code></em>, a
        controller that has been disabled in one cgroup in the
        hierarchy can never be re-enabled in the subtree below that
        cgroup.</p>
        <p>A cgroup's <em class="replaceable"><code>cgroup.subtree_control</code></em> file
        determines the set of controllers that are exercised in the
        <em class="replaceable"><code>child</code></em> cgroups.
        When a controller (e.g., <em class="replaceable"><code>pids</code></em>) is present in the
        <em class="replaceable"><code>cgroup.subtree_control</code></em> file
        of a parent cgroup, then the corresponding
        controller-interface files (e.g., <em class="replaceable"><code>pids.max</code></em>) are automatically
        created in the children of that cgroup and can be used to
        exert resource control in the child cgroups.</p>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect18" name="cgroups-7_sect18" shape="rect"> </a>
        <h3>Cgroups v2 "no internal processes" rule</h3>
        <p>Cgroups v2 enforces a so-called "no internal processes"
        rule. Roughly speaking, this rule means that, with the
        exception of the root cgroup, processes may reside only in
        leaf nodes (cgroups that do not themselves contain child
        cgroups). This avoids the need to decide how to partition
        resources between processes which are members of cgroup A
        and processes in child cgroups of A.</p>
        <p>For instance, if cgroup <code class="filename">/cg1/cg2</code> exists, then a process may
        reside in <code class="filename">/cg1/cg2</code>, but not
        in <code class="filename">/cg1</code>. This is to avoid an
        ambiguity in cgroups v1 with respect to the delegation of
        resources between processes in <code class="filename">/cg1</code> and its child cgroups. The
        recommended approach in cgroups v2 is to create a
        subdirectory called <em class="replaceable"><code>leaf</code></em> for any nonleaf cgroup
        which should contain processes, but no child cgroups. Thus,
        processes which previously would have gone into
        <code class="filename">/cg1</code> would now go into
        <code class="filename">/cg1/leaf</code>. This has the
        advantage of making explicit the relationship between
        processes in <code class="filename">/cg1/leaf</code> and
        <code class="filename">/cg1</code>'s other children.</p>
        <p>The "no internal processes" rule is in fact more subtle
        than stated above. More precisely, the rule is that a
        (nonroot) cgroup can't both (1) have member processes, and
        (2) distribute resources into child cgroups—that is,
        have a nonempty <em class="replaceable"><code>cgroup.subtree_control</code></em>
        file. Thus, it <em class="replaceable"><code>is</code></em>
        possible for a cgroup to have both member processes and
        child cgroups, but before controllers can be enabled for
        that cgroup, the member processes must be moved out of the
        cgroup (e.g., perhaps into the child cgroups).</p>
        <p>With the Linux 4.14 addition of "thread mode" (described
        below), the "no internal processes" rule has been relaxed
        in some cases.</p>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect19" name="cgroups-7_sect19" shape="rect"> </a>
        <h3>Cgroups v2 cgroup.events file</h3>
        <p>Each nonroot cgroup in the v2 hierarchy contains a
        read-only file, <em class="replaceable"><code>cgroup.events</code></em>, whose
        contents are key-value pairs (delimited by newline
        characters, with the key and value separated by spaces)
        providing state information about the cgroup:</p>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="informalexample">
              <pre class="programlisting" xml:space="preserve">
$ <span class="emphasis"><em>cat mygrp/cgroup.events</em></span>
populated 1
frozen 0
</pre>
            </div>
          </blockquote>
        </div>
        <p>The following keys may appear in this file:</p>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><em class="replaceable"><code>populated</code></em></span></dt>
            <dd>
              <p>The value of this key is either 1, if this cgroup
              or any of its descendants has member processes, or
              otherwise 0.</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>frozen</code></em> (since Linux
            5.2)</span></dt>
            <dd>
              <p>The value of this key is 1 if this cgroup is
              currently frozen, or 0 if it is not.</p>
            </dd>
          </dl>
        </div>
        <p>The <em class="replaceable"><code>cgroup.events</code></em> file can be
        monitored, in order to receive notification when the value
        of one of its keys changes. Such monitoring can be done
        using <a class="link" href="../htmlman7/inotify.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">inotify</span>(7)</span></a>, which
        notifies changes as <code class="constant">IN_MODIFY</code>
        events, or <a class="link" href="../htmlman2/poll.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">poll</span>(2)</span></a>, which notifies
        changes by returning the <code class="constant">POLLPRI</code> and <code class="constant">POLLERR</code> bits in the <em class="replaceable"><code>revents</code></em> field.</p>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect20" name="cgroups-7_sect20" shape="rect"> </a>
        <h3>Cgroup v2 release notification</h3>
        <p>Cgroups v2 provides a new mechanism for obtaining
        notification when a cgroup becomes empty. The cgroups v1
        <em class="replaceable"><code>release_agent</code></em> and
        <em class="replaceable"><code>notify_on_release</code></em>
        files are removed, and replaced by the <em class="replaceable"><code>populated</code></em> key in the
        <em class="replaceable"><code>cgroup.events</code></em>
        file. This key either has the value 0, meaning that the
        cgroup (and its descendants) contain no (nonzombie) member
        processes, or 1, meaning that the cgroup (or one of its
        descendants) contains member processes.</p>
        <p>The cgroups v2 release-notification mechanism offers the
        following advantages over the cgroups v1 <em class="replaceable"><code>release_agent</code></em>
        mechanism:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc;">
            <li class="listitem">
              <p>It allows for cheaper notification, since a single
              process can monitor multiple <em class="replaceable"><code>cgroup.events</code></em> files
              (using the techniques described earlier). By
              contrast, the cgroups v1 mechanism requires the
              expense of creating a process for each
              notification.</p>
            </li>
            <li class="listitem">
              <p>Notification for different cgroup subhierarchies
              can be delegated to different processes. By contrast,
              the cgroups v1 mechanism allows only one release
              agent for an entire hierarchy.</p>
            </li>
          </ul>
        </div>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect21" name="cgroups-7_sect21" shape="rect"> </a>
        <h3>Cgroups v2 cgroup.stat file</h3>
        <p>Each cgroup in the v2 hierarchy contains a read-only
        <em class="replaceable"><code>cgroup.stat</code></em> file
        (first introduced in Linux 4.14) that consists of lines
        containing key-value pairs. The following keys currently
        appear in this file:</p>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><em class="replaceable"><code>nr_descendants</code></em></span></dt>
            <dd>
              <p>This is the total number of visible (i.e., living)
              descendant cgroups underneath this cgroup.</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>nr_dying_descendants</code></em></span></dt>
            <dd>
              <p>This is the total number of dying descendant
              cgroups underneath this cgroup. A cgroup enters the
              dying state after being deleted. It remains in that
              state for an undefined period (which will depend on
              system load) while resources are freed before the
              cgroup is destroyed. Note that the presence of some
              cgroups in the dying state is normal, and is not
              indicative of any problem.</p>
              <p>A process can't be made a member of a dying
              cgroup, and a dying cgroup can't be brought back to
              life.</p>
            </dd>
          </dl>
        </div>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect22" name="cgroups-7_sect22" shape="rect"> </a>
        <h3>Limiting the number of descendant cgroups</h3>
        <p>Each cgroup in the v2 hierarchy contains the following
        files, which can be used to view and set limits on the
        number of descendant cgroups under that cgroup:</p>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><em class="replaceable"><code>cgroup.max.depth</code></em> (since
            Linux 4.14)</span></dt>
            <dd>
              <p>This file defines a limit on the depth of nesting
              of descendant cgroups. A value of 0 in this file
              means that no descendant cgroups can be created. An
              attempt to create a descendant whose nesting level
              exceeds the limit fails (<a class="link" href="../htmlman2/mkdir.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mkdir</span>(2)</span></a> fails with
              the error <span class="errorname">EAGAIN</span>).</p>
              <p>Writing the string <em class="replaceable"><code>"max"</code></em> to this file
              means that no limit is imposed. The default value in
              this file is <em class="replaceable"><code>"max"</code></em>.</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>cgroup.max.descendants</code></em>
            (since Linux 4.14)</span></dt>
            <dd>
              <p>This file defines a limit on the number of live
              descendant cgroups that this cgroup may have. An
              attempt to create more descendants than allowed by
              the limit fails (<a class="link" href="../htmlman2/mkdir.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mkdir</span>(2)</span></a> fails with
              the error <span class="errorname">EAGAIN</span>).</p>
              <p>Writing the string <em class="replaceable"><code>"max"</code></em> to this file
              means that no limit is imposed. The default value in
              this file is <em class="replaceable"><code>"max"</code></em>.</p>
            </dd>
          </dl>
        </div>
      </div>
    </div>
    <div class="refsect1">
      <a id="cgroups-7_sect23" name="cgroups-7_sect23" shape="rect"> </a>
      <h2>CGROUPS DELEGATION: DELEGATING A HIERARCHY TO A LESS
      PRIVILEGED USER</h2>
      <p>In the context of cgroups, delegation means passing
      management of some subtree of the cgroup hierarchy to a
      nonprivileged user. Cgroups v1 provides support for
      delegation based on file permissions in the cgroup hierarchy
      but with less strict containment rules than v2 (as noted
      below). Cgroups v2 supports delegation with containment by
      explicit design. The focus of the discussion in this section
      is on delegation in cgroups v2, with some differences for
      cgroups v1 noted along the way.</p>
      <p>Some terminology is required in order to describe
      delegation. A <em class="replaceable"><code>delegater</code></em> is a privileged
      user (i.e., root) who owns a parent cgroup. A <em class="replaceable"><code>delegatee</code></em> is a nonprivileged
      user who will be granted the permissions needed to manage
      some subhierarchy under that parent cgroup, known as the
      <span class="emphasis"><em>delegated subtree</em></span>.</p>
      <p>To perform delegation, the delegater makes certain
      directories and files writable by the delegatee, typically by
      changing the ownership of the objects to be the user ID of
      the delegatee. Assuming that we want to delegate the
      hierarchy rooted at (say) <code class="filename">/dlgt_grp</code> and that there are not yet any
      child cgroups under that cgroup, the ownership of the
      following is changed to the user ID of the delegatee:</p>
      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><code class="filename">/dlgt_grp</code></span></dt>
          <dd>
            <p>Changing the ownership of the root of the subtree
            means that any new cgroups created under the subtree
            (and the files they contain) will also be owned by the
            delegatee.</p>
          </dd>
          <dt><span class="term"><code class="filename">/dlgt_grp/cgroup.procs</code></span></dt>
          <dd>
            <p>Changing the ownership of this file means that the
            delegatee can move processes into the root of the
            delegated subtree.</p>
          </dd>
          <dt><span class="term"><code class="filename">/dlgt_grp/cgroup.subtree_control (cgroups v2
          only)</code></span></dt>
          <dd>
            <p>Changing the ownership of this file means that the
            delegatee can enable controllers (that are present in
            <code class="filename">/dlgt_grp/cgroup.controllers</code>) in
            order to further redistribute resources at lower levels
            in the subtree. (As an alternative to changing the
            ownership of this file, the delegater might instead add
            selected controllers to this file.)</p>
          </dd>
          <dt><span class="term"><code class="filename">/dlgt_grp/cgroup.threads (cgroups v2
          only)</code></span></dt>
          <dd>
            <p>Changing the ownership of this file is necessary if
            a threaded subtree is being delegated (see the
            description of "thread mode", below). This permits the
            delegatee to write thread IDs to the file. (The
            ownership of this file can also be changed when
            delegating a domain subtree, but currently this serves
            no purpose, since, as described below, it is not
            possible to move a thread between domain cgroups by
            writing its thread ID to the <em class="replaceable"><code>cgroup.threads</code></em>
            file.)</p>
            <p>In cgroups v1, the corresponding file that should
            instead be delegated is the <em class="replaceable"><code>tasks</code></em> file.</p>
          </dd>
        </dl>
      </div>
      <p>The delegater should <em class="replaceable"><code>not</code></em> change the ownership of
      any of the controller interfaces files (e.g., <em class="replaceable"><code>pids.max</code></em>, <em class="replaceable"><code>memory.high</code></em>) in <em class="replaceable"><code>dlgt_grp</code></em>. Those files are
      used from the next level above the delegated subtree in order
      to distribute resources into the subtree, and the delegatee
      should not have permission to change the resources that are
      distributed into the delegated subtree.</p>
      <p>See also the discussion of the <code class="filename">/sys/kernel/cgroup/delegate</code> file in NOTES
      for information about further delegatable files in cgroups
      v2.</p>
      <p>After the aforementioned steps have been performed, the
      delegatee can create child cgroups within the delegated
      subtree (the cgroup subdirectories and the files they contain
      will be owned by the delegatee) and move processes between
      cgroups in the subtree. If some controllers are present in
      <em class="replaceable"><code>dlgt_grp/cgroup.subtree_control</code></em>,
      or the ownership of that file was passed to the delegatee,
      the delegatee can also control the further redistribution of
      the corresponding resources into the delegated subtree.</p>
      <div class="refsect2">
        <a id="cgroups-7_sect24" name="cgroups-7_sect24" shape="rect"> </a>
        <h3>Cgroups v2 delegation: nsdelegate and cgroup
        namespaces</h3>
        <p>Starting with Linux 4.13, there is a second way to
        perform cgroup delegation in the cgroups v2 hierarchy. This
        is done by mounting or remounting the cgroup v2 filesystem
        with the <em class="replaceable"><code>nsdelegate</code></em> mount option.
        For example, if the cgroup v2 filesystem has already been
        mounted, we can remount it with the <em class="replaceable"><code>nsdelegate</code></em> option as
        follows:</p>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="informalexample">
              <pre class="programlisting" xml:space="preserve">
mount −t cgroup2 −o remount,nsdelegate \
                 none /sys/fs/cgroup/unified
</pre>
            </div>
          </blockquote>
        </div>
        <p>The effect of this mount option is to cause cgroup
        namespaces to automatically become delegation boundaries.
        More specifically, the following restrictions apply for
        processes inside the cgroup namespace:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc;">
            <li class="listitem">
              <p>Writes to controller interface files in the root
              directory of the namespace will fail with the error
              <span class="errorname">EPERM</span>. Processes
              inside the cgroup namespace can still write to
              delegatable files in the root directory of the cgroup
              namespace such as <em class="replaceable"><code>cgroup.procs</code></em> and
              <em class="replaceable"><code>cgroup.subtree_control</code></em>,
              and can create subhierarchy underneath the root
              directory.</p>
            </li>
            <li class="listitem">
              <p>Attempts to migrate processes across the namespace
              boundary are denied (with the error <span class="errorname">ENOENT</span>). Processes inside the
              cgroup namespace can still (subject to the
              containment rules described below) move processes
              between cgroups <em class="replaceable"><code>within</code></em> the
              subhierarchy under the namespace root.</p>
            </li>
          </ul>
        </div>
        <p>The ability to define cgroup namespaces as delegation
        boundaries makes cgroup namespaces more useful. To
        understand why, suppose that we already have one cgroup
        hierarchy that has been delegated to a nonprivileged user,
        <em class="replaceable"><code>cecilia</code></em>, using
        the older delegation technique described above. Suppose
        further that <em class="replaceable"><code>cecilia</code></em> wanted to further
        delegate a subhierarchy under the existing delegated
        hierarchy. (For example, the delegated hierarchy might be
        associated with an unprivileged container run by <em class="replaceable"><code>cecilia</code></em>.) Even if a cgroup
        namespace was employed, because both hierarchies are owned
        by the unprivileged user <em class="replaceable"><code>cecilia</code></em>, the following
        illegitimate actions could be performed:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc;">
            <li class="listitem">
              <p>A process in the inferior hierarchy could change
              the resource controller settings in the root
              directory of that hierarchy. (These resource
              controller settings are intended to allow control to
              be exercised from the <em class="replaceable"><code>parent</code></em> cgroup; a
              process inside the child cgroup should not be allowed
              to modify them.)</p>
            </li>
            <li class="listitem">
              <p>A process inside the inferior hierarchy could move
              processes into and out of the inferior hierarchy if
              the cgroups in the superior hierarchy were somehow
              visible.</p>
            </li>
          </ul>
        </div>
        <p>Employing the <em class="replaceable"><code>nsdelegate</code></em> mount option
        prevents both of these possibilities.</p>
        <p>The <em class="replaceable"><code>nsdelegate</code></em>
        mount option only has an effect when performed in the
        initial mount namespace; in other mount namespaces, the
        option is silently ignored.</p>
        <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Note">
            <tr>
              <td rowspan="2" align="center" valign="top" width="25" colspan="1"><img alt="[Note]" src="../stylesheet/note.png" /></td>
              <th align="left" rowspan="1" colspan="1">Note</th>
            </tr>
            <tr>
              <td align="left" valign="top" rowspan="1" colspan="1">
                <p>On some systems, <span class="citerefentry"><span class="refentrytitle">systemd</span>(1)</span>
                automatically mounts the cgroup v2 filesystem. In
                order to experiment with the <em class="replaceable"><code>nsdelegate</code></em>
                operation, it may be useful to boot the kernel with
                the following command-line options:</p>
              </td>
            </tr>
          </table>
        </div>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="informalexample">
              <pre class="programlisting" xml:space="preserve">
cgroup_no_v1=all systemd.legacy_systemd_cgroup_controller
</pre>
            </div>
          </blockquote>
        </div>
        <p>These options cause the kernel to boot with the cgroups
        v1 controllers disabled (meaning that the controllers are
        available in the v2 hierarchy), and tells <span class="citerefentry"><span class="refentrytitle">systemd</span>(1)</span> not to mount and
        use the cgroup v2 hierarchy, so that the v2 hierarchy can
        be manually mounted with the desired options after
        boot-up.</p>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect25" name="cgroups-7_sect25" shape="rect"> </a>
        <h3>Cgroup delegation containment rules</h3>
        <p>Some delegation <span class="emphasis"><em>containment
        rules</em></span> ensure that the delegatee can move
        processes between cgroups within the delegated subtree, but
        can't move processes from outside the delegated subtree
        into the subtree or vice versa. A nonprivileged process
        (i.e., the delegatee) can write the PID of a "target"
        process into a <em class="replaceable"><code>cgroup.procs</code></em> file only if
        all of the following are true:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc;">
            <li class="listitem">
              <p>The writer has write permission on the <em class="replaceable"><code>cgroup.procs</code></em> file in
              the destination cgroup.</p>
            </li>
            <li class="listitem">
              <p>The writer has write permission on the <em class="replaceable"><code>cgroup.procs</code></em> file in
              the nearest common ancestor of the source and
              destination cgroups. Note that in some cases, the
              nearest common ancestor may be the source or
              destination cgroup itself. This requirement is not
              enforced for cgroups v1 hierarchies, with the
              consequence that containment in v1 is less strict
              than in v2. (For example, in cgroups v1 the user that
              owns two distinct delegated subhierarchies can move a
              process between the hierarchies.)</p>
            </li>
            <li class="listitem">
              <p>If the cgroup v2 filesystem was mounted with the
              <em class="replaceable"><code>nsdelegate</code></em>
              option, the writer must be able to see the source and
              destination cgroups from its cgroup namespace.</p>
            </li>
            <li class="listitem">
              <p>In cgroups v1: the effective UID of the writer
              (i.e., the delegatee) matches the real user ID or the
              saved set-user-ID of the target process. Before Linux
              4.11, this requirement also applied in cgroups v2
              (This was a historical requirement inherited from
              cgroups v1 that was later deemed unnecessary, since
              the other rules suffice for containment in cgroups
              v2.)</p>
            </li>
          </ul>
        </div>
        <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Note">
            <tr>
              <td rowspan="2" align="center" valign="top" width="25" colspan="1"><img alt="[Note]" src="../stylesheet/note.png" /></td>
              <th align="left" rowspan="1" colspan="1">Note</th>
            </tr>
            <tr>
              <td align="left" valign="top" rowspan="1" colspan="1">
                <p>one consequence of these delegation containment
                rules is that the unprivileged delegatee can't
                place the first process into the delegated subtree;
                instead, the delegater must place the first process
                (a process owned by the delegatee) into the
                delegated subtree.</p>
              </td>
            </tr>
          </table>
        </div>
      </div>
    </div>
    <div class="refsect1">
      <a id="cgroups-7_sect26" name="cgroups-7_sect26" shape="rect"> </a>
      <h2>CGROUPS VERSION 2 THREAD MODE</h2>
      <p>Among the restrictions imposed by cgroups v2 that were not
      present in cgroups v1 are the following:</p>
      <div class="itemizedlist">
        <ul class="itemizedlist" style="list-style-type: disc;">
          <li class="listitem">
            <p><span class="emphasis"><em>No thread-granularity
            control</em></span>: all of the threads of a process
            must be in the same cgroup.</p>
          </li>
          <li class="listitem">
            <p><span class="emphasis"><em>No internal
            processes</em></span>: a cgroup can't both have member
            processes and exercise controllers on child
            cgroups.</p>
          </li>
        </ul>
      </div>
      <p>Both of these restrictions were added because the lack of
      these restrictions had caused problems in cgroups v1. In
      particular, the cgroups v1 ability to allow thread-level
      granularity for cgroup membership made no sense for some
      controllers. (A notable example was the <em class="replaceable"><code>memory</code></em> controller: since
      threads share an address space, it made no sense to split
      threads across different <em class="replaceable"><code>memory</code></em> cgroups.)</p>
      <p>Notwithstanding the initial design decision in cgroups v2,
      there were use cases for certain controllers, notably the
      <em class="replaceable"><code>cpu</code></em> controller, for
      which thread-level granularity of control was meaningful and
      useful. To accommodate such use cases, Linux 4.14 added
      <span class="emphasis"><em>thread mode</em></span> for
      cgroups v2.</p>
      <p>Thread mode allows the following:</p>
      <div class="itemizedlist">
        <ul class="itemizedlist" style="list-style-type: disc;">
          <li class="listitem">
            <p>The creation of <span class="emphasis"><em>threaded
            subtrees</em></span> in which the threads of a process
            may be spread across cgroups inside the tree. (A
            threaded subtree may contain multiple multithreaded
            processes.)</p>
          </li>
          <li class="listitem">
            <p>The concept of <span class="emphasis"><em>threaded
            controllers</em></span>, which can distribute resources
            across the cgroups in a threaded subtree.</p>
          </li>
          <li class="listitem">
            <p>A relaxation of the "no internal processes rule", so
            that, within a threaded subtree, a cgroup can both
            contain member threads and exercise resource control
            over child cgroups.</p>
          </li>
        </ul>
      </div>
      <p>With the addition of thread mode, each nonroot cgroup now
      contains a new file, <em class="replaceable"><code>cgroup.type</code></em>, that exposes,
      and in some circumstances can be used to change, the "type"
      of a cgroup. This file contains one of the following type
      values:</p>
      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><em class="replaceable"><code>domain</code></em></span></dt>
          <dd>
            <p>This is a normal v2 cgroup that provides
            process-granularity control. If a process is a member
            of this cgroup, then all threads of the process are (by
            definition) in the same cgroup. This is the default
            cgroup type, and provides the same behavior that was
            provided for cgroups in the initial cgroups v2
            implementation.</p>
          </dd>
          <dt><span class="term"><em class="replaceable"><code>threaded</code></em></span></dt>
          <dd>
            <p>This cgroup is a member of a threaded subtree.
            Threads can be added to this cgroup, and controllers
            can be enabled for the cgroup.</p>
          </dd>
          <dt><span class="term"><span class="emphasis"><em>domain
          threaded</em></span></span></dt>
          <dd>
            <p>This is a domain cgroup that serves as the root of a
            threaded subtree. This cgroup type is also known as
            "threaded root".</p>
          </dd>
          <dt><span class="term"><span class="emphasis"><em>domain
          invalid</em></span></span></dt>
          <dd>
            <p>This is a cgroup inside a threaded subtree that is
            in an "invalid" state. Processes can't be added to the
            cgroup, and controllers can't be enabled for the
            cgroup. The only thing that can be done with this
            cgroup (other than deleting it) is to convert it to a
            <em class="replaceable"><code>threaded</code></em>
            cgroup by writing the string <em class="replaceable"><code>"threaded"</code></em> to the
            <em class="replaceable"><code>cgroup.type</code></em>
            file.</p>
            <p>The rationale for the existence of this "interim"
            type during the creation of a threaded subtree (rather
            than the kernel simply immediately converting all
            cgroups under the threaded root to the type <em class="replaceable"><code>threaded</code></em>) is to allow
            for possible future extensions to the thread mode
            model</p>
          </dd>
        </dl>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect27" name="cgroups-7_sect27" shape="rect"> </a>
        <h3>Threaded versus domain controllers</h3>
        <p>With the addition of threads mode, cgroups v2 now
        distinguishes two types of resource controllers:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc;">
            <li class="listitem">
              <p><em class="replaceable"><code>Threaded</code></em>
              controllers: these controllers support
              thread-granularity for resource control and can be
              enabled inside threaded subtrees, with the result
              that the corresponding controller-interface files
              appear inside the cgroups in the threaded subtree. As
              at Linux 4.19, the following controllers are
              threaded: <em class="replaceable"><code>cpu</code></em>, <em class="replaceable"><code>perf_event</code></em>, and
              <em class="replaceable"><code>pids</code></em>.</p>
            </li>
            <li class="listitem">
              <p><em class="replaceable"><code>Domain</code></em>
              controllers: these controllers support only process
              granularity for resource control. From the
              perspective of a domain controller, all threads of a
              process are always in the same cgroup. Domain
              controllers can't be enabled inside a threaded
              subtree.</p>
            </li>
          </ul>
        </div>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect28" name="cgroups-7_sect28" shape="rect"> </a>
        <h3>Creating a threaded subtree</h3>
        <p>There are two pathways that lead to the creation of a
        threaded subtree. The first pathway proceeds as
        follows:</p>
        <div class="orderedlist">
          <ol class="orderedlist" type="1">
            <li class="listitem">
              <p>We write the string <em class="replaceable"><code>"threaded"</code></em> to the
              <em class="replaceable"><code>cgroup.type</code></em>
              file of a cgroup <em class="replaceable"><code>y/z</code></em> that currently
              has the type <em class="replaceable"><code>domain</code></em>. This has the
              following effects:</p>
              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: disc;">
                      <li class="listitem">
                        <p>The type of the cgroup <em class="replaceable"><code>y/z</code></em> becomes
                        <em class="replaceable"><code>threaded</code></em>.</p>
                      </li>
                      <li class="listitem">
                        <p>The type of the parent cgroup,
                        <em class="replaceable"><code>y</code></em>,
                        becomes <span class="emphasis"><em>domain
                        threaded</em></span>. The parent cgroup is
                        the root of a threaded subtree (also known
                        as the "threaded root").</p>
                      </li>
                      <li class="listitem">
                        <p>All other cgroups under <em class="replaceable"><code>y</code></em> that were
                        not already of type <em class="replaceable"><code>threaded</code></em>
                        (because they were inside already existing
                        threaded subtrees under the new threaded
                        root) are converted to type <span class="emphasis"><em>domain invalid</em></span>.
                        Any subsequently created cgroups under
                        <em class="replaceable"><code>y</code></em>
                        will also have the type <span class="emphasis"><em>domain
                        invalid</em></span>.</p>
                      </li>
                    </ul>
                  </div>
                </blockquote>
              </div>
            </li>
            <li class="listitem">
              <p>We write the string <em class="replaceable"><code>"threaded"</code></em> to each of
              the <span class="emphasis"><em>domain
              invalid</em></span> cgroups under <em class="replaceable"><code>y</code></em>, in order to
              convert them to the type <em class="replaceable"><code>threaded</code></em>. As a
              consequence of this step, all threads under the
              threaded root now have the type <em class="replaceable"><code>threaded</code></em> and the
              threaded subtree is now fully usable. The requirement
              to write <em class="replaceable"><code>"threaded"</code></em> to each of
              these cgroups is somewhat cumbersome, but allows for
              possible future extensions to the thread-mode
              model.</p>
            </li>
          </ol>
        </div>
        <p>The second way of creating a threaded subtree is as
        follows:</p>
        <div class="orderedlist">
          <ol class="orderedlist" type="1">
            <li class="listitem">
              <p>In an existing cgroup, <em class="replaceable"><code>z</code></em>, that currently has
              the type <em class="replaceable"><code>domain</code></em>, we (1) enable
              one or more threaded controllers and (2) make a
              process a member of <em class="replaceable"><code>z</code></em>. (These two steps
              can be done in either order.) This has the following
              consequences:</p>
              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: disc;">
                      <li class="listitem">
                        <p>The type of <em class="replaceable"><code>z</code></em> becomes
                        <span class="emphasis"><em>domain
                        threaded</em></span>.</p>
                      </li>
                      <li class="listitem">
                        <p>All of the descendant cgroups of
                        <em class="replaceable"><code>x</code></em>
                        that were not already of type <em class="replaceable"><code>threaded</code></em>
                        are converted to type <span class="emphasis"><em>domain
                        invalid</em></span>.</p>
                      </li>
                    </ul>
                  </div>
                </blockquote>
              </div>
            </li>
            <li class="listitem">
              <p>As before, we make the threaded subtree usable by
              writing the string <em class="replaceable"><code>"threaded"</code></em> to each of
              the <span class="emphasis"><em>domain
              invalid</em></span> cgroups under <em class="replaceable"><code>y</code></em>, in order to
              convert them to the type <em class="replaceable"><code>threaded</code></em>.</p>
            </li>
          </ol>
        </div>
        <p>One of the consequences of the above pathways to
        creating a threaded subtree is that the threaded root
        cgroup can be a parent only to <em class="replaceable"><code>threaded</code></em> (and <span class="emphasis"><em>domain invalid</em></span>) cgroups. The
        threaded root cgroup can't be a parent of a <em class="replaceable"><code>domain</code></em> cgroups, and a
        <em class="replaceable"><code>threaded</code></em> cgroup
        can't have a sibling that is a <em class="replaceable"><code>domain</code></em> cgroup.</p>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect29" name="cgroups-7_sect29" shape="rect"> </a>
        <h3>Using a threaded subtree</h3>
        <p>Within a threaded subtree, threaded controllers can be
        enabled in each subgroup whose type has been changed to
        <em class="replaceable"><code>threaded</code></em>; upon
        doing so, the corresponding controller interface files
        appear in the children of that cgroup.</p>
        <p>A process can be moved into a threaded subtree by
        writing its PID to the <em class="replaceable"><code>cgroup.procs</code></em> file in one of
        the cgroups inside the tree. This has the effect of making
        all of the threads in the process members of the
        corresponding cgroup and makes the process a member of the
        threaded subtree. The threads of the process can then be
        spread across the threaded subtree by writing their thread
        IDs (see <a class="link" href="../htmlman2/gettid.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">gettid</span>(2)</span></a>) to the
        <em class="replaceable"><code>cgroup.threads</code></em>
        files in different cgroups inside the subtree. The threads
        of a process must all reside in the same threaded
        subtree.</p>
        <p>As with writing to <em class="replaceable"><code>cgroup.procs</code></em>, some
        containment rules apply when writing to the <em class="replaceable"><code>cgroup.threads</code></em> file:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc;">
            <li class="listitem">
              <p>The writer must have write permission on the
              cgroup.threads file in the destination cgroup.</p>
            </li>
            <li class="listitem">
              <p>The writer must have write permission on the
              <em class="replaceable"><code>cgroup.procs</code></em> file in
              the common ancestor of the source and destination
              cgroups. (In some cases, the common ancestor may be
              the source or destination cgroup itself.)</p>
            </li>
            <li class="listitem">
              <p>The source and destination cgroups must be in the
              same threaded subtree. (Outside a threaded subtree,
              an attempt to move a thread by writing its thread ID
              to the <em class="replaceable"><code>cgroup.threads</code></em> file
              in a different <em class="replaceable"><code>domain</code></em> cgroup fails
              with the error <span class="errorname">EOPNOTSUPP</span>.)</p>
            </li>
          </ul>
        </div>
        <p>The <em class="replaceable"><code>cgroup.threads</code></em> file is
        present in each cgroup (including <em class="replaceable"><code>domain</code></em> cgroups) and can be
        read in order to discover the set of threads that is
        present in the cgroup. The set of thread IDs obtained when
        reading this file is not guaranteed to be ordered or free
        of duplicates.</p>
        <p>The <em class="replaceable"><code>cgroup.procs</code></em> file in the
        threaded root shows the PIDs of all processes that are
        members of the threaded subtree. The <em class="replaceable"><code>cgroup.procs</code></em> files in the
        other cgroups in the subtree are not readable.</p>
        <p>Domain controllers can't be enabled in a threaded
        subtree; no controller-interface files appear inside the
        cgroups underneath the threaded root. From the point of
        view of a domain controller, threaded subtrees are
        invisible: a multithreaded process inside a threaded
        subtree appears to a domain controller as a process that
        resides in the threaded root cgroup.</p>
        <p>Within a threaded subtree, the "no internal processes"
        rule does not apply: a cgroup can both contain member
        processes (or thread) and exercise controllers on child
        cgroups.</p>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect30" name="cgroups-7_sect30" shape="rect"> </a>
        <h3>Rules for writing to cgroup.type and creating threaded
        subtrees</h3>
        <p>A number of rules apply when writing to the <em class="replaceable"><code>cgroup.type</code></em> file:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc;">
            <li class="listitem">
              <p>Only the string <em class="replaceable"><code>"threaded"</code></em> may be
              written. In other words, the only explicit transition
              that is possible is to convert a <em class="replaceable"><code>domain</code></em> cgroup to type
              <em class="replaceable"><code>threaded</code></em>.</p>
            </li>
            <li class="listitem">
              <p>The effect of writing <em class="replaceable"><code>"threaded"</code></em> depends on
              the current value in <em class="replaceable"><code>cgroup.type</code></em>, as
              follows:</p>
              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle;">
                      <li class="listitem">
                        <p><em class="replaceable"><code>domain</code></em> or
                        <span class="emphasis"><em>domain
                        threaded</em></span>: start the creation of
                        a threaded subtree (whose root is the
                        parent of this cgroup) via the first of the
                        pathways described above;</p>
                      </li>
                      <li class="listitem">
                        <p><span class="emphasis"><em>domain
                        invalid</em></span>: convert this cgroup
                        (which is inside a threaded subtree) to a
                        usable (i.e., <em class="replaceable"><code>threaded</code></em>)
                        state;</p>
                      </li>
                      <li class="listitem">
                        <p><em class="replaceable"><code>threaded</code></em>:
                        no effect (a "no-op").</p>
                      </li>
                    </ul>
                  </div>
                </blockquote>
              </div>
            </li>
            <li class="listitem">
              <p>We can't write to a <em class="replaceable"><code>cgroup.type</code></em> file if
              the parent's type is <span class="emphasis"><em>domain invalid</em></span>. In other
              words, the cgroups of a threaded subtree must be
              converted to the <em class="replaceable"><code>threaded</code></em> state in a
              top-down manner.</p>
            </li>
          </ul>
        </div>
        <p>There are also some constraints that must be satisfied
        in order to create a threaded subtree rooted at the cgroup
        <em class="replaceable"><code>x</code></em>:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc;">
            <li class="listitem">
              <p>There can be no member processes in the descendant
              cgroups of <em class="replaceable"><code>x</code></em>. (The cgroup
              <em class="replaceable"><code>x</code></em> can
              itself have member processes.)</p>
            </li>
            <li class="listitem">
              <p>No domain controllers may be enabled in <em class="replaceable"><code>x</code></em>'s <em class="replaceable"><code>cgroup.subtree_control</code></em>
              file.</p>
            </li>
          </ul>
        </div>
        <p>If any of the above constraints is violated, then an
        attempt to write <em class="replaceable"><code>"threaded"</code></em> to a <em class="replaceable"><code>cgroup.type</code></em> file fails with
        the error <span class="errorname">ENOTSUP</span>.</p>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect31" name="cgroups-7_sect31" shape="rect"> </a>
        <h3>The "domain threaded" cgroup type</h3>
        <p>According to the pathways described above, the type of a
        cgroup can change to <span class="emphasis"><em>domain
        threaded</em></span> in either of the following cases:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc;">
            <li class="listitem">
              <p>The string <em class="replaceable"><code>"threaded"</code></em> is written
              to a child cgroup.</p>
            </li>
            <li class="listitem">
              <p>A threaded controller is enabled inside the cgroup
              and a process is made a member of the cgroup.</p>
            </li>
          </ul>
        </div>
        <p>A <span class="emphasis"><em>domain threaded</em></span>
        cgroup, <em class="replaceable"><code>x</code></em>, can
        revert to the type <em class="replaceable"><code>domain</code></em> if the above
        conditions no longer hold true—that is, if all
        <em class="replaceable"><code>threaded</code></em> child
        cgroups of <em class="replaceable"><code>x</code></em> are
        removed and either <em class="replaceable"><code>x</code></em> no longer has threaded
        controllers enabled or no longer has member processes.</p>
        <p>When a <span class="emphasis"><em>domain
        threaded</em></span> cgroup <em class="replaceable"><code>x</code></em> reverts to the type
        <em class="replaceable"><code>domain</code></em>:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc;">
            <li class="listitem">
              <p>All <span class="emphasis"><em>domain
              invalid</em></span> descendants of <em class="replaceable"><code>x</code></em> that are not in
              lower-level threaded subtrees revert to the type
              <em class="replaceable"><code>domain</code></em>.</p>
            </li>
            <li class="listitem">
              <p>The root cgroups in any lower-level threaded
              subtrees revert to the type <span class="emphasis"><em>domain threaded</em></span>.</p>
            </li>
          </ul>
        </div>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect32" name="cgroups-7_sect32" shape="rect"> </a>
        <h3>Exceptions for the root cgroup</h3>
        <p>The root cgroup of the v2 hierarchy is treated
        exceptionally: it can be the parent of both <em class="replaceable"><code>domain</code></em> and <em class="replaceable"><code>threaded</code></em> cgroups. If the
        string <em class="replaceable"><code>"threaded"</code></em>
        is written to the <em class="replaceable"><code>cgroup.type</code></em> file of one of
        the children of the root cgroup, then</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc;">
            <li class="listitem">
              <p>The type of that cgroup becomes <em class="replaceable"><code>threaded</code></em>.</p>
            </li>
            <li class="listitem">
              <p>The type of any descendants of that cgroup that
              are not part of lower-level threaded subtrees changes
              to <span class="emphasis"><em>domain
              invalid</em></span>.</p>
            </li>
          </ul>
        </div>
        <p>Note that in this case, there is no cgroup whose type
        becomes <span class="emphasis"><em>domain
        threaded</em></span>. (Notionally, the root cgroup can be
        considered as the threaded root for the cgroup whose type
        was changed to <em class="replaceable"><code>threaded</code></em>.)</p>
        <p>The aim of this exceptional treatment for the root
        cgroup is to allow a threaded cgroup that employs the
        <em class="replaceable"><code>cpu</code></em> controller to
        be placed as high as possible in the hierarchy, so as to
        minimize the (small) cost of traversing the cgroup
        hierarchy.</p>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect33" name="cgroups-7_sect33" shape="rect"> </a>
        <h3>The cgroups v2 "cpu" controller and realtime
        threads</h3>
        <p>As at Linux 4.19, the cgroups v2 <em class="replaceable"><code>cpu</code></em> controller does not
        support control of realtime threads (specifically threads
        scheduled under any of the policies <code class="constant">SCHED_FIFO</code>, <code class="constant">SCHED_RR</code>, described <code class="constant">SCHED_DEADLINE</code>; see <a class="link" href="../htmlman7/sched.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">sched</span>(7)</span></a>). Therefore, the
        <em class="replaceable"><code>cpu</code></em> controller
        can be enabled in the root cgroup only if all realtime
        threads are in the root cgroup. (If there are realtime
        threads in nonroot cgroups, then a <a class="link" href="../htmlman2/write.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">write</span>(2)</span></a> of the string
        <em class="replaceable"><code>"+cpu"</code></em> to the
        <em class="replaceable"><code>cgroup.subtree_control</code></em> file
        fails with the error <span class="errorname">EINVAL</span>.)</p>
        <p>On some systems, <span class="citerefentry"><span class="refentrytitle">systemd</span>(1)</span> places certain
        realtime threads in nonroot cgroups in the v2 hierarchy. On
        such systems, these threads must first be moved to the root
        cgroup before the <em class="replaceable"><code>cpu</code></em> controller can be
        enabled.</p>
      </div>
    </div>
    <div class="refsect1">
      <a id="cgroups-7_sect34" name="cgroups-7_sect34" shape="rect"> </a>
      <h2>ERRORS</h2>
      <p>The following errors can occur for <a class="link" href="../htmlman2/mount.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mount</span>(2)</span></a>:</p>
      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><span class="errorname">EBUSY</span></span></dt>
          <dd>
            <p>An attempt to mount a cgroup version 1 filesystem
            specified neither the <em class="replaceable"><code>name=</code></em> option (to mount
            a named hierarchy) nor a controller name (or <em class="replaceable"><code>all</code></em>).</p>
          </dd>
        </dl>
      </div>
    </div>
    <div class="refsect1">
      <a id="cgroups-7_sect35" name="cgroups-7_sect35" shape="rect"> </a>
      <h2>NOTES</h2>
      <p>A child process created via <a class="link" href="../htmlman2/fork.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fork</span>(2)</span></a> inherits its
      parent's cgroup memberships. A process's cgroup memberships
      are preserved across <a class="link" href="../htmlman2/execve.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a>.</p>
      <p>The <a class="link" href="../htmlman2/clone.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">clone3</span>(2)</span></a> <code class="constant">CLONE_INTO_CGROUP</code> flag can be used to
      create a child process that begins its life in a different
      version 2 cgroup from the parent process.</p>
      <div class="refsect2">
        <a id="cgroups-7_sect36" name="cgroups-7_sect36" shape="rect"> </a>
        <h3>/proc files</h3>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><code class="filename">/proc/cgroups</code> (since Linux
            2.6.24)</span></dt>
            <dd>
              <p>This file contains information about the
              controllers that are compiled into the kernel. An
              example of the contents of this file (reformatted for
              readability) is the following:</p>
              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="informalexample">
                    <pre class="programlisting" xml:space="preserve">
#subsys_name    hierarchy      num_cgroups    enabled
cpuset          4              1              1
cpu             8              1              1
cpuacct         8              1              1
blkio           6              1              1
memory          3              1              1
devices         10             84             1
freezer         7              1              1
net_cls         9              1              1
perf_event      5              1              1
net_prio        9              1              1
hugetlb         0              1              0
pids            2              1              1
</pre>
                  </div>
                </blockquote>
              </div>
              <p>The fields in this file are, from left to
              right:</p>
              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="orderedlist">
                    <ol class="orderedlist" type="1">
                      <li class="listitem">
                        <p>The name of the controller.</p>
                      </li>
                      <li class="listitem">
                        <p>The unique ID of the cgroup hierarchy on
                        which this controller is mounted. If
                        multiple cgroups v1 controllers are bound
                        to the same hierarchy, then each will show
                        the same hierarchy ID in this field. The
                        value in this field will be 0 if:</p>
                        <div class="blockquote">
                          <blockquote class="blockquote">
                            <div class="orderedlist">
                              <ol class="orderedlist" type="a">
                                <li class="listitem">
                                  <p>the controller is not mounted
                                  on a cgroups v1 hierarchy;</p>
                                </li>
                                <li class="listitem">
                                  <p>the controller is bound to the
                                  cgroups v2 single unified
                                  hierarchy; or</p>
                                </li>
                                <li class="listitem">
                                  <p>the controller is disabled
                                  (see below).</p>
                                </li>
                              </ol>
                            </div>
                          </blockquote>
                        </div>
                      </li>
                      <li class="listitem">
                        <p>The number of control groups in this
                        hierarchy using this controller.</p>
                      </li>
                      <li class="listitem">
                        <p>This field contains the value 1 if this
                        controller is enabled, or 0 if it has been
                        disabled (via the <em class="replaceable"><code>cgroup_disable</code></em>
                        kernel command-line boot parameter).</p>
                      </li>
                    </ol>
                  </div>
                </blockquote>
              </div>
            </dd>
            <dt><span class="term"><code class="filename">/proc/[pid]/cgroup</code> (since Linux
            2.6.24)</span></dt>
            <dd>
              <p>This file describes control groups to which the
              process with the corresponding PID belongs. The
              displayed information differs for cgroups version 1
              and version 2 hierarchies.</p>
              <p>For each cgroup hierarchy of which the process is
              a member, there is one entry containing three
              colon-separated fields:</p>
              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="informalexample">
                    <pre class="programlisting" xml:space="preserve">
hierarchy−ID:controller−list:cgroup−path
</pre>
                  </div>
                </blockquote>
              </div>
              <p>For example:</p>
              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="informalexample">
                    <pre class="programlisting" xml:space="preserve">
5:cpuacct,cpu,cpuset:/daemons
</pre>
                  </div>
                </blockquote>
              </div>
              <p>The colon-separated fields are, from left to
              right:</p>
              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="orderedlist">
                    <ol class="orderedlist" type="1">
                      <li class="listitem">
                        <p>For cgroups version 1 hierarchies, this
                        field contains a unique hierarchy ID number
                        that can be matched to a hierarchy ID in
                        <code class="filename">/proc/cgroups</code>. For the
                        cgroups version 2 hierarchy, this field
                        contains the value 0.</p>
                      </li>
                      <li class="listitem">
                        <p>For cgroups version 1 hierarchies, this
                        field contains a comma-separated list of
                        the controllers bound to the hierarchy. For
                        the cgroups version 2 hierarchy, this field
                        is empty.</p>
                      </li>
                      <li class="listitem">
                        <p>This field contains the pathname of the
                        control group in the hierarchy to which the
                        process belongs. This pathname is relative
                        to the mount point of the hierarchy.</p>
                      </li>
                    </ol>
                  </div>
                </blockquote>
              </div>
            </dd>
          </dl>
        </div>
      </div>
      <div class="refsect2">
        <a id="cgroups-7_sect37" name="cgroups-7_sect37" shape="rect"> </a>
        <h3>/sys/kernel/cgroup files</h3>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><code class="filename">/sys/kernel/cgroup/delegate</code> (since
            Linux 4.15)</span></dt>
            <dd>
              <p>This file exports a list of the cgroups v2 files
              (one per line) that are delegatable (i.e., whose
              ownership should be changed to the user ID of the
              delegatee). In the future, the set of delegatable
              files may change or grow, and this file provides a
              way for the kernel to inform user-space applications
              of which files must be delegated. As at Linux 4.15,
              one sees the following when inspecting this file:</p>
              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="informalexample">
                    <pre class="programlisting" xml:space="preserve">
$ <span class="emphasis"><em>cat /sys/kernel/cgroup/delegate</em></span>
cgroup.procs
cgroup.subtree_control
cgroup.threads
</pre>
                  </div>
                </blockquote>
              </div>
            </dd>
            <dt><span class="term"><code class="filename">/sys/kernel/cgroup/features</code> (since
            Linux 4.15)</span></dt>
            <dd>
              <p>Over time, the set of cgroups v2 features that are
              provided by the kernel may change or grow, or some
              features may not be enabled by default. This file
              provides a way for user-space applications to
              discover what features the running kernel supports
              and has enabled. Features are listed one per
              line:</p>
              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="informalexample">
                    <pre class="programlisting" xml:space="preserve">
$ <span class="emphasis"><em>cat /sys/kernel/cgroup/features</em></span>
nsdelegate
memory_localevents
</pre>
                  </div>
                </blockquote>
              </div>
              <p>The entries that can appear in this file are:</p>
              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="variablelist">
                    <dl class="variablelist">
                      <dt><span class="term"><em class="replaceable"><code>memory_localevents</code></em>
                      (since Linux 5.2)</span></dt>
                      <dd>
                        <p>The kernel supports the <em class="replaceable"><code>memory_localevents</code></em>
                        mount option.</p>
                      </dd>
                      <dt><span class="term"><em class="replaceable"><code>nsdelegate</code></em>
                      (since Linux 4.15)</span></dt>
                      <dd>
                        <p>The kernel supports the <em class="replaceable"><code>nsdelegate</code></em>
                        mount option.</p>
                      </dd>
                    </dl>
                  </div>
                </blockquote>
              </div>
            </dd>
          </dl>
        </div>
      </div>
    </div>
    <div class="refsect1">
      <a id="cgroups-7_sect38" name="cgroups-7_sect38" shape="rect"> </a>
      <h2>SEE ALSO</h2>
      <p><a class="link" href="../htmlman1/prlimit.1.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">prlimit</span>(1)</span></a>, <span class="citerefentry"><span class="refentrytitle">systemd</span>(1)</span>, <span class="citerefentry"><span class="refentrytitle">systemd-cgls</span>(1)</span>, <span class="citerefentry"><span class="refentrytitle">systemd-cgtop</span>(1)</span>, <a class="link" href="../htmlman2/clone.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">clone</span>(2)</span></a>, <a class="link" href="../htmlman2/ioprio_set.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">ioprio_set</span>(2)</span></a>, <a class="link" href="../htmlman2/perf_event_open.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">perf_event_open</span>(2)</span></a>,
      <a class="link" href="../htmlman2/getrlimit.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">setrlimit</span>(2)</span></a>, <a class="link" href="../htmlman7/cgroup_namespaces.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">cgroup_namespaces</span>(7)</span></a>,
      <a class="link" href="../htmlman7/cpuset.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">cpuset</span>(7)</span></a>, <a class="link" href="../htmlman7/namespaces.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">namespaces</span>(7)</span></a>, <a class="link" href="../htmlman7/sched.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">sched</span>(7)</span></a>, <a class="link" href="../htmlman7/user_namespaces.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">user_namespaces</span>(7)</span></a></p>
      <p>The kernel source file <code class="filename">Documentation/admin−guide/cgroup−v2.rst</code>.</p>
    </div>
    <div class="colophon">
      <a id="cgroups-7_sect39" name="cgroups-7_sect39" shape="rect"> </a>
      <h2>COLOPHON</h2>
      <p>This page is part of release 5.11 of the Linux <em class="replaceable"><code>man-pages</code></em> project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      https://www.kernel.org/doc/man−pages/.</p>
      <div class="license">
        <table class="license" style="border-collapse: collapse;">
          <colgroup span="1">
            <col span="1" />
          </colgroup>
          <tbody>
            <tr>
              <td style="" rowspan="1" colspan="1">
                <div class="literallayout">
                  <br />
                    Copyright (C) 2015 Serge Hallyn &lt;serge<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>hallyn.com&gt;<br />

                  and Copyright (C) 2016, 2017 Michael Kerrisk &lt;mtk.manpages<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>gmail.com&gt;<br />

                  <br />
                  %%%LICENSE_START(VERBATIM)<br />
                  Permission is granted to make and distribute verbatim copies of this<br />

                  manual provided the copyright notice and this permission notice are<br />

                  preserved on all copies.<br />
                  <br />
                  Permission is granted to copy and distribute modified versions of this<br />

                  manual under the conditions for verbatim copying, provided that the<br />

                  entire resulting derived work is distributed under the terms of a<br />

                  permission notice identical to this one.<br />

                  <br />
                  Since the Linux kernel and libraries are constantly changing, this<br />

                  manual page may be incorrect or out-of-date.  The author(s) assume no<br />

                  responsibility for errors or omissions, or for damages resulting from<br />

                  the use of the information contained herein.  The author(s) may not<br />

                  have taken the same level of care in the production of this manual,<br />

                  which is licensed free of charge, as they might when working<br />

                  professionally.<br />
                  <br />
                  Formatted or processed versions of this manual, if unaccompanied by<br />

                  the source, must acknowledge the copyright and authors of this work.<br />

                  %%%LICENSE_END<br />
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</body>
</html>
