<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>sock_diag(7) — Linux manual pages</title>
  <link rel="stylesheet" type="text/css" href="../stylesheet/manpages.css" />
  
  <link rel="home" href="../index.html" title="sock_diag(7) — Linux manual pages" />
  <script type="text/javascript" src="../stylesheet/manpages.js" xml:space="preserve"> </script>
  <link rel="icon" href="../stylesheet/icon.gif" type="image/gif" />
</head>
<body onload="javascript:init()">
  <div class="navheader">
    <table width="100%">
      <tbody>
        <tr>
          <td style="width: 33%" rowspan="1" colspan="1"><a href="../index.html" shape="rect">Linux
          manual pages</a></td>
          <th rowspan="1" colspan="1"><a href="../index7.html" shape="rect">Section 7</a></th>
          <td style="width: 33%" rowspan="1" colspan="1"> </td>
        </tr>
      </tbody>
    </table>
    <hr />
  </div>
  <div class="refentry">
    <a id="sock-diag.7" name="sock-diag.7" shape="rect"> </a>
    <div class="titlepage"> </div>
    <div class="refnamediv">
      <h2>Name</h2>
      <p>sock_diag — obtaining information about sockets</p>
    </div>
    <div class="refsynopsisdiv">
      <h2>Synopsis</h2>
      <div class="informalexample">
        <pre class="programlisting" xml:space="preserve">
#include &lt;sys/socket.h&gt;
#include &lt;linux/sock_diag.h&gt;
#include &lt;linux/unix_diag.h&gt;  /* for UNIX domain sockets */
#include &lt;linux/inet_diag.h&gt;  /* for IPv4 and IPv6 sockets */</pre>
      </div>
      <div class="funcsynopsis">
        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">diag_socket =
            <strong>socket</strong>(</code></td>
            <td rowspan="1" colspan="1"><var class="pdparam">AF_NETLINK</var>,</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1"> </td>
            <td rowspan="1" colspan="1"><var class="pdparam">socket_type</var>,</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1"> </td>
            <td rowspan="1" colspan="1"><var class="pdparam">NETLINK_SOCK_DIAG</var><code>)</code>;</td>
          </tr>
        </table>
        <div class="funcprototype-spacer">
           
        </div>
      </div>
    </div>
    <div class="refsect1">
      <a id="sock-diag-7_sect1" name="sock-diag-7_sect1" shape="rect"> </a>
      <h2>DESCRIPTION</h2>
      <p>The sock_diag netlink subsystem provides a mechanism for
      obtaining information about sockets of various address
      families from the kernel. This subsystem can be used to
      obtain information about individual sockets or request a list
      of sockets.</p>
      <p>In the request, the caller can specify additional
      information it would like to obtain about the socket, for
      example, memory information or information specific to the
      address family.</p>
      <p>When requesting a list of sockets, the caller can specify
      filters that would be applied by the kernel to select a
      subset of sockets to report. For now, there is only the
      ability to filter sockets by state (connected, listening, and
      so on.)</p>
      <p>Note that sock_diag reports only those sockets that have a
      name; that is, either sockets bound explicitly with <a class="link" href="../htmlman2/bind.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">bind</span>(2)</span></a> or sockets that
      were automatically bound to an address (e.g., by <a class="link" href="../htmlman2/connect.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">connect</span>(2)</span></a>). This is the
      same set of sockets that is available via <code class="filename">/proc/net/unix</code>, <code class="filename">/proc/net/tcp</code>, <code class="filename">/proc/net/udp</code>, and so on.</p>
      <div class="refsect2">
        <a id="sock-diag-7_sect2" name="sock-diag-7_sect2" shape="rect"> </a>
        <h3>Request</h3>
        <p>The request starts with a <span class="emphasis"><em>struct nlmsghdr</em></span> header described
        in <a class="link" href="../htmlman7/netlink.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">netlink</span>(7)</span></a> with
        <em class="replaceable"><code>nlmsg_type</code></em> field
        set to <code class="constant">SOCK_DIAG_BY_FAMILY</code>.
        It is followed by a header specific to the address family
        that starts with a common part shared by all address
        families:</p>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="structdef">
              <table class="structdef" style="border-collapse: collapse;">
                <colgroup span="1">
                  <col class="c1" span="1" />
                  <col class="c2" span="1" />
                  <col class="c3" span="1" />
                  <col class="c4" span="1" />
                  <col class="c5" span="1" />
                </colgroup>
                <tbody>
                  <tr>
                    <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">
                    struct</td>
                    <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1"><span class="structname">sock_diag_req</span> {</td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u8</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>sdiag_family</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u8</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>sdiag_protocol</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">};</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </blockquote>
        </div>
        <p>The fields of this structure are as follows:</p>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><em class="parameter"><code>sdiag_family</code></em></span></dt>
            <dd>
              <p>An address family. It should be set to the
              appropriate <em class="replaceable"><code>AF_*</code></em> constant.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>sdiag_protocol</code></em></span></dt>
            <dd>
              <p>Depends on <em class="parameter"><code>sdiag_family</code></em>. It should
              be set to the appropriate <em class="replaceable"><code>IPPROTO_*</code></em> constant
              for <code class="constant">AF_INET</code> and
              <code class="constant">AF_INET6</code>, and to 0
              otherwise.</p>
            </dd>
          </dl>
        </div>
        <p>If the <em class="replaceable"><code>nlmsg_flags</code></em> field of the
        <span class="emphasis"><em>struct nlmsghdr</em></span>
        header has the <code class="constant">NLM_F_DUMP</code>
        flag set, it means that a list of sockets is being
        requested; otherwise it is a query about an individual
        socket.</p>
      </div>
      <div class="refsect2">
        <a id="sock-diag-7_sect3" name="sock-diag-7_sect3" shape="rect"> </a>
        <h3>Response</h3>
        <p>The response starts with a <span class="emphasis"><em>struct nlmsghdr</em></span> header and is
        followed by an array of objects specific to the address
        family. The array is to be accessed with the standard
        <em class="replaceable"><code>NLMSG_*</code></em> macros
        from the <a class="link" href="../htmlman3/netlink.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">netlink</span>(3)</span></a> API.</p>
        <p>Each object is the NLA (netlink attributes) list that is
        to be accessed with the <em class="replaceable"><code>RTA_*</code></em> macros from <a class="link" href="../htmlman3/rtnetlink.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">rtnetlink</span>(3)</span></a> API.</p>
      </div>
      <div class="refsect2">
        <a id="sock-diag-7_sect4" name="sock-diag-7_sect4" shape="rect"> </a>
        <h3>UNIX domain sockets</h3>
        <p>For UNIX domain sockets the request is represented in
        the following structure:</p>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="structdef">
              <table class="structdef" style="border-collapse: collapse;">
                <colgroup span="1">
                  <col class="c1" span="1" />
                  <col class="c2" span="1" />
                  <col class="c3" span="1" />
                  <col class="c4" span="1" />
                  <col class="c5" span="1" />
                </colgroup>
                <tbody>
                  <tr>
                    <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">
                    struct</td>
                    <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1"><span class="structname">unix_diag_req</span> {</td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u8</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>sdiag_family</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u8</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>sdiag_protocol</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u16</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>pad</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u32</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>udiag_states</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u32</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>udiag_ino</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u32</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>udiag_show</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u32</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>udiag_cookie</code></em>[2];</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">};</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </blockquote>
        </div>
        <p>The fields of this structure are as follows:</p>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><em class="parameter"><code>sdiag_family</code></em></span></dt>
            <dd>
              <p>The address family; it should be set to
              <code class="constant">AF_UNIX</code>.</p>
            </dd>
          </dl>
        </div>
        <p><em class="parameter"><code>sdiag_protocol</code></em></p>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><em class="parameter"><code>pad</code></em></span></dt>
            <dd>
              <p>These fields should be set to 0.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>udiag_states</code></em></span></dt>
            <dd>
              <p>This is a bit mask that defines a filter of
              sockets states. Only those sockets whose states are
              in this mask will be reported. Ignored when querying
              for an individual socket. Supported values are:</p>
            </dd>
          </dl>
        </div>
        <div class="blockquote">
          <blockquote class="blockquote">
            <p>1 &lt;&lt; <code class="constant">TCP_ESTABLISHED</code></p>
            <p>1 &lt;&lt; <code class="constant">TCP_LISTEN</code></p>
          </blockquote>
        </div>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><em class="parameter"><code>udiag_ino</code></em></span></dt>
            <dd>
              <p>This is an inode number when querying for an
              individual socket. Ignored when querying for a list
              of sockets.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>udiag_show</code></em></span></dt>
            <dd>
              <p>This is a set of flags defining what kind of
              information to report. Each requested kind of
              information is reported back as a netlink attribute
              as described below:</p>
              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="variablelist">
                    <dl class="variablelist">
                      <dt><span class="term"><code class="constant">UDIAG_SHOW_NAME</code></span></dt>
                      <dd>
                        <p>The attribute reported in answer to this
                        request is <code class="constant">UNIX_DIAG_NAME</code>. The
                        payload associated with this attribute is
                        the pathname to which the socket was bound
                        (a sequence of bytes up to <code class="constant">UNIX_PATH_MAX</code>
                        length).</p>
                      </dd>
                      <dt><span class="term"><code class="constant">UDIAG_SHOW_VFS</code></span></dt>
                      <dd>
                        <p>The attribute reported in answer to this
                        request is <code class="constant">UNIX_DIAG_VFS</code>. The
                        payload associated with this attribute is
                        represented in the following structure:</p>
                        <div class="blockquote">
                          <blockquote class="blockquote">
                            <div class="structdef">
                              <table class="structdef" style="border-collapse: collapse;">
                                <colgroup span="1">
                                  <col class="c1" span="1" />
                                  <col class="c2" span="1" />
                                  <col class="c3" span="1" />
                                  <col class="c4" span="1" />
                                  <col class="c5" span="1" />
                                </colgroup>
                                <tbody>
                                  <tr>
                                    <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">struct</td>
                                    <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1">
                                    <span class="structname">unix_diag_vfs</span> {</td>
                                  </tr>
                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">__u32</span></td>
                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>udiag_vfs_dev</code></em>;</td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>
                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">__u32</span></td>
                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>udiag_vfs_ino</code></em>;</td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>
                                  <tr>
                                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">
                                    };</td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                          </blockquote>
                        </div>
                        <p>The fields of this structure are as
                        follows:</p>
                        <div class="blockquote">
                          <blockquote class="blockquote">
                            <div class="variablelist">
                              <dl class="variablelist">
                                <dt><span class="term"><em class="parameter"><code>udiag_vfs_dev</code></em></span></dt>
                                <dd>
                                  <p>The device number of the
                                  corresponding on-disk socket
                                  inode.</p>
                                </dd>
                                <dt><span class="term"><em class="parameter"><code>udiag_vfs_ino</code></em></span></dt>
                                <dd>
                                  <p>The inode number of the
                                  corresponding on-disk socket
                                  inode.</p>
                                </dd>
                              </dl>
                            </div>
                          </blockquote>
                        </div>
                      </dd>
                      <dt><span class="term"><code class="constant">UDIAG_SHOW_PEER</code></span></dt>
                      <dd>
                        <p>The attribute reported in answer to this
                        request is <code class="constant">UNIX_DIAG_PEER</code>. The
                        payload associated with this attribute is a
                        __u32 value which is the peer's inode
                        number. This attribute is reported for
                        connected sockets only.</p>
                      </dd>
                      <dt><span class="term"><code class="constant">UDIAG_SHOW_ICONS</code></span></dt>
                      <dd>
                        <p>The attribute reported in answer to this
                        request is <code class="constant">UNIX_DIAG_ICONS</code>. The
                        payload associated with this attribute is
                        an array of __u32 values which are inode
                        numbers of sockets that has passed the
                        <a class="link" href="../htmlman2/connect.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">connect</span>(2)</span></a>
                        call, but hasn't been processed with
                        <a class="link" href="../htmlman2/accept.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">accept</span>(2)</span></a>
                        yet. This attribute is reported for
                        listening sockets only.</p>
                      </dd>
                      <dt><span class="term"><code class="constant">UDIAG_SHOW_RQLEN</code></span></dt>
                      <dd>
                        <p>The attribute reported in answer to this
                        request is <code class="constant">UNIX_DIAG_RQLEN</code>. The
                        payload associated with this attribute is
                        represented in the following structure:</p>
                        <div class="blockquote">
                          <blockquote class="blockquote">
                            <div class="structdef">
                              <table class="structdef" style="border-collapse: collapse;">
                                <colgroup span="1">
                                  <col class="c1" span="1" />
                                  <col class="c2" span="1" />
                                  <col class="c3" span="1" />
                                  <col class="c4" span="1" />
                                  <col class="c5" span="1" />
                                </colgroup>
                                <tbody>
                                  <tr>
                                    <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">struct</td>
                                    <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1">
                                    <span class="structname">unix_diag_rqlen</span> {</td>
                                  </tr>
                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">__u32</span></td>
                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>udiag_rqueue</code></em>;</td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>
                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">__u32</span></td>
                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>udiag_wqueue</code></em>;</td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>
                                  <tr>
                                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">
                                    };</td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                          </blockquote>
                        </div>
                        <p>The fields of this structure are as
                        follows:</p>
                        <div class="blockquote">
                          <blockquote class="blockquote">
                            <div class="variablelist">
                              <dl class="variablelist">
                                <dt><span class="term"><em class="parameter"><code>udiag_rqueue</code></em></span></dt>
                                <dd>
                                  <p>For listening sockets: the
                                  number of pending connections.
                                  The length of the array
                                  associated with the <code class="constant">UNIX_DIAG_ICONS</code>
                                  response attribute is equal to
                                  this value.</p>
                                  <p>For established sockets: the
                                  amount of data in incoming
                                  queue.</p>
                                </dd>
                                <dt><span class="term"><em class="parameter"><code>udiag_wqueue</code></em></span></dt>
                                <dd>
                                  <p>For listening sockets: the
                                  backlog length which equals to
                                  the value passed as the second
                                  argument to <a class="link" href="../htmlman2/listen.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">listen</span>(2)</span></a>.</p>
                                  <p>For established sockets: the
                                  amount of memory available for
                                  sending.</p>
                                </dd>
                              </dl>
                            </div>
                          </blockquote>
                        </div>
                      </dd>
                      <dt><span class="term"><code class="constant">UDIAG_SHOW_MEMINFO</code></span></dt>
                      <dd>
                        <p>The attribute reported in answer to this
                        request is <code class="constant">UNIX_DIAG_MEMINFO</code>. The
                        payload associated with this attribute is
                        an array of __u32 values described below in
                        the subsection "Socket memory
                        information".</p>
                      </dd>
                    </dl>
                  </div>
                  <p>The following attributes are reported back
                  without any specific request:</p>
                  <div class="variablelist">
                    <dl class="variablelist">
                      <dt><span class="term"><code class="constant">UNIX_DIAG_SHUTDOWN</code></span></dt>
                      <dd>
                        <p>The payload associated with this
                        attribute is __u8 value which represents
                        bits of <a class="link" href="../htmlman2/shutdown.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">shutdown</span>(2)</span></a>
                        state.</p>
                      </dd>
                    </dl>
                  </div>
                </blockquote>
              </div>
            </dd>
            <dt><span class="term"><em class="parameter"><code>udiag_cookie</code></em></span></dt>
            <dd>
              <p>This is an array of opaque identifiers that could
              be used along with <em class="parameter"><code>udiag_ino</code></em> to specify an
              individual socket. It is ignored when querying for a
              list of sockets, as well as when all its elements are
              set to −1.</p>
            </dd>
          </dl>
        </div>
        <p>The response to a query for UNIX domain sockets is
        represented as an array of</p>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="structdef">
              <table class="structdef" style="border-collapse: collapse;">
                <colgroup span="1">
                  <col class="c1" span="1" />
                  <col class="c2" span="1" />
                  <col class="c3" span="1" />
                  <col class="c4" span="1" />
                  <col class="c5" span="1" />
                </colgroup>
                <tbody>
                  <tr>
                    <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">
                    struct</td>
                    <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1"><span class="structname">unix_diag_msg</span> {</td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u8</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>udiag_family</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u8</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>udiag_type</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u8</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>udiag_state</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u8</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>pad</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u32</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>udiag_ino</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u32</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>udiag_cookie</code></em>[2];</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">};</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </blockquote>
        </div>
        <p>followed by netlink attributes.</p>
        <p>The fields of this structure are as follows:</p>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><em class="parameter"><code>udiag_family</code></em></span></dt>
            <dd>
              <p>This field has the same meaning as in <span class="emphasis"><em>struct unix_diag_req</em></span>.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>udiag_type</code></em></span></dt>
            <dd>
              <p>This is set to one of <code class="constant">SOCK_PACKET</code>, <code class="constant">SOCK_STREAM</code>, or <code class="constant">SOCK_SEQPACKET</code>.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>udiag_state</code></em></span></dt>
            <dd>
              <p>This is set to one of <code class="constant">TCP_LISTEN</code> or <code class="constant">TCP_ESTABLISHED</code>.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>pad</code></em></span></dt>
            <dd>
              <p>This field is set to 0.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>udiag_ino</code></em></span></dt>
            <dd>
              <p>This is the socket inode number.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>udiag_cookie</code></em></span></dt>
            <dd>
              <p>This is an array of opaque identifiers that could
              be used in subsequent queries.</p>
            </dd>
          </dl>
        </div>
      </div>
      <div class="refsect2">
        <a id="sock-diag-7_sect5" name="sock-diag-7_sect5" shape="rect"> </a>
        <h3>IPv4 and IPv6 sockets</h3>
        <p>For IPv4 and IPv6 sockets, the request is represented in
        the following structure:</p>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="structdef">
              <table class="structdef" style="border-collapse: collapse;">
                <colgroup span="1">
                  <col class="c1" span="1" />
                  <col class="c2" span="1" />
                  <col class="c3" span="1" />
                  <col class="c4" span="1" />
                  <col class="c5" span="1" />
                </colgroup>
                <tbody>
                  <tr>
                    <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">
                    struct</td>
                    <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1"><span class="structname">inet_diag_req_v2</span> {</td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u8</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>sdiag_family</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u8</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>sdiag_protocol</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u8</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>idiag_ext</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u8</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>pad</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u32</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>idiag_states</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">struct inet_diag_sockid</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>id</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">};</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </blockquote>
        </div>
        <p>where <span class="emphasis"><em>struct
        inet_diag_sockid</em></span> is defined as follows:</p>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="structdef">
              <table class="structdef" style="border-collapse: collapse;">
                <colgroup span="1">
                  <col class="c1" span="1" />
                  <col class="c2" span="1" />
                  <col class="c3" span="1" />
                  <col class="c4" span="1" />
                  <col class="c5" span="1" />
                </colgroup>
                <tbody>
                  <tr>
                    <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">
                    struct</td>
                    <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1"><span class="structname">inet_diag_sockid</span> {</td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__be16</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>idiag_sport</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__be16</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>idiag_dport</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__be32</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>idiag_src</code></em>[4];</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__be32</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>idiag_dst</code></em>[4];</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u32</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>idiag_if</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u32</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>idiag_cookie</code></em>[2];</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">};</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </blockquote>
        </div>
        <p>The fields of <span class="emphasis"><em>struct
        inet_diag_req_v2</em></span> are as follows:</p>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><em class="parameter"><code>sdiag_family</code></em></span></dt>
            <dd>
              <p>This should be set to either <code class="constant">AF_INET</code> or <code class="constant">AF_INET6</code> for IPv4 or IPv6 sockets
              respectively.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>sdiag_protocol</code></em></span></dt>
            <dd>
              <p>This should be set to one of <code class="constant">IPPROTO_TCP</code>, <code class="constant">IPPROTO_UDP</code>, or <code class="constant">IPPROTO_UDPLITE</code>.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>idiag_ext</code></em></span></dt>
            <dd>
              <p>This is a set of flags defining what kind of
              extended information to report. Each requested kind
              of information is reported back as a netlink
              attribute as described below:</p>
              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="variablelist">
                    <dl class="variablelist">
                      <dt><span class="term"><code class="constant">INET_DIAG_TOS</code></span></dt>
                      <dd>
                        <p>The payload associated with this
                        attribute is a __u8 value which is the TOS
                        of the socket.</p>
                      </dd>
                      <dt><span class="term"><code class="constant">INET_DIAG_TCLASS</code></span></dt>
                      <dd>
                        <p>The payload associated with this
                        attribute is a __u8 value which is the
                        TClass of the socket. IPv6 sockets only.
                        For LISTEN and CLOSE sockets, this is
                        followed by <code class="constant">INET_DIAG_SKV6ONLY</code>
                        attribute with associated __u8 payload
                        value meaning whether the socket is
                        IPv6-only or not.</p>
                      </dd>
                      <dt><span class="term"><code class="constant">INET_DIAG_MEMINFO</code></span></dt>
                      <dd>
                        <p>The payload associated with this
                        attribute is represented in the following
                        structure:</p>
                        <div class="blockquote">
                          <blockquote class="blockquote">
                            <div class="structdef">
                              <table class="structdef" style="border-collapse: collapse;">
                                <colgroup span="1">
                                  <col class="c1" span="1" />
                                  <col class="c2" span="1" />
                                  <col class="c3" span="1" />
                                  <col class="c4" span="1" />
                                  <col class="c5" span="1" />
                                </colgroup>
                                <tbody>
                                  <tr>
                                    <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">struct</td>
                                    <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1">
                                    <span class="structname">inet_diag_meminfo</span> {</td>
                                  </tr>
                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">__u32</span></td>
                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>idiag_rmem</code></em>;</td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>
                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">__u32</span></td>
                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>idiag_wmem</code></em>;</td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>
                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">__u32</span></td>
                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>idiag_fmem</code></em>;</td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>
                                  <tr>
                                    <td style="" rowspan="1" colspan="1"> </td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <span class="type">__u32</span></td>
                                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1"> </td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                    <em class="structfield"><code>idiag_tmem</code></em>;</td>
                                    <td style="" align="left" rowspan="1" colspan="1">
                                     </td>
                                  </tr>
                                  <tr>
                                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">
                                    };</td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                          </blockquote>
                        </div>
                        <p>The fields of this structure are as
                        follows:</p>
                        <div class="blockquote">
                          <blockquote class="blockquote">
                            <div class="variablelist">
                              <dl class="variablelist">
                                <dt><span class="term"><em class="parameter"><code>idiag_rmem</code></em></span></dt>
                                <dd>
                                  <p>The amount of data in the
                                  receive queue.</p>
                                </dd>
                                <dt><span class="term"><em class="parameter"><code>idiag_wmem</code></em></span></dt>
                                <dd>
                                  <p>The amount of data that is
                                  queued by TCP but not yet
                                  sent.</p>
                                </dd>
                                <dt><span class="term"><em class="parameter"><code>idiag_fmem</code></em></span></dt>
                                <dd>
                                  <p>The amount of memory scheduled
                                  for future use (TCP only).</p>
                                </dd>
                                <dt><span class="term"><em class="parameter"><code>idiag_tmem</code></em></span></dt>
                                <dd>
                                  <p>The amount of data in send
                                  queue.</p>
                                </dd>
                              </dl>
                            </div>
                          </blockquote>
                        </div>
                      </dd>
                      <dt><span class="term"><code class="constant">INET_DIAG_SKMEMINFO</code></span></dt>
                      <dd>
                        <p>The payload associated with this
                        attribute is an array of __u32 values
                        described below in the subsection "Socket
                        memory information".</p>
                      </dd>
                      <dt><span class="term"><code class="constant">INET_DIAG_INFO</code></span></dt>
                      <dd>
                        <p>The payload associated with this
                        attribute is specific to the address
                        family. For TCP sockets, it is an object of
                        type <span class="emphasis"><em>struct
                        tcp_info</em></span>.</p>
                      </dd>
                      <dt><span class="term"><code class="constant">INET_DIAG_CONG</code></span></dt>
                      <dd>
                        <p>The payload associated with this
                        attribute is a string that describes the
                        congestion control algorithm used. For TCP
                        sockets only.</p>
                      </dd>
                    </dl>
                  </div>
                </blockquote>
              </div>
            </dd>
            <dt><span class="term"><em class="parameter"><code>pad</code></em></span></dt>
            <dd>
              <p>This should be set to 0.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>idiag_states</code></em></span></dt>
            <dd>
              <p>This is a bit mask that defines a filter of socket
              states. Only those sockets whose states are in this
              mask will be reported. Ignored when querying for an
              individual socket.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>id</code></em></span></dt>
            <dd>
              <p>This is a socket ID object that is used in dump
              requests, in queries about individual sockets, and is
              reported back in each response. Unlike UNIX domain
              sockets, IPv4 and IPv6 sockets are identified using
              addresses and ports. All values are in network byte
              order.</p>
            </dd>
          </dl>
        </div>
        <p>The fields of <span class="emphasis"><em>struct
        inet_diag_sockid</em></span> are as follows:</p>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><em class="parameter"><code>idiag_sport</code></em></span></dt>
            <dd>
              <p>The source port.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>idiag_dport</code></em></span></dt>
            <dd>
              <p>The destination port.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>idiag_src</code></em></span></dt>
            <dd>
              <p>The source address.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>idiag_dst</code></em></span></dt>
            <dd>
              <p>The destination address.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>idiag_if</code></em></span></dt>
            <dd>
              <p>The interface number the socket is bound to.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>idiag_cookie</code></em></span></dt>
            <dd>
              <p>This is an array of opaque identifiers that could
              be used along with other fields of this structure to
              specify an individual socket. It is ignored when
              querying for a list of sockets, as well as when all
              its elements are set to −1.</p>
            </dd>
          </dl>
        </div>
        <p>The response to a query for IPv4 or IPv6 sockets is
        represented as an array of</p>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="structdef">
              <table class="structdef" style="border-collapse: collapse;">
                <colgroup span="1">
                  <col class="c1" span="1" />
                  <col class="c2" span="1" />
                  <col class="c3" span="1" />
                  <col class="c4" span="1" />
                  <col class="c5" span="1" />
                </colgroup>
                <tbody>
                  <tr>
                    <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">
                    struct</td>
                    <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1"><span class="structname">inet_diag_msg</span> {</td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u8</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>idiag_family</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u8</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>idiag_state</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u8</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>idiag_timer</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u8</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>idiag_retrans</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">struct inet_diag_sockid</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>id</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u32</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>idiag_expires</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u32</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>idiag_rqueue</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u32</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>idiag_wqueue</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u32</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>idiag_uid</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u32</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>idiag_inode</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1"> </td>
                  </tr>
                  <tr>
                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">};</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </blockquote>
        </div>
        <p>followed by netlink attributes.</p>
        <p>The fields of this structure are as follows:</p>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><em class="parameter"><code>idiag_family</code></em></span></dt>
            <dd>
              <p>This is the same field as in <span class="emphasis"><em>struct
              inet_diag_req_v2</em></span>.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>idiag_state</code></em></span></dt>
            <dd>
              <p>This denotes socket state as in <span class="emphasis"><em>struct
              inet_diag_req_v2</em></span>.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>idiag_timer</code></em></span></dt>
            <dd>
              <p>For TCP sockets, this field describes the type of
              timer that is currently active for the socket. It is
              set to one of the following constants:</p>
              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="variablelist">
                    <dl class="variablelist">
                      <dt><span class="term"><code class="constant">0</code></span></dt>
                      <dd>
                        <p>no timer is active</p>
                      </dd>
                      <dt><span class="term"><code class="constant">1</code></span></dt>
                      <dd>
                        <p>a retransmit timer</p>
                      </dd>
                      <dt><span class="term"><code class="constant">2</code></span></dt>
                      <dd>
                        <p>a keep-alive timer</p>
                      </dd>
                      <dt><span class="term"><code class="constant">3</code></span></dt>
                      <dd>
                        <p>a TIME_WAIT timer</p>
                      </dd>
                      <dt><span class="term"><code class="constant">4</code></span></dt>
                      <dd>
                        <p>a zero window probe timer</p>
                      </dd>
                    </dl>
                  </div>
                </blockquote>
              </div>
              <p>For non-TCP sockets, this field is set to 0.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>idiag_retrans</code></em></span></dt>
            <dd>
              <p>For <em class="parameter"><code>idiag_timer</code></em> values 1,
              2, and 4, this field contains the number of
              retransmits. For other <em class="parameter"><code>idiag_timer</code></em> values,
              this field is set to 0.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>idiag_expires</code></em></span></dt>
            <dd>
              <p>For TCP sockets that have an active timer, this
              field describes its expiration time in milliseconds.
              For other sockets, this field is set to 0.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>idiag_rqueue</code></em></span></dt>
            <dd>
              <p>For listening sockets: the number of pending
              connections.</p>
              <p>For other sockets: the amount of data in the
              incoming queue.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>idiag_wqueue</code></em></span></dt>
            <dd>
              <p>For listening sockets: the backlog length.</p>
              <p>For other sockets: the amount of memory available
              for sending.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>idiag_uid</code></em></span></dt>
            <dd>
              <p>This is the socket owner UID.</p>
            </dd>
            <dt><span class="term"><em class="parameter"><code>idiag_inode</code></em></span></dt>
            <dd>
              <p>This is the socket inode number.</p>
            </dd>
          </dl>
        </div>
      </div>
      <div class="refsect2">
        <a id="sock-diag-7_sect6" name="sock-diag-7_sect6" shape="rect"> </a>
        <h3>Socket memory information</h3>
        <p>The payload associated with <code class="constant">UNIX_DIAG_MEMINFO</code> and <code class="constant">INET_DIAG_SKMEMINFO</code> netlink attributes is
        an array of the following __u32 values:</p>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><code class="constant">SK_MEMINFO_RMEM_ALLOC</code></span></dt>
            <dd>
              <p>The amount of data in receive queue.</p>
            </dd>
            <dt><span class="term"><code class="constant">SK_MEMINFO_RCVBUF</code></span></dt>
            <dd>
              <p>The receive socket buffer as set by <code class="constant">SO_RCVBUF</code>.</p>
            </dd>
            <dt><span class="term"><code class="constant">SK_MEMINFO_WMEM_ALLOC</code></span></dt>
            <dd>
              <p>The amount of data in send queue.</p>
            </dd>
            <dt><span class="term"><code class="constant">SK_MEMINFO_SNDBUF</code></span></dt>
            <dd>
              <p>The send socket buffer as set by <code class="constant">SO_SNDBUF</code>.</p>
            </dd>
            <dt><span class="term"><code class="constant">SK_MEMINFO_FWD_ALLOC</code></span></dt>
            <dd>
              <p>The amount of memory scheduled for future use (TCP
              only).</p>
            </dd>
            <dt><span class="term"><code class="constant">SK_MEMINFO_WMEM_QUEUED</code></span></dt>
            <dd>
              <p>The amount of data queued by TCP, but not yet
              sent.</p>
            </dd>
            <dt><span class="term"><code class="constant">SK_MEMINFO_OPTMEM</code></span></dt>
            <dd>
              <p>The amount of memory allocated for the socket's
              service needs (e.g., socket filter).</p>
            </dd>
            <dt><span class="term"><code class="constant">SK_MEMINFO_BACKLOG</code></span></dt>
            <dd>
              <p>The amount of packets in the backlog (not yet
              processed).</p>
            </dd>
          </dl>
        </div>
      </div>
    </div>
    <div class="refsect1">
      <a id="sock-diag-7_sect7" name="sock-diag-7_sect7" shape="rect"> </a>
      <h2>VERSIONS</h2>
      <p><code class="constant">NETLINK_INET_DIAG</code> was
      introduced in Linux 2.6.14 and supported <code class="constant">AF_INET</code> and <code class="constant">AF_INET6</code> sockets only. In Linux 3.3, it was
      renamed to <em class="parameter"><code>NETLINK_SOCK_DIAG</code></em> and extended
      to support <code class="constant">AF_UNIX</code> sockets.</p>
      <p><code class="constant">UNIX_DIAG_MEMINFO</code> and
      <code class="constant">INET_DIAG_SKMEMINFO</code> were
      introduced in Linux 3.6.</p>
    </div>
    <div class="refsect1">
      <a id="sock-diag-7_sect8" name="sock-diag-7_sect8" shape="rect"> </a>
      <h2>CONFORMING TO</h2>
      <p>The NETLINK_SOCK_DIAG API is Linux-specific.</p>
    </div>
    <div class="refsect1">
      <a id="sock-diag-7_sect9" name="sock-diag-7_sect9" shape="rect"> </a>
      <h2>EXAMPLES</h2>
      <p>The following example program prints inode number, peer's
      inode number, and name of all UNIX domain sockets in the
      current namespace.</p>
      <div class="informalexample">
        <pre class="programlisting" xml:space="preserve">
#include &lt;errno.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;sys/un.h&gt;
#include &lt;linux/netlink.h&gt;
#include &lt;linux/rtnetlink.h&gt;
#include &lt;linux/sock_diag.h&gt;
#include &lt;linux/unix_diag.h&gt;

static int
send_query(int fd)
{
    struct sockaddr_nl nladdr = {
        .nl_family = AF_NETLINK
    };
    struct
    {
        struct nlmsghdr nlh;
        struct unix_diag_req udr;
    } req = {
        .nlh = {
            .nlmsg_len = sizeof(req),
            .nlmsg_type = SOCK_DIAG_BY_FAMILY,
            .nlmsg_flags = NLM_F_REQUEST | NLM_F_DUMP
        },
        .udr = {
            .sdiag_family = AF_UNIX,
            .udiag_states = −1,
            .udiag_show = UDIAG_SHOW_NAME | UDIAG_SHOW_PEER
        }
    };
    struct iovec iov = {
        .iov_base = &amp;req,
        .iov_len = sizeof(req)
    };
    struct msghdr msg = {
        .msg_name = &amp;nladdr,
        .msg_namelen = sizeof(nladdr),
        .msg_iov = &amp;iov,
        .msg_iovlen = 1
    };

    for (;;) {
        if (sendmsg(fd, &amp;msg, 0) &lt; 0) {
            if (errno == EINTR)
                continue;

            perror("sendmsg");
            return −1;
        }

        return 0;
    }
}

static int
print_diag(const struct unix_diag_msg *diag, unsigned int len)
{
    if (len &lt; NLMSG_LENGTH(sizeof(*diag))) {
        fputs("short response\n", stderr);
        return −1;
    }
    if (diag−&gt;udiag_family != AF_UNIX) {
        fprintf(stderr, "unexpected family %u\n", diag−&gt;udiag_family);
        return −1;
    }

    unsigned int rta_len = len − NLMSG_LENGTH(sizeof(*diag));
    unsigned int peer = 0;
    size_t path_len = 0;
    char path[sizeof(((struct sockaddr_un *) 0)−&gt;sun_path) + 1];

    for (struct rtattr *attr = (struct rtattr *) (diag + 1);
             RTA_OK(attr, rta_len); attr = RTA_NEXT(attr, rta_len)) {
        switch (attr−&gt;rta_type) {
        case UNIX_DIAG_NAME:
            if (!path_len) {
                path_len = RTA_PAYLOAD(attr);
                if (path_len &gt; sizeof(path) − 1)
                    path_len = sizeof(path) − 1;
                memcpy(path, RTA_DATA(attr), path_len);
                path[path_len] = '\0';
            }
            break;

        case UNIX_DIAG_PEER:
            if (RTA_PAYLOAD(attr) &gt;= sizeof(peer))
                peer = *(unsigned int *) RTA_DATA(attr);
            break;
        }
    }

    printf("inode=%u", diag−&gt;udiag_ino);

    if (peer)
        printf(", peer=%u", peer);

    if (path_len)
        printf(", name=%s%s", *path ? "" : "@",
                *path ? path : path + 1);

    putchar('\n');
    return 0;
}

static int
receive_responses(int fd)
{
    long buf[8192 / sizeof(long)];
    struct sockaddr_nl nladdr;
    struct iovec iov = {
        .iov_base = buf,
        .iov_len = sizeof(buf)
    };
    int flags = 0;

    for (;;) {
        struct msghdr msg = {
            .msg_name = &amp;nladdr,
            .msg_namelen = sizeof(nladdr),
            .msg_iov = &amp;iov,
            .msg_iovlen = 1
        };

        ssize_t ret = recvmsg(fd, &amp;msg, flags);

        if (ret &lt; 0) {
            if (errno == EINTR)
                continue;

            perror("recvmsg");
            return −1;
        }
        if (ret == 0)
            return 0;

        if (nladdr.nl_family != AF_NETLINK) {
            fputs("!AF_NETLINK\n", stderr);
            return −1;
        }

        const struct nlmsghdr *h = (struct nlmsghdr *) buf;

        if (!NLMSG_OK(h, ret)) {
            fputs("!NLMSG_OK\n", stderr);
            return −1;
        }

        for (; NLMSG_OK(h, ret); h = NLMSG_NEXT(h, ret)) {
            if (h−&gt;nlmsg_type == NLMSG_DONE)
                return 0;

            if (h−&gt;nlmsg_type == NLMSG_ERROR) {
                const struct nlmsgerr *err = NLMSG_DATA(h);

                if (h−&gt;nlmsg_len &lt; NLMSG_LENGTH(sizeof(*err))) {
                    fputs("NLMSG_ERROR\n", stderr);
                } else {
                    errno = −err−&gt;error;
                    perror("NLMSG_ERROR");
                }

                return −1;
            }

            if (h−&gt;nlmsg_type != SOCK_DIAG_BY_FAMILY) {
                fprintf(stderr, "unexpected nlmsg_type %u\n",
                        (unsigned) h−&gt;nlmsg_type);
                return −1;
            }

            if (print_diag(NLMSG_DATA(h), h−&gt;nlmsg_len))
                return −1;
        }
    }
}

int
main(void)
{
    int fd = socket(AF_NETLINK, SOCK_RAW, NETLINK_SOCK_DIAG);

    if (fd &lt; 0) {
        perror("socket");
        return 1;
    }

    int ret = send_query(fd) || receive_responses(fd);

    close(fd);
    return ret;
}
</pre>
      </div>
    </div>
    <div class="refsect1">
      <a id="sock-diag-7_sect10" name="sock-diag-7_sect10" shape="rect"> </a>
      <h2>SEE ALSO</h2>
      <p><a class="link" href="../htmlman3/netlink.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">netlink</span>(3)</span></a>, <a class="link" href="../htmlman3/rtnetlink.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">rtnetlink</span>(3)</span></a>, <a class="link" href="../htmlman7/netlink.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">netlink</span>(7)</span></a>, <a class="link" href="../htmlman7/tcp.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">tcp</span>(7)</span></a></p>
    </div>
    <div class="colophon">
      <a id="sock-diag-7_sect11" name="sock-diag-7_sect11" shape="rect"> </a>
      <h2>COLOPHON</h2>
      <p>This page is part of release 5.11 of the Linux <em class="replaceable"><code>man-pages</code></em> project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      https://www.kernel.org/doc/man−pages/.</p>
      <div class="license">
        <table class="license" style="border-collapse: collapse;">
          <colgroup span="1">
            <col span="1" />
          </colgroup>
          <tbody>
            <tr>
              <td style="" rowspan="1" colspan="1">
                <div class="literallayout">
                  <br />
                    Copyright (c) 2016 Pavel Emelyanov &lt;xemul<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>virtuozzo.com&gt;<br />

                  Copyright (c) 2016 Dmitry V. Levin &lt;ldv<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>altlinux.org&gt;<br />

                  <br />
                  %%%LICENSE_START(GPLv2+_DOC_FULL)<br />
                  This is free documentation; you can redistribute it and/or<br />

                  modify it under the terms of the GNU General Public License as<br />

                  published by the Free Software Foundation; either version 2 of<br />

                  the License, or (at your option) any later version.<br />

                  <br />
                  The GNU General Public License's references to "object code"<br />

                  and "executables" are to be interpreted as the output of any<br />

                  document formatting or typesetting system, including<br />

                  intermediate and printed output.<br />

                  <br />
                  This manual is distributed in the hope that it will be useful,<br />

                  but WITHOUT ANY WARRANTY; without even the implied warranty of<br />

                  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the<br />

                  GNU General Public License for more details.<br />

                  <br />
                  You should have received a copy of the GNU General Public<br />

                  License along with this manual; if not, see<br />

                  &lt;<a class="literalurl" href="http://www.gnu.org/licenses/" target="_top" shape="rect">http://www.gnu.org/licenses/</a>&gt;.<br />

                  %%%LICENSE_END<br />
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</body>
</html>
