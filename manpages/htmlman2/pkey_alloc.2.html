<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>pkey_alloc(2) — Linux manual pages</title>
  <link rel="stylesheet" type="text/css" href="../stylesheet/manpages.css" />
  
  <link rel="home" href="../index.html" title="pkey_alloc(2) — Linux manual pages" />
  <script type="text/javascript" src="../stylesheet/manpages.js" xml:space="preserve"> </script>
  <link rel="icon" href="../stylesheet/icon.gif" type="image/gif" />
</head>
<body onload="javascript:init()">
  <div class="navheader">
    <table width="100%">
      <tbody>
        <tr>
          <td style="width: 33%" rowspan="1" colspan="1"><a href="../index.html" shape="rect">Linux
          manual pages</a></td>
          <th rowspan="1" colspan="1"><a href="../index2.html" shape="rect">Section 2</a></th>
          <td style="width: 33%" rowspan="1" colspan="1"> </td>
        </tr>
      </tbody>
    </table>
    <hr />
  </div>
  <div class="refentry">
    <a id="pkey-alloc.2" name="pkey-alloc.2" shape="rect"> </a>
    <div class="titlepage"> </div>
    <div class="refnamediv">
      <h2>Name</h2>
      <p>pkey_alloc, pkey_free — allocate or free a
      protection key</p>
    </div>
    <div class="refsynopsisdiv">
      <h2>Synopsis</h2>
      <div class="informalexample">
        <pre class="programlisting" xml:space="preserve">
#define _GNU_SOURCE              /* See feature_test_macros(7) */
#include &lt;sys/mman.h&gt;</pre>
      </div>
      <div class="funcsynopsis">
        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">int
            <strong>pkey_alloc</strong>(</code></td>
            <td rowspan="1" colspan="1">unsigned int <var class="pdparam">flags</var>,</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1"> </td>
            <td rowspan="1" colspan="1">unsigned int <var class="pdparam">access_rights</var><code>)</code>;</td>
          </tr>
        </table>
        <div class="funcprototype-spacer">
           
        </div>
      </div>
      <div class="funcsynopsis">
        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">int
            <strong>pkey_free</strong>(</code></td>
            <td rowspan="1" colspan="1">int <var class="pdparam">pkey</var><code>)</code>;</td>
          </tr>
        </table>
        <div class="funcprototype-spacer">
           
        </div>
      </div>
    </div>
    <div class="refsect1">
      <a id="pkey-alloc-2_sect1" name="pkey-alloc-2_sect1" shape="rect"> </a>
      <h2>DESCRIPTION</h2>
      <p><code class="function">pkey_alloc</code>() allocates a
      protection key (pkey) and allows it to be passed to <a class="link" href="../htmlman2/mprotect.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">pkey_mprotect</span>(2)</span></a>.</p>
      <p>The <code class="function">pkey_alloc</code>() <em class="parameter"><code>flags</code></em> is reserved for future
      use and currently must always be specified as 0.</p>
      <p>The <code class="function">pkey_alloc</code>() <em class="parameter"><code>access_rights</code></em> argument may
      contain zero or more disable operations:</p>
      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><code class="constant">PKEY_DISABLE_ACCESS</code></span></dt>
          <dd>
            <p>Disable all data access to memory covered by the
            returned protection key.</p>
          </dd>
          <dt><span class="term"><code class="constant">PKEY_DISABLE_WRITE</code></span></dt>
          <dd>
            <p>Disable write access to memory covered by the
            returned protection key.</p>
          </dd>
        </dl>
      </div>
      <p><code class="function">pkey_free</code>() frees a
      protection key and makes it available for later allocations.
      After a protection key has been freed, it may no longer be
      used in any protection-key-related operations.</p>
      <p>An application should not call <code class="function">pkey_free</code>() on any protection key which has
      been assigned to an address range by <a class="link" href="../htmlman2/mprotect.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">pkey_mprotect</span>(2)</span></a> and which
      is still in use. The behavior in this case is undefined and
      may result in an error.</p>
    </div>
    <div class="refsect1">
      <a id="pkey-alloc-2_sect2" name="pkey-alloc-2_sect2" shape="rect"> </a>
      <h2>RETURN VALUE</h2>
      <p>On success, <code class="function">pkey_alloc</code>()
      returns a positive protection key value. On success,
      <code class="function">pkey_free</code>() returns zero. On
      error, −1 is returned, and <code class="varname">errno</code> is set to indicate the error.</p>
    </div>
    <div class="refsect1">
      <a id="pkey-alloc-2_sect3" name="pkey-alloc-2_sect3" shape="rect"> </a>
      <h2>ERRORS</h2>
      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><span class="errorname">EINVAL</span></span></dt>
          <dd>
            <p><em class="parameter"><code>pkey</code></em>,
            <em class="parameter"><code>flags</code></em>, or
            <em class="parameter"><code>access_rights</code></em>
            is invalid.</p>
          </dd>
          <dt><span class="term"><span class="errorname">ENOSPC</span></span></dt>
          <dd>
            <p>(<code class="function">pkey_alloc</code>()) All
            protection keys available for the current process have
            been allocated. The number of keys available is
            architecture-specific and implementation-specific and
            may be reduced by kernel-internal use of certain keys.
            There are currently 15 keys available to user programs
            on x86.</p>
            <p>This error will also be returned if the processor or
            operating system does not support protection keys.
            Applications should always be prepared to handle this
            error, since factors outside of the application's
            control can reduce the number of available pkeys.</p>
          </dd>
        </dl>
      </div>
    </div>
    <div class="refsect1">
      <a id="pkey-alloc-2_sect4" name="pkey-alloc-2_sect4" shape="rect"> </a>
      <h2>VERSIONS</h2>
      <p><code class="function">pkey_alloc</code>() and
      <code class="function">pkey_free</code>() were added to Linux
      in kernel 4.9; library support was added in glibc 2.27.</p>
    </div>
    <div class="refsect1">
      <a id="pkey-alloc-2_sect5" name="pkey-alloc-2_sect5" shape="rect"> </a>
      <h2>CONFORMING TO</h2>
      <p>The <code class="function">pkey_alloc</code>() and
      <code class="function">pkey_free</code>() system calls are
      Linux-specific.</p>
    </div>
    <div class="refsect1">
      <a id="pkey-alloc-2_sect6" name="pkey-alloc-2_sect6" shape="rect"> </a>
      <h2>NOTES</h2>
      <p><code class="function">pkey_alloc</code>() is always safe
      to call regardless of whether or not the operating system
      supports protection keys. It can be used in lieu of any other
      mechanism for detecting pkey support and will simply fail
      with the error <span class="errorname">ENOSPC</span> if the
      operating system has no pkey support.</p>
      <p>The kernel guarantees that the contents of the hardware
      rights register (PKRU) will be preserved only for allocated
      protection keys. Any time a key is unallocated (either before
      the first call returning that key from <code class="function">pkey_alloc</code>() or after it is freed via
      <code class="function">pkey_free</code>()), the kernel may
      make arbitrary changes to the parts of the rights register
      affecting access to that key.</p>
    </div>
    <div class="refsect1">
      <a id="pkey-alloc-2_sect7" name="pkey-alloc-2_sect7" shape="rect"> </a>
      <h2>EXAMPLES</h2>
      <p>See <a class="link" href="../htmlman7/pkeys.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">pkeys</span>(7)</span></a>.</p>
    </div>
    <div class="refsect1">
      <a id="pkey-alloc-2_sect8" name="pkey-alloc-2_sect8" shape="rect"> </a>
      <h2>SEE ALSO</h2>
      <p><a class="link" href="../htmlman2/mprotect.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">pkey_mprotect</span>(2)</span></a>, <a class="link" href="../htmlman7/pkeys.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">pkeys</span>(7)</span></a></p>
    </div>
    <div class="colophon">
      <a id="pkey-alloc-2_sect9" name="pkey-alloc-2_sect9" shape="rect"> </a>
      <h2>COLOPHON</h2>
      <p>This page is part of release 5.11 of the Linux <em class="replaceable"><code>man-pages</code></em> project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      https://www.kernel.org/doc/man−pages/.</p>
      <div class="license">
        <table class="license" style="border-collapse: collapse;">
          <colgroup span="1">
            <col span="1" />
          </colgroup>
          <tbody>
            <tr>
              <td style="" rowspan="1" colspan="1">
                <div class="literallayout">
                  <br />
                    Copyright (C) 2016 Intel Corporation<br />

                  <br />
                  %%%LICENSE_START(VERBATIM)<br />
                  Permission is granted to make and distribute verbatim copies of this<br />

                  manual provided the copyright notice and this permission notice are<br />

                  preserved on all copies.<br />
                  <br />
                  Permission is granted to copy and distribute modified versions of this<br />

                  manual under the conditions for verbatim copying, provided that the<br />

                  entire resulting derived work is distributed under the terms of a<br />

                  permission notice identical to this one.<br />

                  <br />
                  Since the Linux kernel and libraries are constantly changing, this<br />

                  manual page may be incorrect or out-of-date.  The author(s) assume no<br />

                  responsibility for errors or omissions, or for damages resulting from<br />

                  the use of the information contained herein.  The author(s) may not<br />

                  have taken the same level of care in the production of this manual,<br />

                  which is licensed free of charge, as they might when working<br />

                  professionally.<br />
                  <br />
                  Formatted or processed versions of this manual, if unaccompanied by<br />

                  the source, must acknowledge the copyright and author of this work.<br />

                  %%%LICENSE_END<br />
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</body>
</html>
