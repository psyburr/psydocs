<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>seccomp(2) — Linux manual pages</title>
  <link rel="stylesheet" type="text/css" href="../stylesheet/manpages.css" />
  
  <link rel="home" href="../index.html" title="seccomp(2) — Linux manual pages" />
  <script type="text/javascript" src="../stylesheet/manpages.js" xml:space="preserve"> </script>
  <link rel="icon" href="../stylesheet/icon.gif" type="image/gif" />
</head>
<body onload="javascript:init()">
  <div class="navheader">
    <table width="100%">
      <tbody>
        <tr>
          <td style="width: 33%" rowspan="1" colspan="1"><a href="../index.html" shape="rect">Linux
          manual pages</a></td>
          <th rowspan="1" colspan="1"><a href="../index2.html" shape="rect">Section 2</a></th>
          <td style="width: 33%" rowspan="1" colspan="1"> </td>
        </tr>
      </tbody>
    </table>
    <hr />
  </div>
  <div class="refentry">
    <a id="seccomp.2" name="seccomp.2" shape="rect"> </a>
    <div class="titlepage"> </div>
    <div class="refnamediv">
      <h2>Name</h2>
      <p>seccomp — operate on Secure Computing state of the
      process</p>
    </div>
    <div class="refsynopsisdiv">
      <h2>Synopsis</h2>
      <div class="informalexample">
        <pre class="programlisting" xml:space="preserve">
#include &lt;linux/seccomp.h&gt;
#include &lt;linux/filter.h&gt;
#include &lt;linux/audit.h&gt;
#include &lt;linux/signal.h&gt;
#include &lt;sys/ptrace.h&gt;</pre>
      </div>
      <div class="funcsynopsis">
        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">int
            <strong>seccomp</strong>(</code></td>
            <td rowspan="1" colspan="1">unsigned int <var class="pdparam">operation</var>,</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1"> </td>
            <td rowspan="1" colspan="1">unsigned int <var class="pdparam">flags</var>,</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1"> </td>
            <td rowspan="1" colspan="1">void *<var class="pdparam">args</var><code>)</code>;</td>
          </tr>
        </table>
        <div class="funcprototype-spacer">
           
        </div>
      </div>
      <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
        <table border="0" summary="Note">
          <tr>
            <td rowspan="2" align="center" valign="top" width="25" colspan="1">
            <img alt="[Note]" src="../stylesheet/note.png" /></td>
            <th align="left" rowspan="1" colspan="1">Note</th>
          </tr>
          <tr>
            <td align="left" valign="top" rowspan="1" colspan="1">There is no glibc wrapper
            for this system call; see NOTES.</td>
          </tr>
        </table>
      </div>
    </div>
    <div class="refsect1">
      <a id="seccomp-2_sect1" name="seccomp-2_sect1" shape="rect"> </a>
      <h2>DESCRIPTION</h2>
      <p>The <code class="function">seccomp</code>() system call
      operates on the Secure Computing (seccomp) state of the
      calling process.</p>
      <p>Currently, Linux supports the following <em class="parameter"><code>operation</code></em> values:</p>
      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><code class="constant">SECCOMP_SET_MODE_STRICT</code></span></dt>
          <dd>
            <p>The only system calls that the calling thread is
            permitted to make are <a class="link" href="../htmlman2/read.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">read</span>(2)</span></a>, <a class="link" href="../htmlman2/write.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">write</span>(2)</span></a>, <a class="link" href="../htmlman2/_exit.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">_exit</span>(2)</span></a> (but not
            <a class="link" href="../htmlman2/exit_group.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">exit_group</span>(2)</span></a>), and
            <a class="link" href="../htmlman2/sigreturn.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">sigreturn</span>(2)</span></a>. Other
            system calls result in the delivery of a <code class="constant">SIGKILL</code> signal. Strict secure
            computing mode is useful for number-crunching
            applications that may need to execute untrusted byte
            code, perhaps obtained by reading from a pipe or
            socket.</p>
            <p>Note that although the calling thread can no longer
            call <a class="link" href="../htmlman2/sigprocmask.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">sigprocmask</span>(2)</span></a>, it
            can use <a class="link" href="../htmlman2/sigreturn.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">sigreturn</span>(2)</span></a> to block
            all signals apart from <code class="constant">SIGKILL</code> and <code class="constant">SIGSTOP</code>. This means that <a class="link" href="../htmlman2/alarm.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">alarm</span>(2)</span></a> (for
            example) is not sufficient for restricting the
            process's execution time. Instead, to reliably
            terminate the process, <code class="constant">SIGKILL</code> must be used. This can be
            done by using <a class="link" href="../htmlman2/timer_create.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">timer_create</span>(2)</span></a> with
            <code class="constant">SIGEV_SIGNAL</code> and
            <em class="replaceable"><code>sigev_signo</code></em>
            set to <code class="constant">SIGKILL</code>, or by
            using <a class="link" href="../htmlman2/getrlimit.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">setrlimit</span>(2)</span></a> to set
            the hard limit for <code class="constant">RLIMIT_CPU</code>.</p>
            <p>This operation is available only if the kernel is
            configured with <code class="constant">CONFIG_SECCOMP</code> enabled.</p>
            <p>The value of <em class="parameter"><code>flags</code></em> must be 0, and
            <em class="parameter"><code>args</code></em> must be
            NULL.</p>
            <p>This operation is functionally identical to the
            call:</p>
            <div class="blockquote">
              <blockquote class="blockquote">
                <div class="informalexample">
                  <pre class="programlisting" xml:space="preserve">
prctl(PR_SET_SECCOMP, SECCOMP_MODE_STRICT);
</pre>
                </div>
              </blockquote>
            </div>
          </dd>
          <dt><span class="term"><code class="constant">SECCOMP_SET_MODE_FILTER</code></span></dt>
          <dd>
            <p>The system calls allowed are defined by a pointer to
            a Berkeley Packet Filter (BPF) passed via <em class="parameter"><code>args</code></em>. This argument is a
            pointer to a <span class="emphasis"><em>struct
            sock_fprog</em></span>; it can be designed to filter
            arbitrary system calls and system call arguments. If
            the filter is invalid, <code class="function">seccomp</code>() fails, returning
            <span class="errorname">EINVAL</span> in <code class="varname">errno</code>.</p>
            <p>If <a class="link" href="../htmlman2/fork.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fork</span>(2)</span></a> or <a class="link" href="../htmlman2/clone.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">clone</span>(2)</span></a> is allowed
            by the filter, any child processes will be constrained
            to the same system call filters as the parent. If
            <a class="link" href="../htmlman2/execve.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a> is allowed,
            the existing filters will be preserved across a call to
            <a class="link" href="../htmlman2/execve.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a>.</p>
            <p>In order to use the <code class="constant">SECCOMP_SET_MODE_FILTER</code> operation,
            either the calling thread must have the <code class="constant">CAP_SYS_ADMIN</code> capability in its user
            namespace, or the thread must already have the
            <em class="replaceable"><code>no_new_privs</code></em>
            bit set. If that bit was not already set by an ancestor
            of this thread, the thread must make the following
            call:</p>
            <div class="blockquote">
              <blockquote class="blockquote">
                <div class="informalexample">
                  <pre class="programlisting" xml:space="preserve">
prctl(PR_SET_NO_NEW_PRIVS, 1);
</pre>
                </div>
              </blockquote>
            </div>
            <p>Otherwise, the <code class="constant">SECCOMP_SET_MODE_FILTER</code> operation
            fails and returns <span class="errorname">EACCES</span>
            in <code class="varname">errno</code>. This requirement
            ensures that an unprivileged process cannot apply a
            malicious filter and then invoke a set-user-ID or other
            privileged program using <a class="link" href="../htmlman2/execve.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a>, thus
            potentially compromising that program. (Such a
            malicious filter might, for example, cause an attempt
            to use <a class="link" href="../htmlman2/setuid.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">setuid</span>(2)</span></a> to set the
            caller's user IDs to nonzero values to instead return 0
            without actually making the system call. Thus, the
            program might be tricked into retaining superuser
            privileges in circumstances where it is possible to
            influence it to do dangerous things because it did not
            actually drop privileges.)</p>
            <p>If <a class="link" href="../htmlman2/prctl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">prctl</span>(2)</span></a> or
            <code class="function">seccomp</code>() is allowed by
            the attached filter, further filters may be added. This
            will increase evaluation time, but allows for further
            reduction of the attack surface during execution of a
            thread.</p>
            <p>The <code class="constant">SECCOMP_SET_MODE_FILTER</code> operation is
            available only if the kernel is configured with
            <code class="constant">CONFIG_SECCOMP_FILTER</code>
            enabled.</p>
            <p>When <em class="parameter"><code>flags</code></em>
            is 0, this operation is functionally identical to the
            call:</p>
            <div class="blockquote">
              <blockquote class="blockquote">
                <div class="informalexample">
                  <pre class="programlisting" xml:space="preserve">
prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, args);
</pre>
                </div>
              </blockquote>
            </div>
            <p>The recognized <em class="parameter"><code>flags</code></em> are:</p>
            <div class="blockquote">
              <blockquote class="blockquote">
                <div class="variablelist">
                  <dl class="variablelist">
                    <dt><span class="term"><code class="constant">SECCOMP_FILTER_FLAG_TSYNC</code></span></dt>
                    <dd>
                      <p>When adding a new filter, synchronize all
                      other threads of the calling process to the
                      same seccomp filter tree. A "filter tree" is
                      the ordered list of filters attached to a
                      thread. (Attaching identical filters in
                      separate <code class="function">seccomp</code>() calls results in
                      different filters from this perspective.)</p>
                      <p>If any thread cannot synchronize to the
                      same filter tree, the call will not attach
                      the new seccomp filter, and will fail,
                      returning the first thread ID found that
                      cannot synchronize. Synchronization will fail
                      if another thread in the same process is in
                      <code class="constant">SECCOMP_MODE_STRICT</code> or if
                      it has attached new seccomp filters to
                      itself, diverging from the calling thread's
                      filter tree.</p>
                    </dd>
                    <dt><span class="term"><code class="constant">SECCOMP_FILTER_FLAG_LOG</code>
                    (since Linux 4.14)</span></dt>
                    <dd>
                      <p>All filter return actions except
                      <code class="constant">SECCOMP_RET_ALLOW</code> should be
                      logged. An administrator may override this
                      filter flag by preventing specific actions
                      from being logged via the <code class="filename">/proc/sys/kernel/seccomp/actions_logged</code>
                      file.</p>
                    </dd>
                    <dt><span class="term"><code class="constant">SECCOMP_FILTER_FLAG_SPEC_ALLOW</code>
                    (since Linux 4.17)</span></dt>
                    <dd>
                      <p>Disable Speculative Store Bypass
                      mitigation.</p>
                    </dd>
                  </dl>
                </div>
              </blockquote>
            </div>
          </dd>
          <dt><span class="term"><code class="constant">SECCOMP_GET_ACTION_AVAIL</code> (since Linux
          4.14)</span></dt>
          <dd>
            <p>Test to see if an action is supported by the kernel.
            This operation is helpful to confirm that the kernel
            knows of a more recently added filter return action
            since the kernel treats all unknown actions as
            <code class="constant">SECCOMP_RET_KILL_PROCESS</code>.</p>
            <p>The value of <em class="parameter"><code>flags</code></em> must be 0, and
            <em class="parameter"><code>args</code></em> must be a
            pointer to an unsigned 32-bit filter return action.</p>
          </dd>
        </dl>
      </div>
      <div class="refsect2">
        <a id="seccomp-2_sect2" name="seccomp-2_sect2" shape="rect"> </a>
        <h3>Filters</h3>
        <p>When adding filters via <code class="constant">SECCOMP_SET_MODE_FILTER</code>, <em class="parameter"><code>args</code></em> points to a filter
        program:</p>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="structdef">
              <table class="structdef" style="border-collapse: collapse;">
                <colgroup span="1">
                  <col class="c1" span="1" />
                  <col class="c2" span="1" />
                  <col class="c3" span="1" />
                  <col class="c4" span="1" />
                  <col class="c5" span="1" />
                </colgroup>
                <tbody>
                  <tr>
                    <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">
                    struct</td>
                    <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1"><span class="structname">sock_fprog</span> {</td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">unsigned short</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>len</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1">
                      <div class="literallayout">
                        
                        /* Number of BPF instructions */
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">struct sock_filter</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                    *</td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>filter</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1">
                      <div class="literallayout">
                        
                        /* Pointer to array of<br />

                        BPF instructions */
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">};</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </blockquote>
        </div>
        <p>Each program must contain one or more BPF
        instructions:</p>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="structdef">
              <table class="structdef" style="border-collapse: collapse;">
                <colgroup span="1">
                  <col class="c1" span="1" />
                  <col class="c2" span="1" />
                  <col class="c3" span="1" />
                  <col class="c4" span="1" />
                  <col class="c5" span="1" />
                </colgroup>
                <tbody>
                  <tr>
                    <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">
                    struct</td>
                    <td class="structdefhdr" style="" colspan="3" align="left" rowspan="1"><span class="structname">sock_filter</span> {</td>
                    <td class="structdefhdrcomment" style="" align="left" rowspan="1" colspan="1">
                      <div class="literallayout">
                        /* Filter block */
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u16</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>code</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1">
                      <div class="literallayout">
                        
                        /* Actual filter code */
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u8</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>jt</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1">
                      <div class="literallayout">
                        /* Jump true */
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u8</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>jf</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1">
                      <div class="literallayout">
                        /* Jump false */
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u32</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>k</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1">
                      <div class="literallayout">
                        
                        /* Generic multiuse field */
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">};</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </blockquote>
        </div>
        <p>When executing the instructions, the BPF program
        operates on the system call information made available
        (i.e., use the <code class="constant">BPF_ABS</code>
        addressing mode) as a (read-only) buffer of the following
        form:</p>
        <div class="blockquote">
          <blockquote class="blockquote">
            <div class="structdef">
              <table class="structdef" style="border-collapse: collapse;">
                <colgroup span="1">
                  <col class="c1" span="1" />
                  <col class="c2" span="1" />
                  <col class="c3" span="1" />
                  <col class="c4" span="1" />
                  <col class="c5" span="1" />
                </colgroup>
                <tbody>
                  <tr>
                    <td class="structdefhdr" style="" align="left" rowspan="1" colspan="1">
                    struct</td>
                    <td class="structdefhdr" style="" colspan="4" align="left" rowspan="1"><span class="structname">seccomp_data</span> {</td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">int</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>nr</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1">
                      <div class="literallayout">
                        
                        /* System call number */
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u32</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>arch</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1">
                      <div class="literallayout">
                        /* AUDIT_ARCH_* value<br />
                        (see &lt;linux/audit.h&gt;) */
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u64</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>instruction_pointer</code></em>;</td>
                    <td style="" align="left" rowspan="1" colspan="1">
                      <div class="literallayout">
                        
                        /* CPU instruction pointer */
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td style="" rowspan="1" colspan="1"> </td>
                    <td style="" align="left" rowspan="1" colspan="1"><span class="type">__u64</span></td>
                    <td class="norightpad" style="" align="right" rowspan="1" colspan="1">
                     </td>
                    <td style="" align="left" rowspan="1" colspan="1"><em class="structfield"><code>args</code></em>[6];</td>
                    <td style="" align="left" rowspan="1" colspan="1">
                      <div class="literallayout">
                        
                        /* Up to 6 system call arguments */
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td class="structdefftr" style="" colspan="5" align="left" rowspan="1">};</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </blockquote>
        </div>
        <p>Because numbering of system calls varies between
        architectures and some architectures (e.g., x86-64) allow
        user-space code to use the calling conventions of multiple
        architectures (and the convention being used may vary over
        the life of a process that uses <a class="link" href="../htmlman2/execve.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a> to execute
        binaries that employ the different conventions), it is
        usually necessary to verify the value of the <em class="parameter"><code>arch</code></em> field.</p>
        <p>It is strongly recommended to use an allow-list approach
        whenever possible because such an approach is more robust
        and simple. A deny-list will have to be updated whenever a
        potentially dangerous system call is added (or a dangerous
        flag or option if those are deny-listed), and it is often
        possible to alter the representation of a value without
        altering its meaning, leading to a deny-list bypass. See
        also <em class="replaceable"><code>Caveats</code></em>
        below.</p>
        <p>The <em class="parameter"><code>arch</code></em> field
        is not unique for all calling conventions. The x86-64 ABI
        and the x32 ABI both use <code class="constant">AUDIT_ARCH_X86_64</code> as <em class="parameter"><code>arch</code></em>, and they run on the
        same processors. Instead, the mask <code class="constant">__X32_SYSCALL_BIT</code> is used on the system
        call number to tell the two ABIs apart.</p>
        <p>This means that a policy must either deny all syscalls
        with <code class="constant">__X32_SYSCALL_BIT</code> or it
        must recognize syscalls with and without <code class="constant">__X32_SYSCALL_BIT</code> set. A list of system
        calls to be denied based on <em class="parameter"><code>nr</code></em> that does not also contain
        <em class="parameter"><code>nr</code></em> values with
        <code class="constant">__X32_SYSCALL_BIT</code> set can be
        bypassed by a malicious program that sets <code class="constant">__X32_SYSCALL_BIT</code>.</p>
        <p>Additionally, kernels prior to Linux 5.4 incorrectly
        permitted <em class="parameter"><code>nr</code></em> in the
        ranges 512-547 as well as the corresponding non-x32
        syscalls ORed with <code class="constant">__X32_SYSCALL_BIT</code>. For example,
        <em class="parameter"><code>nr</code></em> == 521 and
        <em class="parameter"><code>nr</code></em> == (101 |
        <code class="constant">__X32_SYSCALL_BIT</code>) would
        result in invocations of <a class="link" href="../htmlman2/ptrace.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">ptrace</span>(2)</span></a> with
        potentially confused x32-vs-x86_64 semantics in the kernel.
        Policies intended to work on kernels before Linux 5.4 must
        ensure that they deny or otherwise correctly handle these
        system calls. On Linux 5.4 and newer, such system calls
        will fail with the error <span class="errorname">ENOSYS</span>, without doing anything.</p>
        <p>The <em class="parameter"><code>instruction_pointer</code></em> field
        provides the address of the machine-language instruction
        that performed the system call. This might be useful in
        conjunction with the use of <code class="filename">/proc/[pid]/maps</code> to perform checks based
        on which region (mapping) of the program made the system
        call. (Probably, it is wise to lock down the <a class="link" href="../htmlman2/mmap.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mmap</span>(2)</span></a> and <a class="link" href="../htmlman2/mprotect.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">mprotect</span>(2)</span></a> system calls
        to prevent the program from subverting such checks.)</p>
        <p>When checking values from <em class="parameter"><code>args</code></em>, keep in mind that
        arguments are often silently truncated before being
        processed, but after the seccomp check. For example, this
        happens if the i386 ABI is used on an x86-64 kernel:
        although the kernel will normally not look beyond the 32
        lowest bits of the arguments, the values of the full 64-bit
        registers will be present in the seccomp data. A less
        surprising example is that if the x86-64 ABI is used to
        perform a system call that takes an argument of type
        <span class="type">int</span>, the more-significant half of
        the argument register is ignored by the system call, but
        visible in the seccomp data.</p>
        <p>A seccomp filter returns a 32-bit value consisting of
        two parts: the most significant 16 bits (corresponding to
        the mask defined by the constant <code class="constant">SECCOMP_RET_ACTION_FULL</code>) contain one of
        the "action" values listed below; the least significant
        16-bits (defined by the constant <code class="constant">SECCOMP_RET_DATA</code>) are "data" to be
        associated with this return value.</p>
        <p>If multiple filters exist, they are <em class="replaceable"><code>all</code></em> executed, in reverse
        order of their addition to the filter tree—that is,
        the most recently installed filter is executed first. (Note
        that all filters will be called even if one of the earlier
        filters returns <code class="constant">SECCOMP_RET_KILL</code>. This is done to
        simplify the kernel code and to provide a tiny speed-up in
        the execution of sets of filters by avoiding a check for
        this uncommon case.) The return value for the evaluation of
        a given system call is the first-seen action value of
        highest precedence (along with its accompanying data)
        returned by execution of all of the filters.</p>
        <p>In decreasing order of precedence, the action values
        that may be returned by a seccomp filter are:</p>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><code class="constant">SECCOMP_RET_KILL_PROCESS</code> (since Linux
            4.14)</span></dt>
            <dd>
              <p>This value results in immediate termination of the
              process, with a core dump. The system call is not
              executed. By contrast with <code class="constant">SECCOMP_RET_KILL_THREAD</code> below, all
              threads in the thread group are terminated. (For a
              discussion of thread groups, see the description of
              the <code class="constant">CLONE_THREAD</code> flag
              in <a class="link" href="../htmlman2/clone.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">clone</span>(2)</span></a>.)</p>
              <p>The process terminates <span class="emphasis"><em>as though</em></span> killed by a
              <code class="constant">SIGSYS</code> signal. Even if
              a signal handler has been registered for <code class="constant">SIGSYS</code>, the handler will be ignored
              in this case and the process always terminates. To a
              parent process that is waiting on this process (using
              <a class="link" href="../htmlman2/wait.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">waitpid</span>(2)</span></a> or
              similar), the returned <em class="replaceable"><code>wstatus</code></em> will indicate
              that its child was terminated as though by a
              <code class="constant">SIGSYS</code> signal.</p>
            </dd>
            <dt><span class="term"><code class="constant">SECCOMP_RET_KILL_THREAD</code> (or
            <code class="constant">SECCOMP_RET_KILL</code>)</span></dt>
            <dd>
              <p>This value results in immediate termination of the
              thread that made the system call. The system call is
              not executed. Other threads in the same thread group
              will continue to execute.</p>
              <p>The thread terminates <span class="emphasis"><em>as though</em></span> killed by a
              <code class="constant">SIGSYS</code> signal. See
              <code class="constant">SECCOMP_RET_KILL_PROCESS</code> above.</p>
              <p>Before Linux 4.11, any process terminated in this
              way would not trigger a coredump (even though
              <code class="constant">SIGSYS</code> is documented in
              <a class="link" href="../htmlman7/signal.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">signal</span>(7)</span></a> as having
              a default action of termination with a core dump).
              Since Linux 4.11, a single-threaded process will dump
              core if terminated in this way.</p>
              <p>With the addition of <code class="constant">SECCOMP_RET_KILL_PROCESS</code> in Linux
              4.14, <code class="constant">SECCOMP_RET_KILL_THREAD</code> was added
              as a synonym for <code class="constant">SECCOMP_RET_KILL</code>, in order to more
              clearly distinguish the two actions.</p>
              <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
                <table border="0" summary="Note">
                  <tr>
                    <td rowspan="2" align="center" valign="top" width="25" colspan="1"><img alt="[Note]" src="../stylesheet/note.png" /></td>
                    <th align="left" rowspan="1" colspan="1">Note</th>
                  </tr>
                  <tr>
                    <td align="left" valign="top" rowspan="1" colspan="1">
                      <p>the use of <code class="constant">SECCOMP_RET_KILL_THREAD</code> to
                      kill a single thread in a multithreaded
                      process is likely to leave the process in a
                      permanently inconsistent and possibly corrupt
                      state.</p>
                    </td>
                  </tr>
                </table>
              </div>
            </dd>
            <dt><span class="term"><code class="constant">SECCOMP_RET_TRAP</code></span></dt>
            <dd>
              <p>This value results in the kernel sending a
              thread-directed <code class="constant">SIGSYS</code>
              signal to the triggering thread. (The system call is
              not executed.) Various fields will be set in the
              <span class="type">siginfo_t</span> structure (see
              <a class="link" href="../htmlman2/sigaction.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">sigaction</span>(2)</span></a>)
              associated with signal:</p>
              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: disc;">
                      <li class="listitem">
                        <p><em class="replaceable"><code>si_signo</code></em>
                        will contain <code class="constant">SIGSYS</code>.</p>
                      </li>
                      <li class="listitem">
                        <p><em class="replaceable"><code>si_call_addr</code></em>
                        will show the address of the system call
                        instruction.</p>
                      </li>
                      <li class="listitem">
                        <p><em class="replaceable"><code>si_syscall</code></em>
                        and <em class="replaceable"><code>si_arch</code></em>
                        will indicate which system call was
                        attempted.</p>
                      </li>
                      <li class="listitem">
                        <p><em class="replaceable"><code>si_code</code></em>
                        will contain <code class="constant">SYS_SECCOMP</code>.</p>
                      </li>
                      <li class="listitem">
                        <p><em class="replaceable"><code>si_errno</code></em>
                        will contain the <code class="constant">SECCOMP_RET_DATA</code> portion
                        of the filter return value.</p>
                      </li>
                    </ul>
                  </div>
                </blockquote>
              </div>
              <p>The program counter will be as though the system
              call happened (i.e., the program counter will not
              point to the system call instruction). The return
              value register will contain an
              architecture−dependent value; if resuming
              execution, set it to something appropriate for the
              system call. (The architecture dependency is because
              replacing it with <span class="errorname">ENOSYS</span> could overwrite some useful
              information.)</p>
            </dd>
            <dt><span class="term"><code class="constant">SECCOMP_RET_ERRNO</code></span></dt>
            <dd>
              <p>This value results in the <code class="constant">SECCOMP_RET_DATA</code> portion of the
              filter's return value being passed to user space as
              the <code class="varname">errno</code> value without
              executing the system call.</p>
            </dd>
            <dt><span class="term"><code class="constant">SECCOMP_RET_TRACE</code></span></dt>
            <dd>
              <p>When returned, this value will cause the kernel to
              attempt to notify a <a class="link" href="../htmlman2/ptrace.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">ptrace</span>(2)</span></a>-based
              tracer prior to executing the system call. If there
              is no tracer present, the system call is not executed
              and returns a failure status with <code class="varname">errno</code> set to <span class="errorname">ENOSYS</span>.</p>
              <p>A tracer will be notified if it requests
              <code class="constant">PTRACE_O_TRACESECCOMP</code>
              using <em class="replaceable"><code>ptrace(PTRACE_SETOPTIONS)</code></em>.
              The tracer will be notified of a <code class="constant">PTRACE_EVENT_SECCOMP</code> and the
              <code class="constant">SECCOMP_RET_DATA</code>
              portion of the filter's return value will be
              available to the tracer via <code class="constant">PTRACE_GETEVENTMSG</code>.</p>
              <p>The tracer can skip the system call by changing
              the system call number to −1. Alternatively,
              the tracer can change the system call requested by
              changing the system call to a valid system call
              number. If the tracer asks to skip the system call,
              then the system call will appear to return the value
              that the tracer puts in the return value
              register.</p>
              <p>Before kernel 4.8, the seccomp check will not be
              run again after the tracer is notified. (This means
              that, on older kernels, seccomp-based sandboxes
              <span class="emphasis"><em>must not</em></span> allow
              use of <a class="link" href="../htmlman2/ptrace.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">ptrace</span>(2)</span></a>\(emeven
              of other sandboxed processes—without extreme
              care; ptracers can use this mechanism to escape from
              the seccomp sandbox.)</p>
              <p>Note that a tracer process will not be notified if
              another filter returns an action value with a
              precedence greater than <code class="constant">SECCOMP_RET_TRACE</code>.</p>
            </dd>
            <dt><span class="term"><code class="constant">SECCOMP_RET_LOG</code> (since Linux
            4.14)</span></dt>
            <dd>
              <p>This value results in the system call being
              executed after the filter return action is logged. An
              administrator may override the logging of this action
              via the <code class="filename">/proc/sys/kernel/seccomp/actions_logged</code>
              file.</p>
            </dd>
            <dt><span class="term"><code class="constant">SECCOMP_RET_ALLOW</code></span></dt>
            <dd>
              <p>This value results in the system call being
              executed.</p>
            </dd>
          </dl>
        </div>
        <p>If an action value other than one of the above is
        specified, then the filter action is treated as either
        <code class="constant">SECCOMP_RET_KILL_PROCESS</code>
        (since Linux 4.14) or <code class="constant">SECCOMP_RET_KILL_THREAD</code> (in Linux 4.13
        and earlier).</p>
      </div>
      <div class="refsect2">
        <a id="seccomp-2_sect3" name="seccomp-2_sect3" shape="rect"> </a>
        <h3>/proc interfaces</h3>
        <p>The files in the directory <code class="filename">/proc/sys/kernel/seccomp</code> provide
        additional seccomp information and configuration:</p>
        <div class="variablelist">
          <dl class="variablelist">
            <dt><span class="term"><em class="replaceable"><code>actions_avail</code></em> (since
            Linux 4.14)</span></dt>
            <dd>
              <p>A read-only ordered list of seccomp filter return
              actions in string form. The ordering, from
              left-to-right, is in decreasing order of precedence.
              The list represents the set of seccomp filter return
              actions supported by the kernel.</p>
            </dd>
            <dt><span class="term"><em class="replaceable"><code>actions_logged</code></em> (since
            Linux 4.14)</span></dt>
            <dd>
              <p>A read-write ordered list of seccomp filter return
              actions that are allowed to be logged. Writes to the
              file do not need to be in ordered form but reads from
              the file will be ordered in the same way as the
              <em class="replaceable"><code>actions_avail</code></em>
              file.</p>
              <p>It is important to note that the value of
              <em class="replaceable"><code>actions_logged</code></em> does
              not prevent certain filter return actions from being
              logged when the audit subsystem is configured to
              audit a task. If the action is not found in the
              <em class="replaceable"><code>actions_logged</code></em> file,
              the final decision on whether to audit the action for
              that task is ultimately left up to the audit
              subsystem to decide for all filter return actions
              other than <code class="constant">SECCOMP_RET_ALLOW</code>.</p>
              <p>The "allow" string is not accepted in the
              <em class="replaceable"><code>actions_logged</code></em> file
              as it is not possible to log <code class="constant">SECCOMP_RET_ALLOW</code> actions.
              Attempting to write "allow" to the file will fail
              with the error <span class="errorname">EINVAL</span>.</p>
            </dd>
          </dl>
        </div>
      </div>
      <div class="refsect2">
        <a id="seccomp-2_sect4" name="seccomp-2_sect4" shape="rect"> </a>
        <h3>Audit logging of seccomp actions</h3>
        <p>Since Linux 4.14, the kernel provides the facility to
        log the actions returned by seccomp filters in the audit
        log. The kernel makes the decision to log an action based
        on the action type, whether or not the action is present in
        the <em class="replaceable"><code>actions_logged</code></em> file, and
        whether kernel auditing is enabled (e.g., via the kernel
        boot option <em class="replaceable"><code>audit=1</code></em>). The rules are as
        follows:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc;">
            <li class="listitem">
              <p>If the action is <code class="constant">SECCOMP_RET_ALLOW</code>, the action is
              not logged.</p>
            </li>
            <li class="listitem">
              <p>Otherwise, if the action is either <code class="constant">SECCOMP_RET_KILL_PROCESS</code> or
              <code class="constant">SECCOMP_RET_KILL_THREAD</code>, and that
              action appears in the <em class="replaceable"><code>actions_logged</code></em> file,
              the action is logged.</p>
            </li>
            <li class="listitem">
              <p>Otherwise, if the filter has requested logging
              (the <code class="constant">SECCOMP_FILTER_FLAG_LOG</code> flag) and
              the action appears in the <em class="replaceable"><code>actions_logged</code></em> file,
              the action is logged.</p>
            </li>
            <li class="listitem">
              <p>Otherwise, if kernel auditing is enabled and the
              process is being audited (<span class="citerefentry"><span class="refentrytitle">autrace</span>(8)</span>), the action
              is logged.</p>
            </li>
            <li class="listitem">
              <p>Otherwise, the action is not logged.</p>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="refsect1">
      <a id="seccomp-2_sect5" name="seccomp-2_sect5" shape="rect"> </a>
      <h2>RETURN VALUE</h2>
      <p>On success, <code class="function">seccomp</code>()
      returns 0. On error, if <code class="constant">SECCOMP_FILTER_FLAG_TSYNC</code> was used, the
      return value is the ID of the thread that caused the
      synchronization failure. (This ID is a kernel thread ID of
      the type returned by <a class="link" href="../htmlman2/clone.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">clone</span>(2)</span></a> and <a class="link" href="../htmlman2/gettid.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">gettid</span>(2)</span></a>.) On other
      errors, −1 is returned, and <code class="varname">errno</code> is set to indicate the error.</p>
    </div>
    <div class="refsect1">
      <a id="seccomp-2_sect6" name="seccomp-2_sect6" shape="rect"> </a>
      <h2>ERRORS</h2>
      <p><code class="function">seccomp</code>() can fail for the
      following reasons:</p>
      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><span class="errorname">EACCES</span></span></dt>
          <dd>
            <p>The caller did not have the <code class="constant">CAP_SYS_ADMIN</code> capability in its user
            namespace, or had not set <em class="replaceable"><code>no_new_privs</code></em> before
            using <code class="constant">SECCOMP_SET_MODE_FILTER</code>.</p>
          </dd>
          <dt><span class="term"><span class="errorname">EFAULT</span></span></dt>
          <dd>
            <p><em class="parameter"><code>args</code></em> was not
            a valid address.</p>
          </dd>
          <dt><span class="term"><span class="errorname">EINVAL</span></span></dt>
          <dd>
            <p><em class="parameter"><code>operation</code></em> is
            unknown or is not supported by this kernel version or
            configuration.</p>
          </dd>
          <dt><span class="term"><span class="errorname">EINVAL</span></span></dt>
          <dd>
            <p>The specified <em class="parameter"><code>flags</code></em> are invalid for the
            given <em class="parameter"><code>operation</code></em>.</p>
          </dd>
          <dt><span class="term"><span class="errorname">EINVAL</span></span></dt>
          <dd>
            <p><em class="parameter"><code>operation</code></em>
            included <code class="constant">BPF_ABS</code>, but the
            specified offset was not aligned to a 32-bit boundary
            or exceeded <span class="emphasis"><em>sizeof(struct
            seccomp_data)</em></span>.</p>
          </dd>
          <dt><span class="term"><span class="errorname">EINVAL</span></span></dt>
          <dd>
            <p>A secure computing mode has already been set, and
            <em class="parameter"><code>operation</code></em>
            differs from the existing setting.</p>
          </dd>
          <dt><span class="term"><span class="errorname">EINVAL</span></span></dt>
          <dd>
            <p><em class="parameter"><code>operation</code></em>
            specified <code class="constant">SECCOMP_SET_MODE_FILTER</code>, but the
            filter program pointed to by <em class="parameter"><code>args</code></em> was not valid or the
            length of the filter program was zero or exceeded
            <code class="constant">BPF_MAXINSNS</code> (4096)
            instructions.</p>
          </dd>
          <dt><span class="term"><span class="errorname">ENOMEM</span></span></dt>
          <dd>
            <p>Out of memory.</p>
          </dd>
          <dt><span class="term"><span class="errorname">ENOMEM</span></span></dt>
          <dd>
            <p>The total length of all filter programs attached to
            the calling thread would exceed <code class="constant">MAX_INSNS_PER_PATH</code> (32768)
            instructions. Note that for the purposes of calculating
            this limit, each already existing filter program incurs
            an overhead penalty of 4 instructions.</p>
          </dd>
          <dt><span class="term"><span class="errorname">EOPNOTSUPP</span></span></dt>
          <dd>
            <p><em class="parameter"><code>operation</code></em>
            specified <code class="constant">SECCOMP_GET_ACTION_AVAIL</code>, but the
            kernel does not support the filter return action
            specified by <em class="parameter"><code>args</code></em>.</p>
          </dd>
          <dt><span class="term"><span class="errorname">ESRCH</span></span></dt>
          <dd>
            <p>Another thread caused a failure during thread sync,
            but its ID could not be determined.</p>
          </dd>
        </dl>
      </div>
    </div>
    <div class="refsect1">
      <a id="seccomp-2_sect7" name="seccomp-2_sect7" shape="rect"> </a>
      <h2>VERSIONS</h2>
      <p>The <code class="function">seccomp</code>() system call
      first appeared in Linux 3.17.</p>
    </div>
    <div class="refsect1">
      <a id="seccomp-2_sect8" name="seccomp-2_sect8" shape="rect"> </a>
      <h2>CONFORMING TO</h2>
      <p>The <code class="function">seccomp</code>() system call is
      a nonstandard Linux extension.</p>
    </div>
    <div class="refsect1">
      <a id="seccomp-2_sect9" name="seccomp-2_sect9" shape="rect"> </a>
      <h2>NOTES</h2>
      <p>Rather than hand-coding seccomp filters as shown in the
      example below, you may prefer to employ the <em class="replaceable"><code>libseccomp</code></em> library, which
      provides a front-end for generating seccomp filters.</p>
      <p>The <em class="replaceable"><code>Seccomp</code></em>
      field of the <code class="filename">/proc/[pid]/status</code>
      file provides a method of viewing the seccomp mode of a
      process; see <a class="link" href="../htmlman5/proc.5.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">proc</span>(5)</span></a>.</p>
      <p><code class="function">seccomp</code>() provides a
      superset of the functionality provided by the <a class="link" href="../htmlman2/prctl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">prctl</span>(2)</span></a> <code class="constant">PR_SET_SECCOMP</code> operation (which does not
      support <em class="parameter"><code>flags</code></em>).</p>
      <p>Since Linux 4.4, the <a class="link" href="../htmlman2/ptrace.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">ptrace</span>(2)</span></a> <code class="constant">PTRACE_SECCOMP_GET_FILTER</code> operation can be
      used to dump a process's seccomp filters.</p>
      <div class="refsect2">
        <a id="seccomp-2_sect10" name="seccomp-2_sect10" shape="rect"> </a>
        <h3>Architecture support for seccomp BPF</h3>
        <p>Architecture support for seccomp BPF filtering is
        available on the following architectures:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc;">
            <li class="listitem">
              <p>x86-64, i386, x32 (since Linux 3.5)</p>
            </li>
            <li class="listitem">
              <p>ARM (since Linux 3.8)</p>
            </li>
            <li class="listitem">
              <p>s390 (since Linux 3.8)</p>
            </li>
            <li class="listitem">
              <p>ARM-64 (since Linux 3.19)</p>
            </li>
            <li class="listitem">
              <p>PowerPC (since Linux 4.3)</p>
            </li>
            <li class="listitem">
              <p>Tile (since Linux 4.3)</p>
            </li>
            <li class="listitem">
              <p>PA-RISC (since Linux 4.6)</p>
            </li>
          </ul>
        </div>
        <p>Glibc does not provide a wrapper for this system call;
        call it using <a class="link" href="../htmlman2/syscall.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">syscall</span>(2)</span></a>.</p>
      </div>
      <div class="refsect2">
        <a id="seccomp-2_sect11" name="seccomp-2_sect11" shape="rect"> </a>
        <h3>Caveats</h3>
        <p>There are various subtleties to consider when applying
        seccomp filters to a program, including the following:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc;">
            <li class="listitem">
              <p>Some traditional system calls have user-space
              implementations in the <a class="link" href="../htmlman7/vdso.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">vdso</span>(7)</span></a> on many
              architectures. Notable examples include <a class="link" href="../htmlman2/clock_getres.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">clock_gettime</span>(2)</span></a>,
              <a class="link" href="../htmlman2/gettimeofday.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">gettimeofday</span>(2)</span></a>,
              and <a class="link" href="../htmlman2/time.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">time</span>(2)</span></a>. On such
              architectures, seccomp filtering for these system
              calls will have no effect. (However, there are cases
              where the <a class="link" href="../htmlman7/vdso.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">vdso</span>(7)</span></a>
              implementations may fall back to invoking the true
              system call, in which case seccomp filters would see
              the system call.)</p>
            </li>
            <li class="listitem">
              <p>Seccomp filtering is based on system call numbers.
              However, applications typically do not directly
              invoke system calls, but instead call wrapper
              functions in the C library which in turn invoke the
              system calls. Consequently, one must be aware of the
              following:</p>
              <div class="blockquote">
                <blockquote class="blockquote">
                  <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle;">
                      <li class="listitem">
                        <p>The glibc wrappers for some traditional
                        system calls may actually employ system
                        calls with different names in the kernel.
                        For example, the <a class="link" href="../htmlman2/_exit.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">exit</span>(2)</span></a>
                        wrapper function actually employs the
                        <a class="link" href="../htmlman2/exit_group.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">exit_group</span>(2)</span></a>
                        system call, and the <a class="link" href="../htmlman2/fork.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fork</span>(2)</span></a>
                        wrapper function actually calls <a class="link" href="../htmlman2/clone.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">clone</span>(2)</span></a>.</p>
                      </li>
                      <li class="listitem">
                        <p>The behavior of wrapper functions may
                        vary across architectures, according to the
                        range of system calls provided on those
                        architectures. In other words, the same
                        wrapper function may invoke different
                        system calls on different
                        architectures.</p>
                      </li>
                      <li class="listitem">
                        <p>Finally, the behavior of wrapper
                        functions can change across glibc versions.
                        For example, in older versions, the glibc
                        wrapper function for <a class="link" href="../htmlman2/open.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">open</span>(2)</span></a>
                        invoked the system call of the same name,
                        but starting in glibc 2.26, the
                        implementation switched to calling
                        <a class="link" href="../htmlman2/open.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">openat</span>(2)</span></a>
                        on all architectures.</p>
                      </li>
                    </ul>
                  </div>
                </blockquote>
              </div>
            </li>
          </ul>
        </div>
        <p>The consequence of the above points is that it may be
        necessary to filter for a system call other than might be
        expected. Various manual pages in Section 2 provide helpful
        details about the differences between wrapper functions and
        the underlying system calls in subsections entitled
        <span class="emphasis"><em>C library/kernel
        differences</em></span>.</p>
        <p>Furthermore, note that the application of seccomp
        filters even risks causing bugs in an application, when the
        filters cause unexpected failures for legitimate operations
        that the application might need to perform. Such bugs may
        not easily be discovered when testing the seccomp filters
        if the bugs occur in rarely used application code
        paths.</p>
      </div>
      <div class="refsect2">
        <a id="seccomp-2_sect12" name="seccomp-2_sect12" shape="rect"> </a>
        <h3>Seccomp-specific BPF details</h3>
        <p>Note the following BPF details specific to seccomp
        filters:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc;">
            <li class="listitem">
              <p>The <code class="constant">BPF_H</code> and
              <code class="constant">BPF_B</code> size modifiers
              are not supported: all operations must load and store
              (4-byte) words (<code class="constant">BPF_W</code>).</p>
            </li>
            <li class="listitem">
              <p>To access the contents of the <em class="replaceable"><code>seccomp_data</code></em> buffer,
              use the <code class="constant">BPF_ABS</code>
              addressing mode modifier.</p>
            </li>
            <li class="listitem">
              <p>The <code class="constant">BPF_LEN</code>
              addressing mode modifier yields an immediate mode
              operand whose value is the size of the <em class="replaceable"><code>seccomp_data</code></em>
              buffer.</p>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="refsect1">
      <a id="seccomp-2_sect13" name="seccomp-2_sect13" shape="rect"> </a>
      <h2>EXAMPLES</h2>
      <p>The program below accepts four or more arguments. The
      first three arguments are a system call number, a numeric
      architecture identifier, and an error number. The program
      uses these values to construct a BPF filter that is used at
      run time to perform the following checks:</p>
      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><em class="replaceable"><code>[1]</code></em></span></dt>
          <dd>
            <p>If the program is not running on the specified
            architecture, the BPF filter causes system calls to
            fail with the error <span class="errorname">ENOSYS</span>.</p>
          </dd>
          <dt><span class="term"><em class="replaceable"><code>[2]</code></em></span></dt>
          <dd>
            <p>If the program attempts to execute the system call
            with the specified number, the BPF filter causes the
            system call to fail, with <code class="varname">errno</code> being set to the specified error
            number.</p>
          </dd>
        </dl>
      </div>
      <p>The remaining command-line arguments specify the pathname
      and additional arguments of a program that the example
      program should attempt to execute using <a class="link" href="../htmlman3/exec.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">execv</span>(3)</span></a> (a library
      function that employs the <a class="link" href="../htmlman2/execve.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a> system call).
      Some example runs of the program are shown below.</p>
      <p>First, we display the architecture that we are running on
      (x86-64) and then construct a shell function that looks up
      system call numbers on this architecture:</p>
      <div class="blockquote">
        <blockquote class="blockquote">
          <div class="informalexample">
            <pre class="programlisting" xml:space="preserve">
$ uname -m
x86_64
$ syscall_nr() {
    cat /usr/src/linux/arch/x86/syscalls/syscall_64.tbl | \
    awk '$2 != "x32" &amp;&amp; $3 == "'$1'" { print $1 }'
}
</pre>
          </div>
        </blockquote>
      </div>
      <p>When the BPF filter rejects a system call (case [2]
      above), it causes the system call to fail with the error
      number specified on the command line. In the experiments
      shown here, we'll use error number 99:</p>
      <div class="blockquote">
        <blockquote class="blockquote">
          <div class="informalexample">
            <pre class="programlisting" xml:space="preserve">
$ <span class="emphasis"><em>errno 99</em></span>
EADDRNOTAVAIL 99 Cannot assign requested address
</pre>
          </div>
        </blockquote>
      </div>
      <p>In the following example, we attempt to run the command
      <a class="link" href="../htmlman1/whoami.1.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">whoami</span>(1)</span></a>, but the BPF
      filter rejects the <a class="link" href="../htmlman2/execve.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">execve</span>(2)</span></a> system call, so
      that the command is not even executed:</p>
      <div class="blockquote">
        <blockquote class="blockquote">
          <div class="informalexample">
            <pre class="programlisting" xml:space="preserve">
$ <span class="emphasis"><em>syscall_nr execve</em></span>
59
$ <em class="replaceable"><code>./a.out</code></em>
Usage: ./a.out &lt;syscall_nr&gt; &lt;arch&gt; &lt;errno&gt; &lt;prog&gt; [&lt;args&gt;]
Hint for &lt;arch&gt;: AUDIT_ARCH_I386: 0x40000003
                 AUDIT_ARCH_X86_64: 0xC000003E
$ <span class="emphasis"><em>./a.out 59 0xC000003E 99 /bin/whoami</em></span>
execv: Cannot assign requested address
</pre>
          </div>
        </blockquote>
      </div>
      <p>In the next example, the BPF filter rejects the <a class="link" href="../htmlman2/write.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">write</span>(2)</span></a> system call, so
      that, although it is successfully started, the <a class="link" href="../htmlman1/whoami.1.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">whoami</span>(1)</span></a> command is not
      able to write output:</p>
      <div class="blockquote">
        <blockquote class="blockquote">
          <div class="informalexample">
            <pre class="programlisting" xml:space="preserve">
$ <span class="emphasis"><em>syscall_nr write</em></span>
1
$ <span class="emphasis"><em>./a.out 1 0xC000003E 99 /bin/whoami</em></span>
</pre>
          </div>
        </blockquote>
      </div>
      <p>In the final example, the BPF filter rejects a system call
      that is not used by the <a class="link" href="../htmlman1/whoami.1.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">whoami</span>(1)</span></a> command, so it is
      able to successfully execute and produce output:</p>
      <div class="blockquote">
        <blockquote class="blockquote">
          <div class="informalexample">
            <pre class="programlisting" xml:space="preserve">
$ <span class="emphasis"><em>syscall_nr preadv</em></span>
295
$ <span class="emphasis"><em>./a.out 295 0xC000003E 99 /bin/whoami</em></span>
cecilia
</pre>
          </div>
        </blockquote>
      </div>
      <div class="refsect2">
        <a id="seccomp-2_sect14" name="seccomp-2_sect14" shape="rect"> </a>
        <h3>Program source</h3>
        <div class="informalexample">
          <pre class="programlisting" xml:space="preserve">
#include &lt;errno.h&gt;
#include &lt;stddef.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;linux/audit.h&gt;
#include &lt;linux/filter.h&gt;
#include &lt;linux/seccomp.h&gt;
#include &lt;sys/prctl.h&gt;

#define X32_SYSCALL_BIT 0x40000000
#define ARRAY_SIZE(arr) (sizeof(arr) / sizeof((arr)[0]))

static int
install_filter(int syscall_nr, int t_arch, int f_errno)
{
    unsigned int upper_nr_limit = 0xffffffff;

    /* Assume that AUDIT_ARCH_X86_64 means the normal x86−64 ABI
       (in the x32 ABI, all system calls have bit 30 set in the
       'nr' field, meaning the numbers are &gt;= X32_SYSCALL_BIT). */
    if (t_arch == AUDIT_ARCH_X86_64)
        upper_nr_limit = X32_SYSCALL_BIT − 1;

    struct sock_filter filter[] = {
        /* [0] Load architecture from 'seccomp_data' buffer into
               accumulator. */
        BPF_STMT(BPF_LD | BPF_W | BPF_ABS,
                 (offsetof(struct seccomp_data, arch))),

        /* [1] Jump forward 5 instructions if architecture does not
               match 't_arch'. */
        BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, t_arch, 0, 5),

        /* [2] Load system call number from 'seccomp_data' buffer into
               accumulator. */
        BPF_STMT(BPF_LD | BPF_W | BPF_ABS,
                 (offsetof(struct seccomp_data, nr))),

        /* [3] Check ABI − only needed for x86−64 in deny−list use
               cases.  Use BPF_JGT instead of checking against the bit
               mask to avoid having to reload the syscall number. */
        BPF_JUMP(BPF_JMP | BPF_JGT | BPF_K, upper_nr_limit, 3, 0),

        /* [4] Jump forward 1 instruction if system call number
               does not match 'syscall_nr'. */
        BPF_JUMP(BPF_JMP | BPF_JEQ | BPF_K, syscall_nr, 0, 1),

        /* [5] Matching architecture and system call: don't execute
           the system call, and return 'f_errno' in 'errno'. */
        BPF_STMT(BPF_RET | BPF_K,
                 SECCOMP_RET_ERRNO | (f_errno &amp; SECCOMP_RET_DATA)),

        /* [6] Destination of system call number mismatch: allow other
               system calls. */
        BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_ALLOW),

        /* [7] Destination of architecture mismatch: kill process. */
        BPF_STMT(BPF_RET | BPF_K, SECCOMP_RET_KILL_PROCESS),
    };

    struct sock_fprog prog = {
        .len = ARRAY_SIZE(filter),
        .filter = filter,
    };

    if (seccomp(SECCOMP_SET_MODE_FILTER, 0, &amp;prog)) {
        perror("seccomp");
        return 1;
    }

    return 0;
}

int
main(int argc, char **argv)
{
    if (argc &lt; 5) {
        fprintf(stderr, "Usage: "
                "%s &lt;syscall_nr&gt; &lt;arch&gt; &lt;errno&gt; &lt;prog&gt; [&lt;args&gt;]\n"
                "Hint for &lt;arch&gt;: AUDIT_ARCH_I386: 0x%X\n"
                "                 AUDIT_ARCH_X86_64: 0x%X\n"
                "\n", argv[0], AUDIT_ARCH_I386, AUDIT_ARCH_X86_64);
        exit(EXIT_FAILURE);
    }

    if (prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0)) {
        perror("prctl");
        exit(EXIT_FAILURE);
    }

    if (install_filter(strtol(argv[1], NULL, 0),
                       strtol(argv[2], NULL, 0),
                       strtol(argv[3], NULL, 0)))
        exit(EXIT_FAILURE);

    execv(argv[4], &amp;argv[4]);
    perror("execv");
    exit(EXIT_FAILURE);
}
</pre>
        </div>
      </div>
    </div>
    <div class="refsect1">
      <a id="seccomp-2_sect15" name="seccomp-2_sect15" shape="rect"> </a>
      <h2>SEE ALSO</h2>
      <p><span class="citerefentry"><span class="refentrytitle">bpfc</span>(1)</span>, <span class="citerefentry"><span class="refentrytitle">strace</span>(1)</span>, <a class="link" href="../htmlman2/bpf.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">bpf</span>(2)</span></a>, <a class="link" href="../htmlman2/prctl.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">prctl</span>(2)</span></a>, <a class="link" href="../htmlman2/ptrace.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">ptrace</span>(2)</span></a>, <a class="link" href="../htmlman2/sigaction.2.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">sigaction</span>(2)</span></a>, <a class="link" href="../htmlman5/proc.5.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">proc</span>(5)</span></a>, <a class="link" href="../htmlman7/signal.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">signal</span>(7)</span></a>, <a class="link" href="../htmlman7/socket.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">socket</span>(7)</span></a></p>
      <p>Various pages from the <em class="replaceable"><code>libseccomp</code></em> library,
      including: <span class="citerefentry"><span class="refentrytitle">scmp_sys_resolver</span>(1)</span>,
      <span class="citerefentry"><span class="refentrytitle">seccomp_export_bpf</span>(3)</span>,
      <span class="citerefentry"><span class="refentrytitle">seccomp_init</span>(3)</span>, <span class="citerefentry"><span class="refentrytitle">seccomp_load</span>(3)</span>, and
      <span class="citerefentry"><span class="refentrytitle">seccomp_rule_add</span>(3)</span>.</p>
      <p>The kernel source files <code class="filename">Documentation/networking/filter.txt</code> and
      <code class="filename">Documentation/userspace−api/seccomp_filter.rst</code>
      (or <code class="filename">Documentation/prctl/seccomp_filter.txt</code>
      before Linux 4.13).</p>
      <p>McCanne, S. and Jacobson, V. (1992) <span class="emphasis"><em>The BSD Packet Filter: A New Architecture for
      User-level Packet Capture</em></span>, Proceedings of the
      USENIX Winter 1993 Conference <a class="literalurl" href="http://www.tcpdump.org/papers/bpf/-usenix93.pdf" target="_top" shape="rect">http://www.tcpdump.org/papers/bpf\-usenix93.pdf</a></p>
    </div>
    <div class="colophon">
      <a id="seccomp-2_sect16" name="seccomp-2_sect16" shape="rect"> </a>
      <h2>COLOPHON</h2>
      <p>This page is part of release 5.11 of the Linux <em class="replaceable"><code>man-pages</code></em> project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      https://www.kernel.org/doc/man−pages/.</p>
      <div class="license">
        <table class="license" style="border-collapse: collapse;">
          <colgroup span="1">
            <col span="1" />
          </colgroup>
          <tbody>
            <tr>
              <td style="" rowspan="1" colspan="1">
                <div class="literallayout">
                  <br />
                    Copyright (C) 2014 Kees Cook &lt;keescook<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>chromium.org&gt;<br />

                  and Copyright (C) 2012 Will Drewry &lt;wad<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>chromium.org&gt;<br />

                  and Copyright (C) 2008, 2014,2017 Michael Kerrisk &lt;mtk.manpages<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>gmail.com&gt;<br />

                  and Copyright (C) 2017 Tyler Hicks &lt;tyhicks<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>canonical.com&gt;<br />

                  <br />
                  %%%LICENSE_START(VERBATIM)<br />
                  Permission is granted to make and distribute verbatim copies of this<br />

                  manual provided the copyright notice and this permission notice are<br />

                  preserved on all copies.<br />
                  <br />
                  Permission is granted to copy and distribute modified versions of this<br />

                  manual under the conditions for verbatim copying, provided that the<br />

                  entire resulting derived work is distributed under the terms of a<br />

                  permission notice identical to this one.<br />

                  <br />
                  Since the Linux kernel and libraries are constantly changing, this<br />

                  manual page may be incorrect or out-of-date.  The author(s) assume no<br />

                  responsibility for errors or omissions, or for damages resulting from<br />

                  the use of the information contained herein.  The author(s) may not<br />

                  have taken the same level of care in the production of this manual,<br />

                  which is licensed free of charge, as they might when working<br />

                  professionally.<br />
                  <br />
                  Formatted or processed versions of this manual, if unaccompanied by<br />

                  the source, must acknowledge the copyright and authors of this work.<br />

                  %%%LICENSE_END<br />
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</body>
</html>
