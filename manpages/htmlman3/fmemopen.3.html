<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>fmemopen(3) — Linux manual pages</title>
  <link rel="stylesheet" type="text/css" href="../stylesheet/manpages.css" />
  
  <link rel="home" href="../index.html" title="fmemopen(3) — Linux manual pages" />
  <script type="text/javascript" src="../stylesheet/manpages.js" xml:space="preserve"> </script>
  <link rel="icon" href="../stylesheet/icon.gif" type="image/gif" />
</head>
<body onload="javascript:init()">
  <div class="navheader">
    <table width="100%">
      <tbody>
        <tr>
          <td style="width: 33%" rowspan="1" colspan="1"><a href="../index.html" shape="rect">Linux
          manual pages</a></td>
          <th rowspan="1" colspan="1"><a href="../index3.html" shape="rect">Section 3</a></th>
          <td style="width: 33%" rowspan="1" colspan="1"> </td>
        </tr>
      </tbody>
    </table>
    <hr />
  </div>
  <div class="refentry">
    <a id="fmemopen.3" name="fmemopen.3" shape="rect"> </a>
    <div class="titlepage"> </div>
    <div class="refnamediv">
      <h2>Name</h2>
      <p>fmemopen — open memory as stream</p>
    </div>
    <div class="refsynopsisdiv">
      <h2>Synopsis</h2>
      <div class="funcsynopsis">
        <pre class="funcsynopsisinfo" xml:space="preserve">#include &lt;stdio.h&gt;</pre>
        <table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;">
          <tr>
            <td rowspan="1" colspan="1"><code class="funcdef">FILE
            *<strong>fmemopen</strong>(</code></td>
            <td rowspan="1" colspan="1">void *<var class="pdparam">buf</var>,</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1"> </td>
            <td rowspan="1" colspan="1">size_t <var class="pdparam">size</var>,</td>
          </tr>
          <tr>
            <td rowspan="1" colspan="1"> </td>
            <td rowspan="1" colspan="1">const char *<var class="pdparam">mode</var><code>)</code>;</td>
          </tr>
        </table>
        <div class="funcprototype-spacer">
           
        </div>
      </div>
      <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
        <table border="0" summary="Note">
          <tr>
            <td rowspan="2" align="center" valign="top" width="25" colspan="1">
            <img alt="[Note]" src="../stylesheet/note.png" /></td>
            <th align="left" rowspan="1" colspan="1">Note</th>
          </tr>
          <tr>
            <td align="left" valign="top" rowspan="1" colspan="1">
              <div class="featuretests">
                <table class="featuretests" style="border-collapse: collapse;">
                  <colgroup span="1">
                    <col span="1" />
                  </colgroup>
                  <thead>
                    <tr>
                      <th style="" rowspan="1" colspan="1">Feature Test Macro Requirements
                      for glibc (see <a class="link" href="../htmlman7/feature_test_macros.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">feature_test_macros</span>(7)</span></a>):</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td style="" rowspan="1" colspan="1"><code class="function">fmemopen</code>():</td>
                    </tr>
                    <tr>
                      <td class="featuretestdef" style="" rowspan="1" colspan="1">Since
                      glibc 2.10:</td>
                    </tr>
                    <tr>
                      <td class="featuretestdef" style="" rowspan="1" colspan="1">
                      <code class="constant">_POSIX_C_SOURCE</code>
                      &gt;= 200809L Before glibc 2.10:</td>
                    </tr>
                    <tr>
                      <td class="featuretestdef" style="" rowspan="1" colspan="1">
                      <code class="constant">_GNU_SOURCE</code></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </td>
          </tr>
        </table>
      </div>
    </div>
    <div class="refsect1">
      <a id="fmemopen-3_sect1" name="fmemopen-3_sect1" shape="rect"> </a>
      <h2>DESCRIPTION</h2>
      <p>The <code class="function">fmemopen</code>() function
      opens a stream that permits the access specified by
      <em class="parameter"><code>mode</code></em>. The stream
      allows I/O to be performed on the string or memory buffer
      pointed to by <em class="parameter"><code>buf</code></em>.</p>
      <p>The <em class="parameter"><code>mode</code></em> argument
      specifies the semantics of I/O on the stream, and is one of
      the following:</p>
      <div class="variablelist">
        <dl class="variablelist">
          <dt><span class="term"><code class="literal">r</code></span></dt>
          <dd>
            <p>The stream is opened for reading.</p>
          </dd>
          <dt><span class="term"><code class="literal">w</code></span></dt>
          <dd>
            <p>The stream is opened for writing.</p>
          </dd>
          <dt><span class="term"><code class="literal">a</code></span></dt>
          <dd>
            <p>Append; open the stream for writing, with the
            initial buffer position set to the first null byte.</p>
          </dd>
          <dt><span class="term"><em class="replaceable"><code>r+</code></em></span></dt>
          <dd>
            <p>Open the stream for reading and writing.</p>
          </dd>
          <dt><span class="term"><em class="replaceable"><code>w+</code></em></span></dt>
          <dd>
            <p>Open the stream for reading and writing. The buffer
            contents are truncated (i.e., '\0' is placed in the
            first byte of the buffer).</p>
          </dd>
          <dt><span class="term"><em class="replaceable"><code>a+</code></em></span></dt>
          <dd>
            <p>Append; open the stream for reading and writing,
            with the initial buffer position set to the first null
            byte.</p>
          </dd>
        </dl>
      </div>
      <p>The stream maintains the notion of a current position, the
      location where the next I/O operation will be performed. The
      current position is implicitly updated by I/O operations. It
      can be explicitly updated using <a class="link" href="../htmlman3/fseek.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fseek</span>(3)</span></a>, and determined
      using <a class="link" href="../htmlman3/fseek.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">ftell</span>(3)</span></a>. In all modes
      other than append, the initial position is set to the start
      of the buffer. In append mode, if no null byte is found
      within the buffer, then the initial position is <em class="replaceable"><code>size+1</code></em>.</p>
      <p>If <em class="parameter"><code>buf</code></em> is
      specified as NULL, then <code class="function">fmemopen</code>() allocates a buffer of <em class="parameter"><code>size</code></em> bytes. This is useful for
      an application that wants to write data to a temporary buffer
      and then read it back again. The initial position is set to
      the start of the buffer. The buffer is automatically freed
      when the stream is closed. Note that the caller has no way to
      obtain a pointer to the temporary buffer allocated by this
      call (but see <a class="link" href="../htmlman3/open_memstream.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">open_memstream</span>(3)</span></a>).</p>
      <p>If <em class="parameter"><code>buf</code></em> is not
      NULL, then it should point to a buffer of at least
      <code class="function">len</code> bytes allocated by the
      caller.</p>
      <p>When a stream that has been opened for writing is flushed
      (<a class="link" href="../htmlman3/fflush.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fflush</span>(3)</span></a>) or closed
      (<a class="link" href="../htmlman3/fclose.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fclose</span>(3)</span></a>), a null byte is
      written at the end of the buffer if there is space. The
      caller should ensure that an extra byte is available in the
      buffer (and that <em class="parameter"><code>size</code></em>
      counts that byte) to allow for this.</p>
      <p>In a stream opened for reading, null bytes ('\0') in the
      buffer do not cause read operations to return an end-of-file
      indication. A read from the buffer will indicate end-of-file
      only when the current buffer position advances <em class="parameter"><code>size</code></em> bytes past the start of
      the buffer.</p>
      <p>Write operations take place either at the current position
      (for modes other than append), or at the current size of the
      stream (for append modes).</p>
      <p>Attempts to write more than <em class="parameter"><code>size</code></em> bytes to the buffer result
      in an error. By default, such errors will be visible (by the
      absence of data) only when the <code class="function">stdio</code> buffer is flushed. Disabling
      buffering with the following call may be useful to detect
      errors at the time of an output operation:</p>
      <p>setbuf(stream, NULL);</p>
    </div>
    <div class="refsect1">
      <a id="fmemopen-3_sect2" name="fmemopen-3_sect2" shape="rect"> </a>
      <h2>RETURN VALUE</h2>
      <p>Upon successful completion, <code class="function">fmemopen</code>() returns a <span class="type">FILE</span> pointer. Otherwise, NULL is returned and
      <code class="varname">errno</code> is set to indicate the
      error.</p>
    </div>
    <div class="refsect1">
      <a id="fmemopen-3_sect3" name="fmemopen-3_sect3" shape="rect"> </a>
      <h2>VERSIONS</h2>
      <p><code class="function">fmemopen</code>() was already
      available in glibc 1.0.x.</p>
    </div>
    <div class="refsect1">
      <a id="fmemopen-3_sect4" name="fmemopen-3_sect4" shape="rect"> </a>
      <h2>ATTRIBUTES</h2>
      <p>For an explanation of the terms used in this section, see
      <a class="link" href="../htmlman7/attributes.7.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">attributes</span>(7)</span></a>.</p>
      <div class="informaltable">
        <table class="informaltable" style="border-collapse: collapse;">
          <colgroup span="1">
            <col class="c0" span="1" />
            <col class="c1" span="1" />
            <col class="c2" span="1" />
          </colgroup>
          <tbody>
            <tr>
              <td style="" align="left" rowspan="1" colspan="1">Interface</td>
              <td style="" align="left" rowspan="1" colspan="1">Attribute</td>
              <td style="" align="left" rowspan="1" colspan="1">Value</td>
            </tr>
            <tr>
              <td style="" align="left" rowspan="1" colspan="1"><code class="literal">fmemopen</code>(),</td>
              <td style="" align="left" rowspan="1" colspan="1">Thread safety</td>
              <td style="" align="left" rowspan="1" colspan="1">MT-Safe</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="refsect1">
      <a id="fmemopen-3_sect5" name="fmemopen-3_sect5" shape="rect"> </a>
      <h2>CONFORMING TO</h2>
      <p>POSIX.1-2008. This function is not specified in
      POSIX.1-2001, and is not widely available on other
      systems.</p>
      <p>POSIX.1-2008 specifies that 'b' in <em class="parameter"><code>mode</code></em> shall be ignored. However,
      Technical Corrigendum 1 adjusts the standard to allow
      implementation-specific treatment for this case, thus
      permitting the glibc treatment of 'b'.</p>
    </div>
    <div class="refsect1">
      <a id="fmemopen-3_sect6" name="fmemopen-3_sect6" shape="rect"> </a>
      <h2>NOTES</h2>
      <p>There is no file descriptor associated with the file
      stream returned by this function (i.e., <a class="link" href="../htmlman3/fileno.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fileno</span>(3)</span></a> will return an
      error if called on the returned stream).</p>
      <p>With version 2.22, binary mode (see below) was removed,
      many longstanding bugs in the implementation of <code class="function">fmemopen</code>() were fixed, and a new versioned
      symbol was created for this interface.</p>
      <div class="refsect2">
        <a id="fmemopen-3_sect7" name="fmemopen-3_sect7" shape="rect"> </a>
        <h3>Binary mode</h3>
        <p>From version 2.9 to 2.21, the glibc implementation of
        <code class="function">fmemopen</code>() supported a
        "binary" mode, enabled by specifying the letter 'b' as the
        second character in <em class="parameter"><code>mode</code></em>. In this mode, writes
        don't implicitly add a terminating null byte, and <a class="link" href="../htmlman3/fseek.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fseek</span>(3)</span></a> <code class="constant">SEEK_END</code> is relative to the end of the
        buffer (i.e., the value specified by the <em class="parameter"><code>size</code></em> argument), rather than
        the current string length.</p>
        <p>An API bug afflicted the implementation of binary mode:
        to specify binary mode, the 'b' must be the <code class="function">second</code> character in <em class="parameter"><code>mode</code></em>. Thus, for example,
        "wb+" has the desired effect, but "w+b" does not. This is
        inconsistent with the treatment of <em class="parameter"><code>mode</code></em> by <a class="link" href="../htmlman3/fopen.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fopen</span>(3)</span></a>.</p>
        <p>Binary mode was removed in glibc 2.22; a 'b' specified
        in <em class="parameter"><code>mode</code></em> has no
        effect.</p>
      </div>
    </div>
    <div class="refsect1">
      <a id="fmemopen-3_sect8" name="fmemopen-3_sect8" shape="rect"> </a>
      <h2>BUGS</h2>
      <p>In versions of glibc before 2.22, if <em class="parameter"><code>size</code></em> is specified as zero,
      <code class="function">fmemopen</code>() fails with the error
      <span class="errorname">EINVAL</span>. It would be more
      consistent if this case successfully created a stream that
      then returned end-of-file on the first attempt at reading;
      since version 2.22, the glibc implementation provides that
      behavior.</p>
      <p>In versions of glibc before 2.22, specifying append mode
      ("a" or "a+") for <code class="function">fmemopen</code>()
      sets the initial buffer position to the first null byte, but
      (if the current position is reset to a location other than
      the end of the stream) does not force subsequent writes to
      append at the end of the stream. This bug is fixed in glibc
      2.22.</p>
      <p>In versions of glibc before 2.22, if the <em class="parameter"><code>mode</code></em> argument to <code class="function">fmemopen</code>() specifies append ("a" or "a+"),
      and the <em class="parameter"><code>size</code></em> argument
      does not cover a null byte in <em class="parameter"><code>buf</code></em>, then, according to
      POSIX.1-2008, the initial buffer position should be set to
      the next byte after the end of the buffer. However, in this
      case the glibc <code class="function">fmemopen</code>() sets
      the buffer position to −1. This bug is fixed in glibc
      2.22.</p>
      <p>In versions of glibc before 2.22, when a call to <a class="link" href="../htmlman3/fseek.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fseek</span>(3)</span></a> with a
      <code class="function">whence</code> value of <code class="constant">SEEK_END</code> was performed on a stream created
      by <code class="function">fmemopen</code>(), the <code class="function">offset</code> was <code class="function">subtracted</code> from the end-of-stream position,
      instead of being added. This bug is fixed in glibc 2.22.</p>
      <p>The glibc 2.9 addition of "binary" mode for <code class="function">fmemopen</code>() silently changed the ABI:
      previously, <code class="function">fmemopen</code>() ignored
      'b' in <em class="parameter"><code>mode</code></em>.</p>
    </div>
    <div class="refsect1">
      <a id="fmemopen-3_sect9" name="fmemopen-3_sect9" shape="rect"> </a>
      <h2>EXAMPLES</h2>
      <p>The program below uses <code class="function">fmemopen</code>() to open an input buffer, and
      <a class="link" href="../htmlman3/open_memstream.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">open_memstream</span>(3)</span></a> to open a
      dynamically sized output buffer. The program scans its input
      string (taken from the program's first command-line argument)
      reading integers, and writes the squares of these integers to
      the output buffer. An example of the output produced by this
      program is the following:</p>
      <div class="blockquote">
        <blockquote class="blockquote">
          <div class="informalexample">
            <pre class="programlisting" xml:space="preserve">
$<span class="emphasis"><em> ./a.out '1 23 43'</em></span>
size=11; ptr=1 529 1849
</pre>
          </div>
        </blockquote>
      </div>
      <div class="refsect2">
        <a id="fmemopen-3_sect10" name="fmemopen-3_sect10" shape="rect"> </a>
        <h3>Program source</h3>
        <div class="informalexample">
          <pre class="programlisting" xml:space="preserve">
#define _GNU_SOURCE
#include &lt;string.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

#define handle_error(msg) \
    do { perror(msg); exit(EXIT_FAILURE); } while (0)

int
main(int argc, char *argv[])
{
    FILE *out, *in;
    int v, s;
    size_t size;
    char *ptr;

    if (argc != 2) {
        fprintf(stderr, "Usage: %s '&lt;num&gt;...'\n", argv[0]);
        exit(EXIT_FAILURE);
    }

    in = fmemopen(argv[1], strlen(argv[1]), "r");
    if (in == NULL)
        handle_error("fmemopen");

    out = open_memstream(&amp;ptr, &amp;size);
    if (out == NULL)
        handle_error("open_memstream");

    for (;;) {
        s = fscanf(in, "%d", &amp;v);
        if (s &lt;= 0)
            break;

        s = fprintf(out, "%d ", v * v);
        if (s == −1)
            handle_error("fprintf");
    }

    fclose(in);
    fclose(out);

    printf("size=%zu; ptr=%s\n", size, ptr);

    free(ptr);
    exit(EXIT_SUCCESS);
}
</pre>
        </div>
      </div>
    </div>
    <div class="refsect1">
      <a id="fmemopen-3_sect11" name="fmemopen-3_sect11" shape="rect"> </a>
      <h2>SEE ALSO</h2>
      <p><a class="link" href="../htmlman3/fopen.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fopen</span>(3)</span></a>, <a class="link" href="../htmlman3/fopencookie.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">fopencookie</span>(3)</span></a>, <a class="link" href="../htmlman3/open_memstream.3.html" target="_top" shape="rect"><span class="citerefentry"><span class="refentrytitle">open_memstream</span>(3)</span></a></p>
    </div>
    <div class="colophon">
      <a id="fmemopen-3_sect12" name="fmemopen-3_sect12" shape="rect"> </a>
      <h2>COLOPHON</h2>
      <p>This page is part of release 5.11 of the Linux <em class="replaceable"><code>man-pages</code></em> project. A
      description of the project, information about reporting bugs,
      and the latest version of this page, can be found at
      https://www.kernel.org/doc/man−pages/.</p>
      <div class="license">
        <table class="license" style="border-collapse: collapse;">
          <colgroup span="1">
            <col span="1" />
          </colgroup>
          <tbody>
            <tr>
              <td style="" rowspan="1" colspan="1">
                <div class="literallayout">
                  <br />
                    Copyright 2005, 2012, 2016 Michael Kerrisk &lt;mtk.manpages<script type="text/javascript">document.write('@');</script><noscript>(@)</noscript>gmail.com&gt;<br />

                  <br />
                  %%%LICENSE_START(GPL_NOVERSION_ONELINE)<br />
                  Distributed under the GPL.<br />
                  %%%LICENSE_END<br />
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</body>
</html>
