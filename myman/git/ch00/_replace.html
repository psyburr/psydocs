<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-49925874-3"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-49925874-3');
  </script>

  <meta charset='utf-8'>
  <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Git - Replace</title>

  <link href='../favicon.ico' rel='shortcut icon' type='image/x-icon'>

  <link rel="stylesheet" media="screen" href="../application-317ee030890d2caf96a53cbcc2a67040b748b2506d55661fc9c6754d0a024f59.css" />
  <script src="../modernize-b3ebe0c31c24f230dc62179d3e1030d2e57a53b1668d9382c0a27dbd44a94beb.js"></script>
  <!--[if (gte IE 6)&(lte IE 8)]>
  <script src="/javascripts/selectivizr-min.js"></script>
  <![endif]-->

</head>

<body id="documentation">

  <div class="inner">
    <header>

  <a href="https://git-scm.com/"><img src="../logo@2x.png" width="110" height="46" alt="Git" /></a>
  <span id="tagline"></span>
  <script type="text/javascript">
    var taglines = ["fast-version-control","everything-is-local","distributed-even-if-your-workflow-isnt","local-branching-on-the-cheap","distributed-is-the-new-centralized"];
    var tagline = taglines[Math.floor(Math.random() * taglines.length)];
    document.getElementById('tagline').innerHTML = '--' + tagline;
  </script>
  <form id="search" action="https://git-scm.com/search/results">
    <input id="search-text" name="search" placeholder="Search entire site..." autocomplete="off" type="text" />
  </form>
  <div id="search-results"></div>

</header>

  </div> <!-- .inner -->

    <div class="inner">
      <div id="content-wrapper">
        <button class="sidebar-btn"></button>
<aside class="sidebar" id="sidebar">
  <nav>
    <ul>
      <li>
        <a href="https://git-scm.com/about">About</a>
        <ul class="">
          <li>
            <a href="https://git-scm.com/about">Branching and Merging</a>
          </li>
          <li>
            <a href="https://git-scm.com/about/small-and-fast">Small and Fast</a>
          </li>
          <li>
            <a href="https://git-scm.com/about/distributed">Distributed</a>
          </li>
          <li>
            <a href="https://git-scm.com/about/info-assurance">Data Assurance</a>
          </li>
          <li>
            <a href="https://git-scm.com/about/staging-area">Staging Area</a>
          </li>
          <li>
            <a href="https://git-scm.com/about/free-and-open-source">Free and Open Source</a>
          </li>
          <li>
            <a href="https://git-scm.com/about/trademark">Trademark</a>
          </li>
        </ul>
      </li>
      <li>
        <a class="active" href="https://git-scm.com/doc">Documentation</a>
        <ul class="expanded">
          <li>
            <a href="https://git-scm.com/docs">Reference</a>
          </li>
          <li>
            <a class="active" href="https://git-scm.com/book">Book</a>
          </li>
          <li>
            <a href="https://git-scm.com/videos">Videos</a>
          </li>
          <li>
            <a href="https://git-scm.com/doc/ext">External Links</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="https://git-scm.com/downloads">Downloads</a>
        <ul class="">
          <li>
            <a href="https://git-scm.com/downloads/guis">GUI Clients</a>
          </li>
          <li>
            <a href="https://git-scm.com/downloads/logos">Logos</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="https://git-scm.com/community">Community</a>
      </li>
    </ul>
      <hr class="sidebar">
        <p>
This book is available in
  <a href="https://git-scm.com/book/en">English</a>.
</p>
<p>
  Full translation available in
  <table>
    <tr><td><a href="https://git-scm.com/book/az">azərbaycan dili</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/bg">български език</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/de">Deutsch</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/es">Español</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/fr">Français</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/gr">Ελληνικά</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/ja">日本語</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/ko">한국어</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/nl">Nederlands</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/ru">Русский</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/sl">Slovenščina</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/tl">Tagalog</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/uk">Українська</a></td></tr>
    <tr><td><a href="https://git-scm.com/book/zh">简体中文</a>,</td></tr>
  </table>
</p>
<p>
  Partial translations available in
  <table>
    <tr><td><a href="https://git-scm.com/book/cs">Čeština</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/mk">Македонски</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/pl">Polski</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/sr">Српски</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/uz">Ўзбекча</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/zh-tw">繁體中文</a>,</td></tr>
  </table>
</p>
<p>
  Translations started for
  <table>
    <tr><td><a href="https://git-scm.com/book/be">Беларуская</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/fa" dir="rtl">فارسی</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/id">Indonesian</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/it">Italiano</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/ms">Bahasa Melayu</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/pt-br">Português (Brasil)</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/pt-pt">Português (Portugal)</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/sv">Svenska</a>,</td></tr>
    <tr><td><a href="https://git-scm.com/book/tr">Türkçe</a>.</td></tr>
  </table>
</p>
<hr class="sidebar"/>
<p>
The source of this book is <a href="https://github.com/progit/progit2">hosted on GitHub.</a></br>
Patches, suggestions and comments are welcome.
</p>


  </nav>
</aside>

        <div id="content">
          

<div id='book-chapters'>
  <a class="dropdown-trigger" id="book-chapters-trigger" data-panel-id="chapters-dropdown" href="_replace.html#">Chapters ▾</a>
<div class='dropdown-panel' id='chapters-dropdown'>
  <div class="three-column">
    <div class='column-left'>
      <ol class='book-toc'>
  <li class='chapter'>
  <h2>1. <a href="ch01-getting-started.html">Getting Started</a></h2>
    <ol>
        <li>
          1.1
          <a href="ch01-getting-started.html" >About Version Control </a>
        </li>
        <li>
          1.2
          <a href="../Getting-Started-A-Short-History-of-Git.html" >A Short History of Git </a>
        </li>
        <li>
          1.3
          <a href="what_is_git_section.html" >What is Git? </a>
        </li>
        <li>
          1.4
          <a href="../Getting-Started-The-Command-Line.html" >The Command Line </a>
        </li>
        <li>
          1.5
          <a href="../Getting-Started-Installing-Git.html" >Installing Git </a>
        </li>
        <li>
          1.6
          <a href="_editor.html" >First-Time Git Setup </a>
        </li>
        <li>
          1.7
          <a href="_git_help.html" >Getting Help </a>
        </li>
        <li>
          1.8
          <a href="../Getting-Started-Summary.html" >Summary </a>
        </li>
    </ol>
  </li>
  <li class='chapter'>
  <h2>2. <a href="_git_cloning.html">Git Basics</a></h2>
    <ol>
        <li>
          2.1
          <a href="_git_cloning.html" >Getting a Git Repository </a>
        </li>
        <li>
          2.2
          <a href="_git_mv.html" >Recording Changes to the Repository </a>
        </li>
        <li>
          2.3
          <a href="_viewing_history.html" >Viewing the Commit History </a>
        </li>
        <li>
          2.4
          <a href="_unstaging.html" >Undoing Things </a>
        </li>
        <li>
          2.5
          <a href="_remote_repos.html" >Working with Remotes </a>
        </li>
        <li>
          2.6
          <a href="_annotated_tags.html" >Tagging </a>
        </li>
        <li>
          2.7
          <a href="_git_aliases.html" >Git Aliases </a>
        </li>
        <li>
          2.8
          <a href="../Git-Basics-Summary.html" >Summary </a>
        </li>
    </ol>
  </li>
  <li class='chapter'>
  <h2>3. <a href="_switching_branches.html">Git Branching</a></h2>
    <ol>
        <li>
          3.1
          <a href="_switching_branches.html" >Branches in a Nutshell </a>
        </li>
        <li>
          3.2
          <a href="_basic_branching.html" >Basic Branching and Merging </a>
        </li>
        <li>
          3.3
          <a href="_branch_management.html" >Branch Management </a>
        </li>
        <li>
          3.4
          <a href="_topic_branch.html" >Branching Workflows </a>
        </li>
        <li>
          3.5
          <a href="_delete_branches.html" >Remote Branches </a>
        </li>
        <li>
          3.6
          <a href="_rebase_rebase.html" >Rebasing </a>
        </li>
        <li>
          3.7
          <a href="../Git-Branching-Summary.html" >Summary </a>
        </li>
    </ol>
  </li>
  <li class='chapter'>
  <h2>4. <a href="../Git-on-the-Server-The-Protocols.html">Git on the Server</a></h2>
    <ol>
        <li>
          4.1
          <a href="../Git-on-the-Server-The-Protocols.html" >The Protocols </a>
        </li>
        <li>
          4.2
          <a href="_bare_repo.html" >Getting Git on a Server </a>
        </li>
        <li>
          4.3
          <a href="_generate_ssh_key.html" >Generating Your SSH Public Key </a>
        </li>
        <li>
          4.4
          <a href="_setting_up_server.html" >Setting Up the Server </a>
        </li>
        <li>
          4.5
          <a href="../Git-on-the-Server-Git-Daemon.html" >Git Daemon </a>
        </li>
        <li>
          4.6
          <a href="../Git-on-the-Server-Smart-HTTP.html" >Smart HTTP </a>
        </li>
        <li>
          4.7
          <a href="../Git-on-the-Server-GitWeb.html" >GitWeb </a>
        </li>
        <li>
          4.8
          <a href="_gitlab_groups_section.html" >GitLab </a>
        </li>
        <li>
          4.9
          <a href="../Git-on-the-Server-Third-Party-Hosted-Options.html" >Third Party Hosted Options </a>
        </li>
        <li>
          4.10
          <a href="../Git-on-the-Server-Summary.html" >Summary </a>
        </li>
    </ol>
  </li>
  <li class='chapter'>
  <h2>5. <a href="_integration_manager.html">Distributed Git</a></h2>
    <ol>
        <li>
          5.1
          <a href="_integration_manager.html" >Distributed Workflows </a>
        </li>
        <li>
          5.2
          <a href="_project_over_email.html" >Contributing to a Project </a>
        </li>
        <li>
          5.3
          <a href="_git_am.html" >Maintaining a Project </a>
        </li>
        <li>
          5.4
          <a href="../Distributed-Git-Summary.html" >Summary </a>
        </li>
    </ol>
  </li>
</ol>

    </div>
    <div class='column-middle'>
      <ol class='book-toc'>
  <li class='chapter'>
  <h2>6. <a href="_personal_avatar.html">GitHub</a></h2>
    <ol>
        <li>
          6.1
          <a href="_personal_avatar.html" >Account Setup and Configuration </a>
        </li>
        <li>
          6.2
          <a href="_fetch_and_push_on_different_repositories.html" >Contributing to a Project </a>
        </li>
        <li>
          6.3
          <a href="_email_notifications.html" >Maintaining a Project </a>
        </li>
        <li>
          6.4
          <a href="_team_page.html" >Managing an organization </a>
        </li>
        <li>
          6.5
          <a href="_commit_status.html" >Scripting GitHub </a>
        </li>
        <li>
          6.6
          <a href="../GitHub-Summary.html" >Summary </a>
        </li>
    </ol>
  </li>
  <li class='chapter'>
  <h2>7. <a href="_git_reflog.html">Git Tools</a></h2>
    <ol>
        <li>
          7.1
          <a href="_git_reflog.html" >Revision Selection </a>
        </li>
        <li>
          7.2
          <a href="_interactive_staging.html" >Interactive Staging </a>
        </li>
        <li>
          7.3
          <a href="_git_clean.html" >Stashing and Cleaning </a>
        </li>
        <li>
          7.4
          <a href="_signing_commits.html" >Signing Your Work </a>
        </li>
        <li>
          7.5
          <a href="_git_grep.html" >Searching </a>
        </li>
        <li>
          7.6
          <a href="_removing_file_every_commit.html" >Rewriting History </a>
        </li>
        <li>
          7.7
          <a href="_the_index.html" >Reset Demystified </a>
        </li>
        <li>
          7.8
          <a href="_reverse_commit.html" >Advanced Merging </a>
        </li>
        <li>
          7.9
          <a href="ref_rerere.html" >Rerere </a>
        </li>
        <li>
          7.10
          <a href="_file_annotation.html" >Debugging with Git </a>
        </li>
        <li>
          7.11
          <a href="_publishing_submodules.html" >Submodules </a>
        </li>
        <li>
          7.12
          <a href="_bundling.html" >Bundling </a>
        </li>
        <li>
          7.13
          <a href="_replace.html" class=active>Replace </a>
        </li>
        <li>
          7.14
          <a href="_credential_caching.html" >Credential Storage </a>
        </li>
        <li>
          7.15
          <a href="../Git-Tools-Summary.html" >Summary </a>
        </li>
    </ol>
  </li>
  <li class='chapter'>
  <h2>8. <a href="_external_merge_tools.html">Customizing Git</a></h2>
    <ol>
        <li>
          8.1
          <a href="_external_merge_tools.html" >Git Configuration </a>
        </li>
        <li>
          8.2
          <a href="_keyword_expansion.html" >Git Attributes </a>
        </li>
        <li>
          8.3
          <a href="_email_hooks.html" >Git Hooks </a>
        </li>
        <li>
          8.4
          <a href="_enforcing_commit_message_format.html" >An Example Git-Enforced Policy </a>
        </li>
        <li>
          8.5
          <a href="../Customizing-Git-Summary.html" >Summary </a>
        </li>
    </ol>
  </li>
  <li class='chapter'>
  <h2>9. <a href="_git_svn.html">Git and Other Systems</a></h2>
    <ol>
        <li>
          9.1
          <a href="_git_svn.html" >Git as a Client </a>
        </li>
        <li>
          9.2
          <a href="_git_p4.html" >Migrating to Git </a>
        </li>
        <li>
          9.3
          <a href="../Git-and-Other-Systems-Summary.html" >Summary </a>
        </li>
    </ol>
  </li>
  <li class='chapter'>
  <h2>10. <a href="_plumbing_porcelain.html">Git Internals</a></h2>
    <ol>
        <li>
          10.1
          <a href="_plumbing_porcelain.html" >Plumbing and Porcelain </a>
        </li>
        <li>
          10.2
          <a href="_git_commit_objects.html" >Git Objects </a>
        </li>
        <li>
          10.3
          <a href="ref_the_ref.html" >Git References </a>
        </li>
        <li>
          10.4
          <a href="../Git-Internals-Packfiles.html" >Packfiles </a>
        </li>
        <li>
          10.5
          <a href="_pushing_refspecs.html" >The Refspec </a>
        </li>
        <li>
          10.6
          <a href="../Git-Internals-Transfer-Protocols.html" >Transfer Protocols </a>
        </li>
        <li>
          10.7
          <a href="_git_gc.html" >Maintenance and Data Recovery </a>
        </li>
        <li>
          10.8
          <a href="../Git-Internals-Environment-Variables.html" >Environment Variables </a>
        </li>
        <li>
          10.9
          <a href="../Git-Internals-Summary.html" >Summary </a>
        </li>
    </ol>
  </li>
</ol>

    </div>
    <div class='column-right'>
      <ol class='book-toc'>
  <li class='chapter'>
  <h2>A1. <a href="../Appendix-A:-Git-in-Other-Environments-Graphical-Interfaces.html">Appendix A: Git in Other Environments</a></h2>
    <ol>
        <li>
          A1.1
          <a href="../Appendix-A:-Git-in-Other-Environments-Graphical-Interfaces.html" >Graphical Interfaces </a>
        </li>
        <li>
          A1.2
          <a href="../Appendix-A:-Git-in-Other-Environments-Git-in-Visual-Studio.html" >Git in Visual Studio </a>
        </li>
        <li>
          A1.3
          <a href="../Appendix-A:-Git-in-Other-Environments-Git-in-Visual-Studio-Code.html" >Git in Visual Studio Code </a>
        </li>
        <li>
          A1.4
          <a href="../Appendix-A:-Git-in-Other-Environments-Git-in-IntelliJ-%252F-PyCharm-%252F-WebStorm-%252F-PhpStorm-%252F-RubyMine.html" >Git in IntelliJ / PyCharm / WebStorm / PhpStorm / RubyMine </a>
        </li>
        <li>
          A1.5
          <a href="../Appendix-A:-Git-in-Other-Environments-Git-in-Sublime-Text.html" >Git in Sublime Text </a>
        </li>
        <li>
          A1.6
          <a href="../Appendix-A:-Git-in-Other-Environments-Git-in-Bash.html" >Git in Bash </a>
        </li>
        <li>
          A1.7
          <a href="oh_my_zsh_git.html" >Git in Zsh </a>
        </li>
        <li>
          A1.8
          <a href="../Appendix-A:-Git-in-Other-Environments-Git-in-PowerShell.html" >Git in PowerShell </a>
        </li>
        <li>
          A1.9
          <a href="../Appendix-A:-Git-in-Other-Environments-Summary.html" >Summary </a>
        </li>
    </ol>
  </li>
  <li class='chapter'>
  <h2>A2. <a href="../Appendix-B:-Embedding-Git-in-your-Applications-Command-line-Git.html">Appendix B: Embedding Git in your Applications</a></h2>
    <ol>
        <li>
          A2.1
          <a href="../Appendix-B:-Embedding-Git-in-your-Applications-Command-line-Git.html" >Command-line Git </a>
        </li>
        <li>
          A2.2
          <a href="_libgit2_bindings.html" >Libgit2 </a>
        </li>
        <li>
          A2.3
          <a href="../Appendix-B:-Embedding-Git-in-your-Applications-JGit.html" >JGit </a>
        </li>
        <li>
          A2.4
          <a href="../Appendix-B:-Embedding-Git-in-your-Applications-go-git.html" >go-git </a>
        </li>
        <li>
          A2.5
          <a href="../Appendix-B:-Embedding-Git-in-your-Applications-Dulwich.html" >Dulwich </a>
        </li>
    </ol>
  </li>
  <li class='chapter'>
  <h2>A3. <a href="ch_core_editor.html">Appendix C: Git Commands</a></h2>
    <ol>
        <li>
          A3.1
          <a href="ch_core_editor.html" >Setup and Config </a>
        </li>
        <li>
          A3.2
          <a href="../Appendix-C:-Git-Commands-Getting-and-Creating-Projects.html" >Getting and Creating Projects </a>
        </li>
        <li>
          A3.3
          <a href="../Appendix-C:-Git-Commands-Basic-Snapshotting.html" >Basic Snapshotting </a>
        </li>
        <li>
          A3.4
          <a href="../Appendix-C:-Git-Commands-Branching-and-Merging.html" >Branching and Merging </a>
        </li>
        <li>
          A3.5
          <a href="../Appendix-C:-Git-Commands-Sharing-and-Updating-Projects.html" >Sharing and Updating Projects </a>
        </li>
        <li>
          A3.6
          <a href="../Appendix-C:-Git-Commands-Inspection-and-Comparison.html" >Inspection and Comparison </a>
        </li>
        <li>
          A3.7
          <a href="../Appendix-C:-Git-Commands-Debugging.html" >Debugging </a>
        </li>
        <li>
          A3.8
          <a href="../Appendix-C:-Git-Commands-Patching.html" >Patching </a>
        </li>
        <li>
          A3.9
          <a href="../Appendix-C:-Git-Commands-Email.html" >Email </a>
        </li>
        <li>
          A3.10
          <a href="../Appendix-C:-Git-Commands-External-Systems.html" >External Systems </a>
        </li>
        <li>
          A3.11
          <a href="../Appendix-C:-Git-Commands-Administration.html" >Administration </a>
        </li>
        <li>
          A3.12
          <a href="../Appendix-C:-Git-Commands-Plumbing-Commands.html" >Plumbing Commands </a>
        </li>
    </ol>
  </li>
</ol>

    </div>
  </div>
 </div>

    <span class="light" id="edition">
      2nd Edition
    </span>
</div>

<div id='main' class="book edition2">
    <h1>7.13 Git Tools - Replace</h1>
  <div>
<h2 id="_replace">Replace</h2>
<div class="paragraph">
<p>As we’ve emphasized before, the objects in Git’s object database are unchangeable, but Git does provide an interesting way to <em>pretend</em> to replace objects in its database with other objects.</p>
</div>
<div class="paragraph">
<p>The <code>replace</code> command lets you specify an object in Git and say "every time you refer to <em>this</em> object, pretend it’s a <em>different</em> object".
This is most commonly useful for replacing one commit in your history with another one without having to rebuild the entire history with, say, <code>git filter-branch</code>.</p>
</div>
<div class="paragraph">
<p>For example, let’s say you have a huge code history and want to split your repository into one short history for new developers and one much longer and larger history for people interested in data mining.
You can graft one history onto the other by "replacing" the earliest commit in the new line with the latest commit on the older one.
This is nice because it means that you don’t actually have to rewrite every commit in the new history, as you would normally have to do to join them together (because the parentage affects the SHA-1s).</p>
</div>
<div class="paragraph">
<p>Let’s try this out.
Let’s take an existing repository, split it into two repositories, one recent and one historical, and then we’ll see how we can recombine them without modifying the recent repositories SHA-1 values via <code>replace</code>.</p>
</div>
<div class="paragraph">
<p>We’ll use a simple repository with five simple commits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git log --oneline
ef989d8 Fifth commit
c6e1e95 Fourth commit
9c68fdc Third commit
945704c Second commit
c1822cf First commit</code></pre>
</div>
</div>
<div class="paragraph">
<p>We want to break this up into two lines of history.
One line goes from commit one to commit four - that will be the historical one.
The second line will just be commits four and five - that will be the recent history.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/replace1.png" alt="replace1">
</div>
</div>
<div class="paragraph">
<p>Well, creating the historical history is easy, we can just put a branch in the history and then push that branch to the <code>master</code> branch of a new remote repository.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git branch history c6e1e95
$ git log --oneline --decorate
ef989d8 (HEAD, master) Fifth commit
c6e1e95 (history) Fourth commit
9c68fdc Third commit
945704c Second commit
c1822cf First commit</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/replace2.png" alt="replace2">
</div>
</div>
<div class="paragraph">
<p>Now we can push the new <code>history</code> branch to the <code>master</code> branch of our new repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git remote add project-history https://github.com/schacon/project-history
$ git push project-history history:master
Counting objects: 12, done.
Delta compression using up to 2 threads.
Compressing objects: 100% (4/4), done.
Writing objects: 100% (12/12), 907 bytes, done.
Total 12 (delta 0), reused 0 (delta 0)
Unpacking objects: 100% (12/12), done.
To git@github.com:schacon/project-history.git
 * [new branch]      history -&gt; master</code></pre>
</div>
</div>
<div class="paragraph">
<p>OK, so our history is published.
Now the harder part is truncating our recent history down so it’s smaller.
We need an overlap so we can replace a commit in one with an equivalent commit in the other, so we’re going to truncate this to just commits four and five (so commit four overlaps).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git log --oneline --decorate
ef989d8 (HEAD, master) Fifth commit
c6e1e95 (history) Fourth commit
9c68fdc Third commit
945704c Second commit
c1822cf First commit</code></pre>
</div>
</div>
<div class="paragraph">
<p>It’s useful in this case to create a base commit that has instructions on how to expand the history, so other developers know what to do if they hit the first commit in the truncated history and need more.
So, what we’re going to do is create an initial commit object as our base point with instructions, then rebase the remaining commits (four and five) on top of it.</p>
</div>
<div class="paragraph">
<p>To do that, we need to choose a point to split at, which for us is the third commit, which is <code>9c68fdc</code> in SHA-speak.
So, our base commit will be based off of that tree.
We can create our base commit using the <code>commit-tree</code> command, which just takes a tree and will give us a brand new, parentless commit object SHA-1 back.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ echo 'Get history from blah blah blah' | git commit-tree 9c68fdc^{tree}
622e88e9cbfbacfb75b5279245b9fb38dfea10cf</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>commit-tree</code> command is one of a set of commands that are commonly referred to as 'plumbing' commands.
These are commands that are not generally meant to be used directly, but instead are used by <strong>other</strong> Git commands to do smaller jobs.
On occasions when we’re doing weirder things like this, they allow us to do really low-level things but are not meant for daily use.
You can read more about plumbing commands in <a href="_plumbing_porcelain.html">Plumbing and Porcelain</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/replace3.png" alt="replace3">
</div>
</div>
<div class="paragraph">
<p>OK, so now that we have a base commit, we can rebase the rest of our history on top of that with <code>git rebase --onto</code>.
The <code>--onto</code> argument will be the SHA-1 we just got back from <code>commit-tree</code> and the rebase point will be the third commit (the parent of the first commit we want to keep, <code>9c68fdc</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git rebase --onto 622e88 9c68fdc
First, rewinding head to replay your work on top of it...
Applying: fourth commit
Applying: fifth commit</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/replace4.png" alt="replace4">
</div>
</div>
<div class="paragraph">
<p>OK, so now we’ve re-written our recent history on top of a throw away base commit that now has instructions in it on how to reconstitute the entire history if we wanted to.
We can push that new history to a new project and now when people clone that repository, they will only see the most recent two commits and then a base commit with instructions.</p>
</div>
<div class="paragraph">
<p>Let’s now switch roles to someone cloning the project for the first time who wants the entire history.
To get the history data after cloning this truncated repository, one would have to add a second remote for the historical repository and fetch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git clone https://github.com/schacon/project
$ cd project

$ git log --oneline master
e146b5f Fifth commit
81a708d Fourth commit
622e88e Get history from blah blah blah

$ git remote add project-history https://github.com/schacon/project-history
$ git fetch project-history
From https://github.com/schacon/project-history
 * [new branch]      master     -&gt; project-history/master</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the collaborator would have their recent commits in the <code>master</code> branch and the historical commits in the <code>project-history/master</code> branch.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git log --oneline master
e146b5f Fifth commit
81a708d Fourth commit
622e88e Get history from blah blah blah

$ git log --oneline project-history/master
c6e1e95 Fourth commit
9c68fdc Third commit
945704c Second commit
c1822cf First commit</code></pre>
</div>
</div>
<div class="paragraph">
<p>To combine them, you can simply call <code>git replace</code> with the commit you want to replace and then the commit you want to replace it with.
So we want to replace the "fourth" commit in the <code>master</code> branch with the "fourth" commit in the <code>project-history/master</code> branch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git replace 81a708d c6e1e95</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, if you look at the history of the <code>master</code> branch, it appears to look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git log --oneline master
e146b5f Fifth commit
81a708d Fourth commit
9c68fdc Third commit
945704c Second commit
c1822cf First commit</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cool, right?  Without having to change all the SHA-1s upstream, we were able to replace one commit in our history with an entirely different commit and all the normal tools (<code>bisect</code>, <code>blame</code>, etc) will work how we would expect them to.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/replace5.png" alt="replace5">
</div>
</div>
<div class="paragraph">
<p>Interestingly, it still shows <code>81a708d</code> as the SHA-1, even though it’s actually using the <code>c6e1e95</code> commit data that we replaced it with.
Even if you run a command like <code>cat-file</code>, it will show you the replaced data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git cat-file -p 81a708d
tree 7bc544cf438903b65ca9104a1e30345eee6c083d
parent 9c68fdceee073230f19ebb8b5e7fc71b479c0252
author Scott Chacon &lt;schacon@gmail.com&gt; 1268712581 -0700
committer Scott Chacon &lt;schacon@gmail.com&gt; 1268712581 -0700

fourth commit</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember that the actual parent of <code>81a708d</code> was our placeholder commit (<code>622e88e</code>), not <code>9c68fdce</code> as it states here.</p>
</div>
<div class="paragraph">
<p>Another interesting thing is that this data is kept in our references:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git for-each-ref
e146b5f14e79d4935160c0e83fb9ebe526b8da0d commit	refs/heads/master
c6e1e95051d41771a649f3145423f8809d1a74d4 commit	refs/remotes/history/master
e146b5f14e79d4935160c0e83fb9ebe526b8da0d commit	refs/remotes/origin/HEAD
e146b5f14e79d4935160c0e83fb9ebe526b8da0d commit	refs/remotes/origin/master
c6e1e95051d41771a649f3145423f8809d1a74d4 commit	refs/replace/81a708dd0e167a3f691541c7a6463343bc457040</code></pre>
</div>
</div>
<div class="paragraph">
<p>This means that it’s easy to share our replacement with others, because we can push this to our server and other people can easily download it.
This is not that helpful in the history grafting scenario we’ve gone over here (since everyone would be downloading both histories anyhow, so why separate them?) but it can be useful in other circumstances.</p>
</div>
<div id="nav"><a href="_bundling.html">prev</a> | <a href="_credential_caching.html">next</a></div></div>
</div>

        </div>
      </div>
      <footer>
  <div class="site-source">
    <a href="https://git-scm.com/site">About this site</a><br>
    Patches, suggestions, and comments are welcome.
  </div>
  <div class="sfc-member">
    Git is a member of <a href="https://git-scm.com/sfc">Software Freedom Conservancy</a>
  </div>
</footer>
<a href="_replace.html#top" class="no-js scrollToTop" id="scrollToTop" data-label="Scroll to top">
  <img src="../chevron-up@2x.png" width="20" height="20" alt="scroll-to-top"/>
</a>
<script src="../application-b09f91f7c527919e4bc194769429065537d64a7f73b9fe93b107afef32b02939.js"></script>

    </div>

</body>
</html>
