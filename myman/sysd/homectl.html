<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>homectl</title><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><style>
    a.headerlink {
      color: #c60f0f;
      font-size: 0.8em;
      padding: 0 4px 0 4px;
      text-decoration: none;
      visibility: hidden;
    }

    a.headerlink:hover {
      background-color: #c60f0f;
      color: white;
    }

    h1:hover > a.headerlink, h2:hover > a.headerlink, h3:hover > a.headerlink, dt:hover > a.headerlink {
      visibility: visible;
    }
  </style><a href="index.html">Index </a>·
  <a href="systemd.directives.html">Directives </a><span style="float:right">systemd 249</span><hr><div class="refentry"><a name="homectl"></a><div class="titlepage"></div><div class="refnamediv"><h2>Name</h2><p>homectl — Create, remove, change or inspect home directories</p></div><div class="refsynopsisdiv"><h2>Synopsis</h2><div class="cmdsynopsis"><p><code class="command">homectl</code>  [OPTIONS...] {COMMAND} [NAME...]</p></div></div><div class="refsect1"><a name="id-1.5"></a><h2 id="Description">Description<a class="headerlink" title="Permalink to this headline" href="homectl.html#Description">¶</a></h2><p><span class="command"><strong>homectl</strong></span> may be used to create, remove, change or inspect a user's home
    directory. It's primarily a command interfacing with
    <a href="systemd-homed.service.html#"><span class="citerefentry"><span class="refentrytitle">systemd-homed.service</span>(8)</span></a>
    which manages home directories of users.</p><p>Home directories managed by <code class="filename">systemd-homed.service</code> are self-contained, and thus
    include the user's full metadata record in the home's data storage itself, making them easy to migrate
    between machines. In particular, a home directory describes a matching user record, and every user record
    managed by <code class="filename">systemd-homed.service</code> also implies existence and encapsulation of a home
    directory. The user account and home directory become the same concept.</p><p>The following backing storage mechanisms are supported:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An individual LUKS2 encrypted loopback file for a user, stored in
      <code class="filename">/home/*.home</code>. At login the file system contained in this files is mounted, after
      the LUKS2 encrypted volume has been attached. The user's password is identical to the encryption
      passphrase of the LUKS2 volume. Access to data without preceding user authentication is thus not
      possible, even for the system administrator. This storage mechanism provides the strongest data
      security and is thus recommended.</p></li><li class="listitem"><p>Similar, but the LUKS2 encrypted file system is located on regular block device, such
      as an USB storage stick. In this mode home directories and all data they include are nicely migratable
      between machines, simply by plugging the USB stick into different systems at different
      times.</p></li><li class="listitem"><p>An encrypted directory using "<code class="literal">fscrypt</code>" on file systems that support it
      (at the moment this is primarily "<code class="literal">ext4</code>"), located in
      <code class="filename">/home/*.homedir</code>. This mechanism also provides encryption, but substantially
      weaker than LUKS2, as most file system metadata is unprotected. Moreover
      it currently does not support changing user passwords once the home directory has been
      created.</p></li><li class="listitem"><p>A "<code class="literal">btrfs</code>" subvolume for each user, also located in
      <code class="filename">/home/*.homedir</code>. This provides no encryption, but good quota
      support.</p></li><li class="listitem"><p>A regular directory for each user, also located in
      <code class="filename">/home/*.homedir</code>. This provides no encryption, but is a suitable fallback
      available on all machines, even where LUKS2, "<code class="literal">fscrypt</code>" or "<code class="literal">btrfs</code>"
      support is not available.</p></li><li class="listitem"><p>An individual Windows file share (CIFS) for each user.</p></li></ul></div><p>Note that <code class="filename">systemd-homed.service</code> and <span class="command"><strong>homectl</strong></span> will not manage
    "classic" UNIX user accounts as created with <a href="http://man7.org/linux/man-pages/man8/useradd.8.html"><span class="citerefentry"><span class="refentrytitle">useradd</span>(8)</span></a> or
    similar tools. In particular, this functionality is not suitable for managing system users (i.e. users
    with a UID below 1000) but is exclusive to regular ("human") users.</p><p>Note that users/home directories managed via <span class="command"><strong>systemd-homed.service</strong></span> do not show
    up in <code class="filename">/etc/passwd</code> and similar files, they are synthesized via glibc NSS during
    runtime. They are thus resolvable and may be enumerated via the <a href="http://man7.org/linux/man-pages/man1/getent.1.html"><span class="citerefentry"><span class="refentrytitle">getent</span>(1)</span></a>
    tool.</p><p>This tool interfaces directly with <code class="filename">systemd-homed.service</code>, and may execute
    specific commands on the home directories it manages. Since every home directory managed that way also
    defines a JSON user and group record these home directories may also be inspected and enumerated via
    <a href="userdbctl.html#"><span class="citerefentry"><span class="refentrytitle">userdbctl</span>(1)</span></a>.</p><p>Home directories managed by <code class="filename">systemd-homed.service</code> are usually in one of two
    states, or in a transition state between them: when "<code class="literal">active</code>" they are unlocked and
    mounted, and thus accessible to the system and its programs; when "<code class="literal">inactive</code>" they are
    not mounted and thus not accessible. Activation happens automatically at login of the user and usually
    can only complete after a password (or other authentication token) has been supplied. Deactivation
    happens after the user fully logged out. A home directory remains active as long as the user is logged in
    at least once, i.e. has at least one login session. When the user logs in a second time simultaneously
    the home directory remains active. It is deactivated only after the last of the user's sessions
    ends.</p></div><div class="refsect1"><a name="id-1.6"></a><h2 id="Options">Options<a class="headerlink" title="Permalink to this headline" href="homectl.html#Options">¶</a></h2><p>The following general options are understood (further options that control the various properties
    of user records managed by <code class="filename">systemd-homed.service</code> are documented further
    down):</p><div class="variablelist"><dl class="variablelist"><dt id="--identity=FILE"><span class="term"><code class="option">--identity=</code><em class="replaceable"><code>FILE</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--identity=FILE">¶</a></dt><dd><p>Read the user's JSON record from the specified file. If passed as
        "<code class="literal">-</code>" read the user record from standard input. The supplied JSON object must follow
        the structure documented in <a class="ulink" href="https://systemd.io/USER_RECORD" target="_top">JSON User Records</a>.
        This option may be used in conjunction with the <span class="command"><strong>create</strong></span> and
        <span class="command"><strong>update</strong></span> commands (see below), where it allows configuring the user record in JSON
        as-is, instead of setting the individual user record properties (see below).</p></dd><dt id="--json=FORMAT"><span class="term"><code class="option">--json=</code><em class="replaceable"><code>FORMAT</code></em>, </span><span class="term"><code class="option">-J</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--json=FORMAT">¶</a></dt><dd><p>Controls whether to output the user record in JSON format, if the
        <span class="command"><strong>inspect</strong></span> command (see below) is used. Takes one of "<code class="literal">pretty</code>",
        "<code class="literal">short</code>" or "<code class="literal">off</code>". If "<code class="literal">pretty</code>" human-friendly
        whitespace and newlines are inserted in the output to make the JSON data more readable. If
        "<code class="literal">short</code>" all superfluous whitespace is suppressed. If "<code class="literal">off</code>" (the
        default) the user information is not shown in JSON format but in a friendly human readable formatting
        instead. The <code class="option">-J</code> option picks "<code class="literal">pretty</code>" when run interactively and
        "<code class="literal">short</code>" otherwise.</p></dd><dt id="--export-format=FORMAT"><span class="term"><code class="option">--export-format=</code><em class="replaceable"><code>FORMAT</code></em>, </span><span class="term"><code class="option">-E</code>, </span><span class="term"><code class="option">-EE</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--export-format=FORMAT">¶</a></dt><dd><p>When used with the <span class="command"><strong>inspect</strong></span> verb in JSON mode (see above) may be
        used to suppress certain aspects of the JSON user record on output. Specifically, if
        "<code class="literal">stripped</code>" format is used the binding and runtime fields of the record are
        removed. If "<code class="literal">minimal</code>" format is used the cryptographic signature is removed too. If
        "<code class="literal">full</code>" format is used the full JSON record is shown (this is the default). This
        option is useful for copying an existing user record to a different system in order to create a
        similar user there with the same settings. Specifically: <span class="command"><strong>homectl inspect -EE | ssh
        root@othersystem homectl create -i-</strong></span> may be used as simple command line for replicating a
        user on another host. <code class="option">-E</code> is equivalent to <code class="option">-j --export-format=stripped</code>,
        <code class="option">-EE</code> to <code class="option">-j --export-format=minimal</code>. Note that when replicating user
        accounts user records acquired in "<code class="literal">stripped</code>" mode will retain the original
        cryptographic signatures and thus may only be modified when the private key to update them is available
        on the destination machine. When replicating users in "<code class="literal">minimal</code>" mode, the signature
        is removed during the replication and thus the record will be implicitly signed with the key of the destination
        machine and may be updated there without any private key replication.</p></dd><dt id="-H"><span class="term"><code class="option">-H</code>, </span><span class="term"><code class="option">--host=</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#-H">¶</a></dt><dd><p><a name="host-text"></a>Execute the operation remotely. Specify a hostname, or a
      username and hostname separated by "<code class="literal">@</code>", to
      connect to. The hostname may optionally be suffixed by a
      port ssh is listening on, separated by "<code class="literal">:</code>", and then a
      container name, separated by "<code class="literal">/</code>", which
      connects directly to a specific container on the specified
      host. This will use SSH to talk to the remote machine manager
      instance. Container names may be enumerated with
      <span class="command"><strong>machinectl -H
      <em class="replaceable"><code>HOST</code></em></strong></span>. Put IPv6 addresses in brackets.</p></dd><dt id="-M"><span class="term"><code class="option">-M</code>, </span><span class="term"><code class="option">--machine=</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#-M">¶</a></dt><dd><p><a name="machine-text"></a>Execute operation on a local container. Specify a container name to connect to, optionally
      prefixed by a user name to connect as and a separating "<code class="literal">@</code>" character. If the special
      string "<code class="literal">.host</code>" is used in place of the container name, a connection to the local
      system is made (which is useful to connect to a specific user's user bus: "<code class="literal">--user
      --machine=lennart@.host</code>"). If the "<code class="literal">@</code>" syntax is not used, the connection is
      made as root user. If the "<code class="literal">@</code>" syntax is used either the left hand side or the right hand
      side may be omitted (but not both) in which case the local user name and "<code class="literal">.host</code>" are
      implied.</p></dd><dt id="--no-pager"><span class="term"><code class="option">--no-pager</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--no-pager">¶</a></dt><dd><p>Do not pipe output into a pager.</p></dd><dt id="--no-legend"><span class="term"><code class="option">--no-legend</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--no-legend">¶</a></dt><dd><p>Do not print the legend, i.e. column headers and the
      footer with hints.</p></dd><dt id="--no-ask-password"><span class="term"><code class="option">--no-ask-password</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--no-ask-password">¶</a></dt><dd><p>Do not query the user for authentication for privileged operations.</p></dd><dt id="-h"><span class="term"><code class="option">-h</code>, </span><span class="term"><code class="option">--help</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#-h">¶</a></dt><dd><p><a name="help-text"></a>Print a short help text and exit.
    </p></dd><dt id="--version"><span class="term"><code class="option">--version</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--version">¶</a></dt><dd><p><a name="version-text"></a>Print a short version string and exit.</p></dd></dl></div></div><div class="refsect1"><a name="id-1.7"></a><h2 id="User Record Properties">User Record Properties<a class="headerlink" title="Permalink to this headline" href="homectl.html#User%20Record%20Properties">¶</a></h2><p>The following options control various properties of the user records/home directories that
    <code class="filename">systemd-homed.service</code> manages. These switches may be used in conjunction with the
    <span class="command"><strong>create</strong></span> and <span class="command"><strong>update</strong></span> commands for configuring various aspects of the
    home directory and the user account:</p><div class="variablelist"><dl class="variablelist"><dt id="--real-name=NAME"><span class="term"><code class="option">--real-name=</code><em class="replaceable"><code>NAME</code></em>, </span><span class="term"><code class="option">-c</code> <em class="replaceable"><code>NAME</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--real-name=NAME">¶</a></dt><dd><p>The real name for the user. This corresponds with the GECOS field on classic UNIX NSS
        records.</p></dd><dt id="--realm=REALM"><span class="term"><code class="option">--realm=</code><em class="replaceable"><code>REALM</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--realm=REALM">¶</a></dt><dd><p>The realm for the user. The realm associates a user with a specific organization or
        installation, and allows distinguishing users of the same name defined in different contexts. The
        realm can be any string that also qualifies as valid DNS domain name, and it is recommended to use
        the organization's or installation's domain name for this purpose, but this is not enforced nor
        required. On each system only a single user of the same name may exist, and if a user with the same
        name and realm is seen it is assumed to refer to the same user while a user with the same name but
        different realm is considered a different user. Note that this means that two users sharing the same
        name but with distinct realms are not allowed on the same system. Assigning a realm to a user is
        optional.</p></dd><dt id="--email-address=EMAIL"><span class="term"><code class="option">--email-address=</code><em class="replaceable"><code>EMAIL</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--email-address=EMAIL">¶</a></dt><dd><p>Takes an electronic mail address to associate with the user. On log-in the
        <code class="varname">$EMAIL</code> environment variable is initialized from this value.</p></dd><dt id="--location=TEXT"><span class="term"><code class="option">--location=</code><em class="replaceable"><code>TEXT</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--location=TEXT">¶</a></dt><dd><p>Takes location specification for this user. This is free-form text, which might or
        might not be usable by geo-location applications. Example: <code class="option">--location="Berlin,
        Germany"</code> or <code class="option">--location="Basement, Room 3a"</code></p></dd><dt id="--icon-name=ICON"><span class="term"><code class="option">--icon-name=</code><em class="replaceable"><code>ICON</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--icon-name=ICON">¶</a></dt><dd><p>Takes an icon name to associate with the user, following the scheme defined by the <a class="ulink" href="https://standards.freedesktop.org/icon-naming-spec/icon-naming-spec-latest.html" target="_top">Icon Naming
        Specification</a>.</p></dd><dt id="--home-dir=PATH"><span class="term"><code class="option">--home-dir=</code><em class="replaceable"><code>PATH</code></em>, </span><span class="term"><code class="option">-d</code><em class="replaceable"><code>PATH</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--home-dir=PATH">¶</a></dt><dd><p>Takes a path to use as home directory for the user. Note that this is the directory
        the user's home directory is mounted to while the user is logged in. This is not where the user's
        data is actually stored, see <code class="option">--image-path=</code> for that. If not specified defaults to
        <code class="filename">/home/$USER</code>.</p></dd><dt id="--uid=UID"><span class="term"><code class="option">--uid=</code><em class="replaceable"><code>UID</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--uid=UID">¶</a></dt><dd><p>Takes a preferred numeric UNIX UID to assign this user. If a user is to be created
        with the specified UID and it is already taken by a different user on the local system then creation
        of the home directory is refused. Note though, if after creating the home directory it is used on a
        different system and the configured UID is taken by another user there, then
        <span class="command"><strong>systemd-homed</strong></span> may assign the user a different UID on that system. The specified
        UID must be outside of the system user range. It is recommended to use the 60001…60513 UID range for
        this purpose. If not specified, the UID is automatically picked. If the home directory is found to be
        owned by a different UID when logging in, the home directory and everything underneath it will have
        its ownership changed automatically before login completes.</p><p>Note that users managed by <span class="command"><strong>systemd-homed</strong></span> always have a matching group
        associated with the same name as well as a GID matching the UID of the user. Thus, configuring the
        GID separately is not permitted.</p></dd><dt id="--member-of=GROUP"><span class="term"><code class="option">--member-of=</code><em class="replaceable"><code>GROUP</code></em>, </span><span class="term"><code class="option">-G</code> <em class="replaceable"><code>GROUP</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--member-of=GROUP">¶</a></dt><dd><p>Takes a comma-separated list of auxiliary UNIX groups this user shall belong
        to. Example: <code class="option">--member-of=wheel</code> to provide the user with administrator
        privileges. Note that <span class="command"><strong>systemd-homed</strong></span> does not manage any groups besides a group
        matching the user in name and numeric UID/GID. Thus any groups listed here must be registered
        independently, for example with <a href="http://man7.org/linux/man-pages/man8/groupadd.8.html"><span class="citerefentry"><span class="refentrytitle">groupadd</span>(8)</span></a>.
        Any non-existent groups are ignored. This option may be used more than once, in which case all
        specified group lists are combined. If the user is currently a member of a group which is not listed,
        the user will be removed from the group.</p></dd><dt id="--skel=PATH"><span class="term"><code class="option">--skel=</code><em class="replaceable"><code>PATH</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--skel=PATH">¶</a></dt><dd><p>Takes a file system path to a directory. Specifies the skeleton directory to
        initialize the home directory with. All files and directories in the specified path are copied into
        any newly create home directory. If not specified defaults to <code class="filename">/etc/skel/</code>.
        </p></dd><dt id="--shell=SHELL"><span class="term"><code class="option">--shell=</code><em class="replaceable"><code>SHELL</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--shell=SHELL">¶</a></dt><dd><p>Takes a file system path. Specifies the shell binary to execute on terminal
        logins. If not specified defaults to <code class="filename">/bin/bash</code>.</p></dd><dt id="--setenv=VARIABLE[=VALUE]"><span class="term"><code class="option">--setenv=</code><em class="replaceable"><code>VARIABLE</code></em>[=<em class="replaceable"><code>VALUE</code></em>]</span><a class="headerlink" title="Permalink to this term" href="homectl.html#--setenv=VARIABLE%5B=VALUE%5D">¶</a></dt><dd><p>Takes an environment variable assignment to set for all user processes. May be used
        multiple times to set multiple environment variables. When "<code class="literal">=</code>" and
        <em class="replaceable"><code>VALUE</code></em> are omitted, the value of the variable with the same name in the
        program environment will be used.</p><p>Note that a number of other settings also result in environment variables to be set for the
        user, including <code class="option">--email=</code>, <code class="option">--timezone=</code> and
        <code class="option">--language=</code>.</p></dd><dt id="--timezone=TIMEZONE"><span class="term"><code class="option">--timezone=</code><em class="replaceable"><code>TIMEZONE</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--timezone=TIMEZONE">¶</a></dt><dd><p>Takes a time zone location name that sets the timezone for the specified user. When
        the user logs in the <code class="varname">$TZ</code> environment variable is initialized from this
        setting. Example: <code class="option">--timezone=Europe/Amsterdam</code> will result in the environment
        variable "<code class="literal">TZ=:Europe/Amsterdam</code>". ("<code class="literal">:</code>" is used intentionally as part
        of the timezone specification, see
        <a href="http://man7.org/linux/man-pages/man3/tzset.3.html"><span class="citerefentry"><span class="refentrytitle">tzset</span>(3)</span></a>.)
        </p></dd><dt id="--language=LANG"><span class="term"><code class="option">--language=</code><em class="replaceable"><code>LANG</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--language=LANG">¶</a></dt><dd><p>Takes a specifier indicating the preferred language of the user. The
        <code class="varname">$LANG</code> environment variable is initialized from this value on login, and thus a
        value suitable for this environment variable is accepted here, for example
        <code class="option">--language=de_DE.UTF8</code>.</p></dd><dt id="--ssh-authorized-keys=KEYS"><span class="term"><code class="option">--ssh-authorized-keys=</code><em class="replaceable"><code>KEYS</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--ssh-authorized-keys=KEYS">¶</a></dt><dd><p>Either takes a SSH authorized key line to associate with the user record or a
        "<code class="literal">@</code>" character followed by a path to a file to read one or more such lines from. SSH
        keys configured this way are made available to SSH to permit access to this home directory and user
        record. This option may be used more than once to configure multiple SSH keys.</p></dd><dt id="--pkcs11-token-uri=URI"><span class="term"><code class="option">--pkcs11-token-uri=</code><em class="replaceable"><code>URI</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--pkcs11-token-uri=URI">¶</a></dt><dd><p>Takes an RFC 7512 PKCS#11 URI referencing a security token (e.g. YubiKey or PIV
        smartcard) that shall be able to unlock the user account. The security token URI should reference a
        security token with exactly one pair of X.509 certificate and private key. A random secret key is
        then generated, encrypted with the public key of the X.509 certificate, and stored as part of the
        user record. At login time it is decrypted with the PKCS#11 module and then used to unlock the
        account and associated resources. See below for an example how to set up authentication with a
        security token.</p><p>Instead of a valid PKCS#11 URI, the special strings "<code class="literal">list</code>" and
        "<code class="literal">auto</code>" may be specified. If "<code class="literal">list</code>" is passed, a brief table of
        suitable, currently plugged in PKCS#11 hardware tokens is shown, along with their URIs. If
        "<code class="literal">auto</code>" is passed, a suitable PKCS#11 hardware token is automatically selected (this
        operation will fail if there isn't exactly one suitable token discovered). The latter is a useful
        shortcut for the most common case where a single PKCS#11 hardware token is plugged in.</p><p>Note that many hardware security tokens implement both PKCS#11/PIV and FIDO2 with the
        "<code class="literal">hmac-secret</code>" extension (for example: the YubiKey 5 series), as supported with the
        <code class="option">--fido2-device=</code> option below. Both mechanisms are similarly powerful, though FIDO2
        is the more modern technology. PKCS#11/PIV tokens have the benefit of being recognizable before
        authentication and hence can be used for implying the user identity to use for logging in, which
        FIDO2 does not allow. PKCS#11/PIV devices generally require initialization (i.e. storing a
        private/public key pair on them, see example below) before they can be used; FIDO2 security tokens
        generally do not required that, and work out of the box.</p></dd><dt id="--fido2-device=PATH"><span class="term"><code class="option">--fido2-device=</code><em class="replaceable"><code>PATH</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--fido2-device=PATH">¶</a></dt><dd><p>Takes a path to a Linux "<code class="literal">hidraw</code>" device
        (e.g. <code class="filename">/dev/hidraw1</code>), referring to a FIDO2 security token implementing the
        "<code class="literal">hmac-secret</code>" extension that shall be able to unlock the user account. A random salt
        value is generated on the host and passed to the FIDO2 device, which calculates a HMAC hash of the
        salt using an internal secret key. The result is then used as the key to unlock the user account. The
        random salt is included in the user record, so that whenever authentication is needed it can be
        passed to the FIDO2 token again.</p><p>Instead of a valid path to a FIDO2 "<code class="literal">hidraw</code>" device the special strings
        "<code class="literal">list</code>" and "<code class="literal">auto</code>" may be specified. If "<code class="literal">list</code>" is
        passed, a brief table of suitable discovered FIDO2 devices is shown. If "<code class="literal">auto</code>" is
        passed, a suitable FIDO2 token is automatically selected, if exactly one is discovered. The latter is
        a useful shortcut for the most common case where a single FIDO2 hardware token is plugged in.</p><p>Note that FIDO2 devices suitable for this option must implement the
        "<code class="literal">hmac-secret</code>" extension. Most current devices (such as the YubiKey 5 series) do. If
        the extension is not implemented the device cannot be used for unlocking home directories.</p><p>Note that many hardware security tokens implement both FIDO2 and PKCS#11/PIV (and thus may be
        used with either <code class="option">--fido2-device=</code> or <code class="option">--pkcs11-token-uri=</code>), for a
        discussion see above.</p></dd><dt id="--fido2-with-client-pin=BOOL"><span class="term"><code class="option">--fido2-with-client-pin=</code><em class="replaceable"><code>BOOL</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--fido2-with-client-pin=BOOL">¶</a></dt><dd><p>When enrolling a FIDO2 security token, controls whether to require the user to enter
        a PIN when unlocking the account (the FIDO2 "<code class="literal">clientPin</code>" feature). Defaults to
        "<code class="literal">yes</code>". (Note: this setting is without effect if the security token does not support
        the "<code class="literal">clientPin</code>" feature at all, or does not allow enabling or disabling
        it.)</p></dd><dt id="--fido2-with-user-presence=BOOL"><span class="term"><code class="option">--fido2-with-user-presence=</code><em class="replaceable"><code>BOOL</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--fido2-with-user-presence=BOOL">¶</a></dt><dd><p>When enrolling a FIDO2 security token, controls whether to require the user to
        verify presence (tap the token, the FIDO2 "<code class="literal">up</code>" feature) when unlocking the account.
        Defaults to "<code class="literal">yes</code>". (Note: this setting is without effect if the security token does not support
        the "<code class="literal">up</code>" feature at all, or does not allow enabling or disabling it.)
        </p></dd><dt id="--fido2-with-user-verification=BOOL"><span class="term"><code class="option">--fido2-with-user-verification=</code><em class="replaceable"><code>BOOL</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--fido2-with-user-verification=BOOL">¶</a></dt><dd><p>When enrolling a FIDO2 security token, controls whether to require user verification
        when unlocking the account (the FIDO2 "<code class="literal">uv</code>" feature). Defaults to
        "<code class="literal">no</code>". (Note: this setting is without effect if the security token does not support
        the "<code class="literal">uv</code>" feature at all, or does not allow enabling or disabling it.)</p></dd><dt id="--recovery-key=BOOL"><span class="term"><code class="option">--recovery-key=</code><em class="replaceable"><code>BOOL</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--recovery-key=BOOL">¶</a></dt><dd><p>Accepts a boolean argument. If enabled a recovery key is configured for the
        account. A recovery key is a computer generated access key that may be used to regain access to an
        account if the password has been forgotten or the authentication token lost. The key is generated and
        shown on screen, and should be printed or otherwise transferred to a secure location. A recovery key
        may be entered instead of a regular password to unlock the account.</p></dd><dt id="--locked=BOOLEAN"><span class="term"><code class="option">--locked=</code><em class="replaceable"><code>BOOLEAN</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--locked=BOOLEAN">¶</a></dt><dd><p>Takes a boolean argument. Specifies whether this user account shall be locked. If
        true logins into this account are prohibited, if false (the default) they are permitted (of course,
        only if authorization otherwise succeeds).</p></dd><dt id="--not-before=TIMESTAMP"><span class="term"><code class="option">--not-before=</code><em class="replaceable"><code>TIMESTAMP</code></em>, </span><span class="term"><code class="option">--not-after=</code><em class="replaceable"><code>TIMESTAMP</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--not-before=TIMESTAMP">¶</a></dt><dd><p>These options take a timestamp string, in the format documented in
        <a href="systemd.time.html#"><span class="citerefentry"><span class="refentrytitle">systemd.time</span>(7)</span></a> and
        configures points in time before and after logins into this account are not
        permitted.</p></dd><dt id="--rate-limit-interval=SECS"><span class="term"><code class="option">--rate-limit-interval=</code><em class="replaceable"><code>SECS</code></em>, </span><span class="term"><code class="option">--rate-limit-burst=</code><em class="replaceable"><code>NUMBER</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--rate-limit-interval=SECS">¶</a></dt><dd><p>Configures a rate limit on authentication attempts for this user. If the user
        attempts to authenticate more often than the specified number, on a specific system, within the
        specified time interval authentication is refused until the time interval passes. Defaults to 10
        times per 1min.</p></dd><dt id="--password-hint=TEXT"><span class="term"><code class="option">--password-hint=</code><em class="replaceable"><code>TEXT</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--password-hint=TEXT">¶</a></dt><dd><p>Takes a password hint to store alongside the user record. This string is stored
        accessible only to privileged users and the user itself and may not be queried by other users.
        Example: <code class="option">--password-hint="My first pet's name"</code>.</p></dd><dt id="--enforce-password-policy=BOOL"><span class="term"><code class="option">--enforce-password-policy=</code><em class="replaceable"><code>BOOL</code></em>, </span><span class="term"><code class="option">-P</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--enforce-password-policy=BOOL">¶</a></dt><dd><p>Takes a boolean argument. Configures whether to enforce the system's password policy
        for this user, regarding quality and strength of selected passwords. Defaults to
        on. <code class="option">-P</code> is short for
        <code class="option">---enforce-password-policy=no</code>.</p></dd><dt id="--password-change-now=BOOL"><span class="term"><code class="option">--password-change-now=</code><em class="replaceable"><code>BOOL</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--password-change-now=BOOL">¶</a></dt><dd><p>Takes a boolean argument. If true the user is asked to change their password on next
        login.</p></dd><dt id="--password-change-min=TIME"><span class="term"><code class="option">--password-change-min=</code><em class="replaceable"><code>TIME</code></em>, </span><span class="term"><code class="option">--password-change-max=</code><em class="replaceable"><code>TIME</code></em>, </span><span class="term"><code class="option">--password-change-warn=</code><em class="replaceable"><code>TIME</code></em>, </span><span class="term"><code class="option">--password-change-inactive=</code><em class="replaceable"><code>TIME</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--password-change-min=TIME">¶</a></dt><dd><p>Each of these options takes a time span specification as argument (in the syntax
        documented in
        <a href="systemd.time.html#"><span class="citerefentry"><span class="refentrytitle">systemd.time</span>(7)</span></a>) and
        configures various aspects of the user's password expiration policy. Specifically,
        <code class="option">--password-change-min=</code> configures how much time has to pass after changing the
        password of the user until the password may be changed again. If the user tries to change their
        password before this time passes the attempt is refused. <code class="option">--password-change-max=</code>
        configures how soon after it has been changed the password expires and needs to be changed again.
        After this time passes logging in may only proceed after the password is changed.
        <code class="option">--password-change-warn=</code> specifies how much earlier than then the time configured
        with <code class="option">--password-change-max=</code> the user is warned at login to change their password as
        it will expire soon. Finally <code class="option">--password-change-inactive=</code> configures the time which
        has to pass after the password as expired until the user is not permitted to log in or change the
        password anymore. Note that these options only apply to password authentication, and do not apply to
        other forms of authentication, for example PKCS#11-based security token
        authentication.</p></dd><dt id="--disk-size=BYTES"><span class="term"><code class="option">--disk-size=</code><em class="replaceable"><code>BYTES</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--disk-size=BYTES">¶</a></dt><dd><p>Either takes a size in bytes as argument (possibly using the usual K, M, G, …
        suffixes for 1024 base values), or a percentage value and configures the disk space to assign to the
        user. If a percentage value is specified (i.e. the argument suffixed with "<code class="literal">%</code>") it is
        taken relative to the available disk space of the backing file system. If the LUKS2 backend is used
        this configures the size of the loopback file and file system contained therein. For the other
        storage backends configures disk quota using the filesystem's native quota logic, if available. If
        not specified, defaults to 85% of the available disk space for the LUKS2 backend and to no quota for
        the others.</p></dd><dt id="--access-mode=MODE"><span class="term"><code class="option">--access-mode=</code><em class="replaceable"><code>MODE</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--access-mode=MODE">¶</a></dt><dd><p>Takes a UNIX file access mode written in octal. Configures the access mode of the
        home directory itself. Note that this is only used when the directory is first created, and the user
        may change this any time afterwards. Example:
        <code class="option">--access-mode=0700</code></p></dd><dt id="--umask=MASK"><span class="term"><code class="option">--umask=</code><em class="replaceable"><code>MASK</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--umask=MASK">¶</a></dt><dd><p>Takes the access mode mask (in octal syntax) to apply to newly created files and
        directories of the user ("umask"). If set this controls the initial umask set for all login sessions of
        the user, possibly overriding the system's defaults.</p></dd><dt id="--nice=NICE"><span class="term"><code class="option">--nice=</code><em class="replaceable"><code>NICE</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--nice=NICE">¶</a></dt><dd><p>Takes the numeric scheduling priority ("nice level") to apply to the processes of the user at login
        time. Takes a numeric value in the range -20 (highest priority) to 19 (lowest priority).</p></dd><dt id="--rlimit=LIMIT=VALUE:VALUE"><span class="term"><code class="option">--rlimit=</code><em class="replaceable"><code>LIMIT</code></em>=<em class="replaceable"><code>VALUE</code></em>[<span class="optional">:<em class="replaceable"><code>VALUE</code></em></span>]</span><a class="headerlink" title="Permalink to this term" href="homectl.html#--rlimit=LIMIT=VALUE:VALUE">¶</a></dt><dd><p>Allows configuration of resource limits for processes of this user, see <a href="http://man7.org/linux/man-pages/man2/getrlimit.2.html"><span class="citerefentry"><span class="refentrytitle">getrlimit</span>(2)</span></a>
        for details. Takes a resource limit name (e.g. "<code class="literal">LIMIT_NOFILE</code>") followed by an equal
        sign, followed by a numeric limit. Optionally, separated by colon a second numeric limit may be
        specified. If two are specified this refers to the soft and hard limits, respectively. If only one
        limit is specified the setting sets both limits in one.</p></dd><dt id="--tasks-max=TASKS"><span class="term"><code class="option">--tasks-max=</code><em class="replaceable"><code>TASKS</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--tasks-max=TASKS">¶</a></dt><dd><p>Takes a non-zero unsigned integer as argument. Configures the maximum number of tasks
        (i.e. threads, where each process is at least one thread) the user may have at any given time. This
        limit applies to all tasks forked off the user's sessions, even if they change user identity via
        <a href="http://man7.org/linux/man-pages/man1/su.1.html"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a>
        or a similar tool. Use <code class="option">--rlimit=LIMIT_NPROC=</code> to place a limit on the tasks actually
        running under the UID of the user, thus excluding any child processes that might have changed user
        identity. This controls the <code class="varname">TasksMax=</code> setting of the per-user systemd slice unit
        <code class="filename">user-$UID.slice</code>. See
        <a href="systemd.resource-control.html#"><span class="citerefentry"><span class="refentrytitle">systemd.resource-control</span>(5)</span></a>
        for further details.</p></dd><dt id="--memory-high=BYTES"><span class="term"><code class="option">--memory-high=</code><em class="replaceable"><code>BYTES</code></em>, </span><span class="term"><code class="option">--memory-max=</code><em class="replaceable"><code>BYTES</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--memory-high=BYTES">¶</a></dt><dd><p>Set a limit on the memory a user may take up on a system at any given time in bytes
        (the usual K, M, G, … suffixes are supported, to the base of 1024). This includes all memory used by
        the user itself and all processes they forked off that changed user credentials. This controls the
        <code class="varname">MemoryHigh=</code> and <code class="varname">MemoryMax=</code> settings of the per-user systemd
        slice unit <code class="filename">user-$UID.slice</code>. See
        <a href="systemd.resource-control.html#"><span class="citerefentry"><span class="refentrytitle">systemd.resource-control</span>(5)</span></a>
        for further details.</p></dd><dt id="--cpu-weight=WEIGHT"><span class="term"><code class="option">--cpu-weight=</code><em class="replaceable"><code>WEIGHT</code></em>, </span><span class="term"><code class="option">--io-weight=</code><em class="replaceable"><code>WEIGHT</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--cpu-weight=WEIGHT">¶</a></dt><dd><p>Set CPU and IO scheduling weights of the processes of the user, including those of
        processes forked off by the user that changed user credentials. Takes a numeric value in the range
        1…10000. This controls the <code class="varname">CPUWeight=</code> and <code class="varname">IOWeight=</code> settings of
        the per-user systemd slice unit <code class="filename">user-$UID.slice</code>. See
        <a href="systemd.resource-control.html#"><span class="citerefentry"><span class="refentrytitle">systemd.resource-control</span>(5)</span></a>
        for further details.</p></dd><dt id="--storage=STORAGE"><span class="term"><code class="option">--storage=</code><em class="replaceable"><code>STORAGE</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--storage=STORAGE">¶</a></dt><dd><p>Selects the storage mechanism to use for this home directory. Takes one of
        "<code class="literal">luks</code>", "<code class="literal">fscrypt</code>", "<code class="literal">directory</code>",
        "<code class="literal">subvolume</code>", "<code class="literal">cifs</code>". For details about these mechanisms, see
        above. If a new home directory is created and the storage type is not specifically specified,
        <a href="homed.conf.html#"><span class="citerefentry"><span class="refentrytitle">homed.conf</span>(5)</span></a>
        defines which default storage to use.</p></dd><dt id="--image-path=PATH"><span class="term"><code class="option">--image-path=</code><em class="replaceable"><code>PATH</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--image-path=PATH">¶</a></dt><dd><p>Takes a file system path. Configures where to place the user's home directory. When
        LUKS2 storage is used refers to the path to the loopback file, otherwise to the path to the home
        directory (which may be in <code class="filename">/home/</code> or any other accessible filesystem). When
        unspecified defaults to <code class="filename">/home/$USER.home</code> when LUKS storage is used and
        <code class="filename">/home/$USER.homedir</code> for the other storage mechanisms. Not defined for the
        "<code class="literal">cifs</code>" storage mechanism. To use LUKS2 storage on a regular block device (for
        example a USB stick) pass the path to the block device here. Specifying the path to a directory here
        when using LUKS2 storage is not allowed. Similar, specifying the path to a regular file or device
        node is not allowed if any of the other storage backends are used.</p></dd><dt id="--fs-type=TYPE"><span class="term"><code class="option">--fs-type=</code><em class="replaceable"><code>TYPE</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--fs-type=TYPE">¶</a></dt><dd><p>When LUKS2 storage is used configures the file system type to use inside the home
        directory LUKS2 container. One of "<code class="literal">btrfs</code>", "<code class="literal">ext4</code>",
        "<code class="literal">xfs</code>". If not specified
        <a href="homed.conf.html#"><span class="citerefentry"><span class="refentrytitle">homed.conf</span>(5)</span></a>
        defines which default file system type to use. Note that "<code class="literal">xfs</code>" is not recommended as
        its support for file system resizing is too limited.</p></dd><dt id="--luks-discard=BOOL"><span class="term"><code class="option">--luks-discard=</code><em class="replaceable"><code>BOOL</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--luks-discard=BOOL">¶</a></dt><dd><p>When LUKS2 storage is used configures whether to enable the
        "<code class="literal">discard</code>" feature of the file system. If enabled the file system on top of the LUKS2
        volume will report empty block information to LUKS2 and the loopback file below, ensuring that empty
        space in the home directory is returned to the backing file system below the LUKS2 volume, resulting
        in a "sparse" loopback file. This option mostly defaults to off, since this permits over-committing
        home directories which results in I/O errors if the underlying file system runs full while the upper
        file system wants to allocate a block. Such I/O errors are generally not handled well by file systems
        nor applications. When LUKS2 storage is used on top of regular block devices (instead of on top a
        loopback file) the discard logic defaults to on.</p></dd><dt id="--luks-offline-discard=BOOL"><span class="term"><code class="option">--luks-offline-discard=</code><em class="replaceable"><code>BOOL</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--luks-offline-discard=BOOL">¶</a></dt><dd><p>Similar to <code class="option">--luks-discard=</code>, controls the trimming of the file
        system. However, while <code class="option">--luks-discard=</code> controls what happens when the home directory
        is active, <code class="option">--luks-offline-discard=</code> controls what happens when it becomes inactive,
        i.e. whether to trim/allocate the storage when deactivating the home directory. This option defaults
        to on, to ensure disk space is minimized while a user is not logged in.</p></dd><dt id="--luks-cipher=CIPHER"><span class="term"><code class="option">--luks-cipher=</code><em class="replaceable"><code>CIPHER</code></em>, </span><span class="term"><code class="option">--luks-cipher-mode=</code><em class="replaceable"><code>MODE</code></em>, </span><span class="term"><code class="option">--luks-volume-key-size=</code><em class="replaceable"><code>BITS</code></em>, </span><span class="term"><code class="option">--luks-pbkdf-type=</code><em class="replaceable"><code>TYPE</code></em>, </span><span class="term"><code class="option">--luks-pbkdf-hash-algorithm=</code><em class="replaceable"><code>ALGORITHM</code></em>, </span><span class="term"><code class="option">--luks-pbkdf-time-cost=</code><em class="replaceable"><code>SECONDS</code></em>, </span><span class="term"><code class="option">--luks-pbkdf-memory-cost=</code><em class="replaceable"><code>BYTES</code></em>, </span><span class="term"><code class="option">--luks-pbkdf-parallel-threads=</code><em class="replaceable"><code>THREADS</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--luks-cipher=CIPHER">¶</a></dt><dd><p>Configures various cryptographic parameters for the LUKS2 storage mechanism. See
        <a href="http://man7.org/linux/man-pages/man8/cryptsetup.8.html"><span class="citerefentry"><span class="refentrytitle">cryptsetup</span>(8)</span></a>
        for details on the specific attributes.</p></dd><dt id="--nosuid=BOOL"><span class="term"><code class="option">--nosuid=</code><em class="replaceable"><code>BOOL</code></em>, </span><span class="term"><code class="option">--nodev=</code><em class="replaceable"><code>BOOL</code></em>, </span><span class="term"><code class="option">--noexec=</code><em class="replaceable"><code>BOOL</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--nosuid=BOOL">¶</a></dt><dd><p>Configures the "<code class="literal">nosuid</code>", "<code class="literal">nodev</code>" and
        "<code class="literal">noexec</code>" mount options for the home directories. By default "<code class="literal">nodev</code>"
        and "<code class="literal">nosuid</code>" are on, while "<code class="literal">noexec</code>" is off. For details about these
        mount options see <a href="http://man7.org/linux/man-pages/man8/mount.8.html"><span class="citerefentry"><span class="refentrytitle">mount</span>(8)</span></a>.</p></dd><dt id="--cifs-domain=DOMAIN"><span class="term"><code class="option">--cifs-domain=</code><em class="replaceable"><code>DOMAIN</code></em>, </span><span class="term"><code class="option">--cifs-user-name=</code><em class="replaceable"><code>USER</code></em>, </span><span class="term"><code class="option">--cifs-service=</code><em class="replaceable"><code>SERVICE</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--cifs-domain=DOMAIN">¶</a></dt><dd><p>Configures the Windows File Sharing (CIFS) domain and user to associate with the home
        directory/user account, as well as the file share ("service") to mount as directory. The latter is used when
        "<code class="literal">cifs</code>" storage is selected.</p></dd><dt id="--stop-delay=SECS"><span class="term"><code class="option">--stop-delay=</code><em class="replaceable"><code>SECS</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--stop-delay=SECS">¶</a></dt><dd><p>Configures the time the per-user service manager shall continue to run after the all
        sessions of the user ended. The default is configured in
        <a href="logind.conf.html#"><span class="citerefentry"><span class="refentrytitle">logind.conf</span>(5)</span></a> (for
        home directories of LUKS2 storage located on removable media this defaults to 0 though). A longer
        time makes sure quick, repetitive logins are more efficient as the user's service manager doesn't
        have to be started every time.</p></dd><dt id="--kill-processes=BOOL"><span class="term"><code class="option">--kill-processes=</code><em class="replaceable"><code>BOOL</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--kill-processes=BOOL">¶</a></dt><dd><p>Configures whether to kill all processes of the user on logout. The default is
        configured in
        <a href="logind.conf.html#"><span class="citerefentry"><span class="refentrytitle">logind.conf</span>(5)</span></a>.</p></dd><dt id="--auto-login=BOOL"><span class="term"><code class="option">--auto-login=</code><em class="replaceable"><code>BOOL</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#--auto-login=BOOL">¶</a></dt><dd><p>Takes a boolean argument. Configures whether the graphical UI of the system should
        automatically log this user in if possible. Defaults to off. If less or more than one user is marked
        this way automatic login is disabled.</p></dd></dl></div></div><div class="refsect1"><a name="id-1.8"></a><h2 id="Commands">Commands<a class="headerlink" title="Permalink to this headline" href="homectl.html#Commands">¶</a></h2><p>The following commands are understood:</p><div class="variablelist"><dl class="variablelist"><dt id="list"><span class="term"><span class="command"><strong>list</strong></span></span><a class="headerlink" title="Permalink to this term" href="homectl.html#list">¶</a></dt><dd><p>List all home directories (along with brief details) currently managed by
        <code class="filename">systemd-homed.service</code>. This command is also executed if none is specified on the
        command line. (Note that the list of users shown by this command does not include users managed by
        other subsystems, such as system users or any traditional users listed in
        <code class="filename">/etc/passwd</code>.)</p></dd><dt id="activate USER [USER…]"><span class="term"><span class="command"><strong>activate</strong></span> <em class="replaceable"><code>USER</code></em> [<em class="replaceable"><code>USER…</code></em>]</span><a class="headerlink" title="Permalink to this term" href="homectl.html#activate%20USER%20%5BUSER%E2%80%A6%5D">¶</a></dt><dd><p>Activate one or more home directories. The home directories of each listed user will
        be activated and made available under their mount points (typically in
        <code class="filename">/home/$USER</code>). Note that any home activated this way stays active indefinitely,
        until it is explicitly deactivated again (with <span class="command"><strong>deactivate</strong></span>, see below), or the user
        logs in and out again and it thus is deactivated due to the automatic deactivation-on-logout
        logic.</p><p>Activation of a home directory involves various operations that depend on the selected storage
        mechanism. If the LUKS2 mechanism is used, this generally involves: inquiring the user for a
        password, setting up a loopback device, validating and activating the LUKS2 volume, checking the file
        system, mounting the file system, and potentially changing the ownership of all included files to the
        correct UID/GID.</p></dd><dt id="deactivate USER [USER…]"><span class="term"><span class="command"><strong>deactivate</strong></span> <em class="replaceable"><code>USER</code></em> [<em class="replaceable"><code>USER…</code></em>]</span><a class="headerlink" title="Permalink to this term" href="homectl.html#deactivate%20USER%20%5BUSER%E2%80%A6%5D">¶</a></dt><dd><p>Deactivate one or more home directories. This undoes the effect of
        <span class="command"><strong>activate</strong></span>.</p></dd><dt id="inspect USER [USER…]"><span class="term"><span class="command"><strong>inspect</strong></span> <em class="replaceable"><code>USER</code></em> [<em class="replaceable"><code>USER…</code></em>]</span><a class="headerlink" title="Permalink to this term" href="homectl.html#inspect%20USER%20%5BUSER%E2%80%A6%5D">¶</a></dt><dd><p>Show various details about the specified home directories. This shows various
        information about the home directory and its user account, including runtime data such as current
        state, disk use and similar. Combine with <code class="option">--json=</code> to show the detailed JSON user
        record instead, possibly combined with <code class="option">--export-format=</code> to suppress certain aspects
        of the output.</p></dd><dt id="authenticate USER [USER…]"><span class="term"><span class="command"><strong>authenticate</strong></span> <em class="replaceable"><code>USER</code></em> [<em class="replaceable"><code>USER…</code></em>]</span><a class="headerlink" title="Permalink to this term" href="homectl.html#authenticate%20USER%20%5BUSER%E2%80%A6%5D">¶</a></dt><dd><p>Validate authentication credentials of a home directory. This queries the caller for
        a password (or similar) and checks that it correctly unlocks the home directory. This leaves the home
        directory in the state it is in, i.e. it leaves the home directory in inactive state if it was
        inactive before, and in active state if it was active before.</p></dd><dt id="create USER"><span class="term"><span class="command"><strong>create</strong></span> <em class="replaceable"><code>USER</code></em>, </span><span class="term"><span class="command"><strong>create</strong></span> <code class="option">--identity=</code><em class="replaceable"><code>PATH</code></em> [<span class="optional"><em class="replaceable"><code>USER</code></em></span>]</span><a class="headerlink" title="Permalink to this term" href="homectl.html#create%20USER">¶</a></dt><dd><p>Create a new home directory/user account of the specified name. Use the various
        user record property options (as documented above) to control various aspects of the home directory
        and its user accounts.</p><p>The specified user name should follow the strict syntax described on <a class="ulink" href="https://systemd.io/USER_NAMES" target="_top">User/Group Name Syntax</a>.</p></dd><dt id="remove USER"><span class="term"><span class="command"><strong>remove</strong></span> <em class="replaceable"><code>USER</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#remove%20USER">¶</a></dt><dd><p>Remove a home directory/user account. This will remove both the home directory's user
        record and the home directory itself, and thus delete all files and directories owned by the
        user.</p></dd><dt id="update USER"><span class="term"><span class="command"><strong>update</strong></span> <em class="replaceable"><code>USER</code></em>, </span><span class="term"><span class="command"><strong>update</strong></span> <code class="option">--identity=</code><em class="replaceable"><code>PATH</code></em> [<span class="optional"><em class="replaceable"><code>USER</code></em></span>]</span><a class="headerlink" title="Permalink to this term" href="homectl.html#update%20USER">¶</a></dt><dd><p>Update a home directory/user account. Use the various user record property options
        (as documented above) to make changes to the account, or alternatively provide a full, updated JSON
        user record via the <code class="option">--identity=</code> option.</p><p>Note that changes to user records not signed by a cryptographic private key available locally
        are not permitted, unless <code class="option">--identity=</code> is used with a user record that is already
        correctly signed by a recognized private key.</p></dd><dt id="passwd USER"><span class="term"><span class="command"><strong>passwd</strong></span> <em class="replaceable"><code>USER</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#passwd%20USER">¶</a></dt><dd><p>Change the password of the specified home directory/user account.</p></dd><dt id="resize USER BYTES"><span class="term"><span class="command"><strong>resize</strong></span> <em class="replaceable"><code>USER</code></em> <em class="replaceable"><code>BYTES</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#resize%20USER%20BYTES">¶</a></dt><dd><p>Change the disk space assigned to the specified home directory. If the LUKS2 storage
        mechanism is used this will automatically resize the loopback file and the file system contained
        within. Note that if "<code class="literal">ext4</code>" is used inside of the LUKS2 volume, it is necessary to
        deactivate the home directory before shrinking it (i.e the user has to log out). Growing can be done
        while the home directory is active. If "<code class="literal">xfs</code>" is used inside of the LUKS2 volume the
        home directory may not be shrunk whatsoever. On all three of "<code class="literal">ext4</code>",
        "<code class="literal">xfs</code>" and "<code class="literal">btrfs</code>" the home directory may be grown while the user is
        logged in, and on the latter also shrunk while the user is logged in. If the
        "<code class="literal">subvolume</code>", "<code class="literal">directory</code>", "<code class="literal">fscrypt</code>" storage
        mechanisms are used, resizing will change file system quota.</p></dd><dt id="lock USER"><span class="term"><span class="command"><strong>lock</strong></span> <em class="replaceable"><code>USER</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#lock%20USER">¶</a></dt><dd><p>Temporarily suspend access to the user's home directory and remove any associated
        cryptographic keys from memory. Any attempts to access the user's home directory will stall until the
        home directory is unlocked again (i.e. re-authenticated). This functionality is primarily intended to
        be used during system suspend to make sure the user's data cannot be accessed until the user
        re-authenticates on resume. This operation is only defined for home directories that use the LUKS2
        storage mechanism.</p></dd><dt id="unlock USER"><span class="term"><span class="command"><strong>unlock</strong></span> <em class="replaceable"><code>USER</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#unlock%20USER">¶</a></dt><dd><p>Resume access to the user's home directory again, undoing the effect of
        <span class="command"><strong>lock</strong></span> above. This requires authentication of the user, as the cryptographic keys
        required for access to the home directory need to be reacquired.</p></dd><dt id="lock-all"><span class="term"><span class="command"><strong>lock-all</strong></span></span><a class="headerlink" title="Permalink to this term" href="homectl.html#lock-all">¶</a></dt><dd><p>Execute the <span class="command"><strong>lock</strong></span> command on all suitable home directories at
        once. This operation is generally executed on system suspend (i.e. by <span class="command"><strong>systemctl
        suspend</strong></span> and related commands), to ensure all active user's cryptographic keys for accessing
        their home directories are removed from memory.</p></dd><dt id="deactivate-all"><span class="term"><span class="command"><strong>deactivate-all</strong></span></span><a class="headerlink" title="Permalink to this term" href="homectl.html#deactivate-all">¶</a></dt><dd><p>Execute the <span class="command"><strong>deactivate</strong></span> command on all active home directories at
        once. This operation is generally executed on system shut down (i.e. by <span class="command"><strong>systemctl
        poweroff</strong></span> and related commands), to ensure all active user's home directories are fully
        deactivated before <code class="filename">/home/</code> and related file systems are unmounted.</p></dd><dt id="with USER COMMAND…"><span class="term"><span class="command"><strong>with</strong></span> <em class="replaceable"><code>USER</code></em> <em class="replaceable"><code>COMMAND…</code></em></span><a class="headerlink" title="Permalink to this term" href="homectl.html#with%20USER%20COMMAND%E2%80%A6">¶</a></dt><dd><p>Activate the specified user's home directory, run the specified command (under the
        caller's identity, not the specified user's) and deactivate the home directory afterwards again
        (unless the user is logged in otherwise). This command is useful for running privileged backup
        scripts and such, but requires authentication with the user's credentials in order to be able to
        unlock the user's home directory.</p></dd></dl></div></div><div class="refsect1"><a name="id-1.9"></a><h2 id="Exit status">Exit status<a class="headerlink" title="Permalink to this headline" href="homectl.html#Exit%20status">¶</a></h2><p>On success, 0 is returned, a non-zero failure code otherwise.</p><p>When a command is invoked with <span class="command"><strong>with</strong></span>, the exit status of the child is
    propagated. Effectively, <span class="command"><strong>homectl</strong></span> will exit without error if the command is
    successfully invoked <span class="emphasis"><em>and</em></span> finishes successfully.</p></div><div class="refsect1"><a name="id-1.10"></a><h2 id="Environment">Environment<a class="headerlink" title="Permalink to this headline" href="homectl.html#Environment">¶</a></h2><div class="variablelist"><dl class="variablelist"><dt id="$SYSTEMD_LOG_LEVEL"><span class="term"><code class="varname">$SYSTEMD_LOG_LEVEL</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#%24SYSTEMD_LOG_LEVEL">¶</a></dt><dd><p><a name="log-level-body"></a>The maximum log level of emitted messages (messages with a higher
      log level, i.e. less important ones, will be suppressed). Either one of (in order of decreasing
      importance) <code class="constant">emerg</code>, <code class="constant">alert</code>, <code class="constant">crit</code>,
      <code class="constant">err</code>, <code class="constant">warning</code>, <code class="constant">notice</code>,
      <code class="constant">info</code>, <code class="constant">debug</code>, or an integer in the range 0…7. See
      <a href="http://man7.org/linux/man-pages/man3/syslog.3.html"><span class="citerefentry"><span class="refentrytitle">syslog</span>(3)</span></a>
      for more information.</p></dd><dt id="$SYSTEMD_LOG_COLOR"><span class="term"><code class="varname">$SYSTEMD_LOG_COLOR</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#%24SYSTEMD_LOG_COLOR">¶</a></dt><dd><p><a name="log-color-body"></a>A boolean. If true, messages written to the tty will be colored
      according to priority.</p><p>This setting is only useful when messages are written directly to the terminal, because
      <a href="journalctl.html#"><span class="citerefentry"><span class="refentrytitle">journalctl</span>(1)</span></a> and
      other tools that display logs will color messages based on the log level on their own.</p></dd><dt id="$SYSTEMD_LOG_TIME"><span class="term"><code class="varname">$SYSTEMD_LOG_TIME</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#%24SYSTEMD_LOG_TIME">¶</a></dt><dd><p><a name="log-time-body"></a>A boolean. If true, console log messages will be prefixed with a
      timestamp.</p><p>This setting is only useful when messages are written directly to the terminal or a file, because
      <a href="journalctl.html#"><span class="citerefentry"><span class="refentrytitle">journalctl</span>(1)</span></a> and
      other tools that display logs will attach timestamps based on the entry metadata on their own.</p></dd><dt id="$SYSTEMD_LOG_LOCATION"><span class="term"><code class="varname">$SYSTEMD_LOG_LOCATION</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#%24SYSTEMD_LOG_LOCATION">¶</a></dt><dd><p><a name="log-location-body"></a>A boolean. If true, messages will be prefixed with a filename
      and line number in the source code where the message originates.</p><p>Note that the log location is often attached as metadata to journal entries anyway. Including it
      directly in the message text can nevertheless be convenient when debugging programs.</p></dd><dt id="$SYSTEMD_LOG_TID"><span class="term"><code class="varname">$SYSTEMD_LOG_TID</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#%24SYSTEMD_LOG_TID">¶</a></dt><dd><p><a name="log-tid-body"></a>A boolean. If true, messages will be prefixed with the current
      numerical thread ID (TID).</p><p>Note that the this information is attached as metadata to journal entries anyway. Including it
      directly in the message text can nevertheless be convenient when debugging programs.</p></dd><dt id="$SYSTEMD_LOG_TARGET"><span class="term"><code class="varname">$SYSTEMD_LOG_TARGET</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#%24SYSTEMD_LOG_TARGET">¶</a></dt><dd><p><a name="log-target-body"></a>The destination for log messages. One of
      <code class="constant">console</code> (log to the attached tty), <code class="constant">console-prefixed</code> (log to
      the attached tty but with prefixes encoding the log level and "facility", see <a href="http://man7.org/linux/man-pages/man3/syslog.3.html"><span class="citerefentry"><span class="refentrytitle">syslog</span>(3)</span></a>,
      <code class="constant">kmsg</code> (log to the kernel circular log buffer), <code class="constant">journal</code> (log to
      the journal), <code class="constant">journal-or-kmsg</code> (log to the journal if available, and to kmsg
      otherwise), <code class="constant">auto</code> (determine the appropriate log target automatically, the default),
      <code class="constant">null</code> (disable log output).</p></dd><dt id="$SYSTEMD_PAGER"><span class="term"><code class="varname">$SYSTEMD_PAGER</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#%24SYSTEMD_PAGER">¶</a></dt><dd><p>Pager to use when <code class="option">--no-pager</code> is not given; overrides
      <code class="varname">$PAGER</code>. If neither <code class="varname">$SYSTEMD_PAGER</code> nor <code class="varname">$PAGER</code> are set, a
      set of well-known pager implementations are tried in turn, including
      <a href="http://man7.org/linux/man-pages/man1/less.1.html"><span class="citerefentry"><span class="refentrytitle">less</span>(1)</span></a> and
      <a href="http://man7.org/linux/man-pages/man1/more.1.html"><span class="citerefentry"><span class="refentrytitle">more</span>(1)</span></a>, until one is found. If
      no pager implementation is discovered no pager is invoked. Setting this environment variable to an empty string
      or the value "<code class="literal">cat</code>" is equivalent to passing <code class="option">--no-pager</code>.</p></dd><dt id="$SYSTEMD_LESS"><span class="term"><code class="varname">$SYSTEMD_LESS</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#%24SYSTEMD_LESS">¶</a></dt><dd><p>Override the options passed to <span class="command"><strong>less</strong></span> (by default
      "<code class="literal">FRSXMK</code>").</p><p>Users might want to change two options in particular:</p><div class="variablelist"><dl class="variablelist"><dt id="K"><span class="term"><code class="option">K</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#K">¶</a></dt><dd></dd><dt id="X"><span class="term"><code class="option">X</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#X">¶</a></dt><dd></dd></dl></div><p>See
      <a href="http://man7.org/linux/man-pages/man1/less.1.html"><span class="citerefentry"><span class="refentrytitle">less</span>(1)</span></a>
      for more discussion.</p></dd><dt id="$SYSTEMD_LESSCHARSET"><span class="term"><code class="varname">$SYSTEMD_LESSCHARSET</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#%24SYSTEMD_LESSCHARSET">¶</a></dt><dd><p>Override the charset passed to <span class="command"><strong>less</strong></span> (by default "<code class="literal">utf-8</code>", if
      the invoking terminal is determined to be UTF-8 compatible).</p></dd><dt id="$SYSTEMD_PAGERSECURE"><span class="term"><code class="varname">$SYSTEMD_PAGERSECURE</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#%24SYSTEMD_PAGERSECURE">¶</a></dt><dd><p>Takes a boolean argument. When true, the "secure" mode of the pager is enabled; if
      false, disabled. If <code class="varname">$SYSTEMD_PAGERSECURE</code> is not set at all, secure mode is enabled
      if the effective UID is not the same as the owner of the login session, see
      <a href="http://man7.org/linux/man-pages/man2/geteuid.2.html"><span class="citerefentry"><span class="refentrytitle">geteuid</span>(2)</span></a>
      and <a href="sd_pid_get_owner_uid.html#"><span class="citerefentry"><span class="refentrytitle">sd_pid_get_owner_uid</span>(3)</span></a>.
      In secure mode, <code class="option">LESSSECURE=1</code> will be set when invoking the pager, and the pager shall
      disable commands that open or create new files or start new subprocesses. When
      <code class="varname">$SYSTEMD_PAGERSECURE</code> is not set at all, pagers which are not known to implement
      secure mode will not be used. (Currently only
      <a href="http://man7.org/linux/man-pages/man1/less.1.html"><span class="citerefentry"><span class="refentrytitle">less</span>(1)</span></a>
      implements secure mode.)</p><p>Note: when commands are invoked with elevated privileges, for example under <a href="http://man7.org/linux/man-pages/man8/sudo.8.html"><span class="citerefentry"><span class="refentrytitle">sudo</span>(8)</span></a> or
      <a href="http://linux.die.net/man/1/pkexec"><span class="citerefentry"><span class="refentrytitle">pkexec</span>(1)</span></a>, care
      must be taken to ensure that unintended interactive features are not enabled. "Secure" mode for the
      pager may be enabled automatically as describe above. Setting <code class="varname">SYSTEMD_PAGERSECURE=0</code>
      or not removing it from the inherited environment allows the user to invoke arbitrary commands. Note
      that if the <code class="varname">$SYSTEMD_PAGER</code> or <code class="varname">$PAGER</code> variables are to be
      honoured, <code class="varname">$SYSTEMD_PAGERSECURE</code> must be set too. It might be reasonable to completely
      disable the pager using <code class="option">--no-pager</code> instead.</p></dd><dt id="$SYSTEMD_COLORS"><span class="term"><code class="varname">$SYSTEMD_COLORS</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#%24SYSTEMD_COLORS">¶</a></dt><dd><p>Takes a boolean argument. When true, <span class="command"><strong>systemd</strong></span> and related utilities
      will use colors in their output, otherwise the output will be monochrome. Additionally, the variable can
      take one of the following special values: "<code class="literal">16</code>", "<code class="literal">256</code>" to restrict the use
      of colors to the base 16 or 256 ANSI colors, respectively. This can be specified to override the automatic
      decision based on <code class="varname">$TERM</code> and what the console is connected to.</p></dd><dt id="$SYSTEMD_URLIFY"><span class="term"><code class="varname">$SYSTEMD_URLIFY</code></span><a class="headerlink" title="Permalink to this term" href="homectl.html#%24SYSTEMD_URLIFY">¶</a></dt><dd><p>The value must be a boolean. Controls whether clickable links should be generated in
      the output for terminal emulators supporting this. This can be specified to override the decision that
      <span class="command"><strong>systemd</strong></span> makes based on <code class="varname">$TERM</code> and other conditions.</p></dd></dl></div></div><div class="refsect1"><a name="id-1.11"></a><h2 id="Examples">Examples<a class="headerlink" title="Permalink to this headline" href="homectl.html#Examples">¶</a></h2><div class="example"><a name="id-1.11.2"></a><p class="title"><b>Example 1. Create a user "<code class="literal">waldo</code>" in the administrator group "<code class="literal">wheel</code>", and
      assign 500 MiB disk space to them.</b></p><div class="example-contents"><pre class="programlisting">homectl create waldo --real-name="Waldo McWaldo" -G wheel --disk-size=500M</pre></div></div><br class="example-break"><div class="example"><a name="id-1.11.3"></a><p class="title"><b>Example 2. Create a user "<code class="literal">wally</code>" on a USB stick, and assign a maximum of 500 concurrent
      tasks to them.</b></p><div class="example-contents"><pre class="programlisting">homectl create wally --real-name="Wally McWally" --image-path=/dev/disk/by-id/usb-SanDisk_Ultra_Fit_476fff954b2b5c44-0:0 --tasks-max=500</pre></div></div><br class="example-break"><div class="example"><a name="id-1.11.4"></a><p class="title"><b>Example 3. Change nice level of user "<code class="literal">odlaw</code>" to +5 and make sure the environment variable
      <code class="varname">$SOME</code> is set to the string "<code class="literal">THING</code>" for them on login.</b></p><div class="example-contents"><pre class="programlisting">homectl update odlaw --nice=5 --setenv=SOME=THING</pre></div></div><br class="example-break"><div class="example"><a name="id-1.11.5"></a><p class="title"><b>Example 4. Set up authentication with a YubiKey security token using PKCS#11/PIV:</b></p><div class="example-contents"><pre class="programlisting"># Clear the Yubikey from any old keys (careful!)
ykman piv reset

# Generate a new private/public key pair on the device, store the public key in 'pubkey.pem'.
ykman piv generate-key -a RSA2048 9d pubkey.pem

# Create a self-signed certificate from this public key, and store it on the device.
ykman piv generate-certificate --subject "Knobelei" 9d pubkey.pem

# We don't need the public key on disk anymore
rm pubkey.pem

# Allow the security token to unlock the account of user 'lafcadio'.
homectl update lafcadio --pkcs11-token-uri=auto</pre></div></div><br class="example-break"><div class="example"><a name="id-1.11.6"></a><p class="title"><b>Example 5. Set up authentication with a FIDO2 security token:</b></p><div class="example-contents"><pre class="programlisting"># Allow a FIDO2 security token to unlock the account of user 'nihilbaxter'.
homectl update nihilbaxter --fido2-device=auto</pre></div></div><br class="example-break"></div><div class="refsect1"><a name="id-1.12"></a><h2 id="See Also">See Also<a class="headerlink" title="Permalink to this headline" href="homectl.html#See%20Also">¶</a></h2><p>
      <a href="systemd.html#"><span class="citerefentry"><span class="refentrytitle">systemd</span>(1)</span></a>,
      <a href="systemd-homed.service.html#"><span class="citerefentry"><span class="refentrytitle">systemd-homed.service</span>(8)</span></a>,
      <a href="homed.conf.html#"><span class="citerefentry"><span class="refentrytitle">homed.conf</span>(5)</span></a>,
      <a href="userdbctl.html#"><span class="citerefentry"><span class="refentrytitle">userdbctl</span>(1)</span></a>,
      <a href="http://man7.org/linux/man-pages/man8/useradd.8.html"><span class="citerefentry"><span class="refentrytitle">useradd</span>(8)</span></a>,
      <a href="http://man7.org/linux/man-pages/man8/cryptsetup.8.html"><span class="citerefentry"><span class="refentrytitle">cryptsetup</span>(8)</span></a>
    </p></div></div></body></html>
