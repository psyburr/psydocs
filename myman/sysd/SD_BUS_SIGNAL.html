<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>sd_bus_add_object</title><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><style>
    a.headerlink {
      color: #c60f0f;
      font-size: 0.8em;
      padding: 0 4px 0 4px;
      text-decoration: none;
      visibility: hidden;
    }

    a.headerlink:hover {
      background-color: #c60f0f;
      color: white;
    }

    h1:hover > a.headerlink, h2:hover > a.headerlink, h3:hover > a.headerlink, dt:hover > a.headerlink {
      visibility: visible;
    }
  </style><a href="index.html">Index </a>·
  <a href="systemd.directives.html">Directives </a><span style="float:right">systemd 249</span><hr><div class="refentry"><a name="sd_bus_add_object"></a><div class="titlepage"></div><div class="refnamediv"><h2>Name</h2><p>sd_bus_add_object, sd_bus_add_fallback, sd_bus_add_object_vtable, sd_bus_add_fallback_vtable, sd_bus_add_filter, SD_BUS_VTABLE_START, SD_BUS_VTABLE_END, SD_BUS_METHOD_WITH_NAMES_OFFSET, SD_BUS_METHOD_WITH_NAMES, SD_BUS_METHOD_WITH_OFFSET, SD_BUS_METHOD, SD_BUS_SIGNAL_WITH_NAMES, SD_BUS_SIGNAL, SD_BUS_WRITABLE_PROPERTY, SD_BUS_PROPERTY, SD_BUS_PARAM — Declare properties and methods for a D-Bus path</p></div><div class="refsynopsisdiv"><h2>Synopsis</h2><div class="funcsynopsis"><pre class="funcsynopsisinfo">#include &lt;systemd/sd-bus-vtable.h&gt;</pre><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">typedef int (*<b class="fsfunc">sd_bus_message_handler_t</b>)(</code></td><td>sd_bus_message *<var class="pdparam">m</var>, </td></tr><tr><td> </td><td>void *<var class="pdparam">userdata</var>, </td></tr><tr><td> </td><td>sd_bus_error *<var class="pdparam">ret_error</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">typedef int (*<b class="fsfunc">sd_bus_property_get_t</b>)(</code></td><td>sd_bus *<var class="pdparam">bus</var>, </td></tr><tr><td> </td><td>const char *<var class="pdparam">path</var>, </td></tr><tr><td> </td><td>const char *<var class="pdparam">interface</var>, </td></tr><tr><td> </td><td>const char *<var class="pdparam">property</var>, </td></tr><tr><td> </td><td>sd_bus_message *<var class="pdparam">reply</var>, </td></tr><tr><td> </td><td>void *<var class="pdparam">userdata</var>, </td></tr><tr><td> </td><td>sd_bus_error *<var class="pdparam">ret_error</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">typedef int (*<b class="fsfunc">sd_bus_property_set_t</b>)(</code></td><td>sd_bus *<var class="pdparam">bus</var>, </td></tr><tr><td> </td><td>const char *<var class="pdparam">path</var>, </td></tr><tr><td> </td><td>const char *<var class="pdparam">interface</var>, </td></tr><tr><td> </td><td>const char *<var class="pdparam">property</var>, </td></tr><tr><td> </td><td>sd_bus_message *<var class="pdparam">value</var>, </td></tr><tr><td> </td><td>void *<var class="pdparam">userdata</var>, </td></tr><tr><td> </td><td>sd_bus_error *<var class="pdparam">ret_error</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">typedef int (*<b class="fsfunc">sd_bus_object_find_t</b>)(</code></td><td>const char *<var class="pdparam">path</var>, </td></tr><tr><td> </td><td>const char *<var class="pdparam">interface</var>, </td></tr><tr><td> </td><td>void *<var class="pdparam">userdata</var>, </td></tr><tr><td> </td><td>void **<var class="pdparam">ret_found</var>, </td></tr><tr><td> </td><td>sd_bus_error *<var class="pdparam">ret_error</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">sd_bus_add_object</b>(</code></td><td>sd_bus *<var class="pdparam">bus</var>, </td></tr><tr><td> </td><td>sd_bus_slot **<var class="pdparam">slot</var>, </td></tr><tr><td> </td><td>const char *<var class="pdparam">path</var>, </td></tr><tr><td> </td><td>sd_bus_message_handler_t <var class="pdparam">callback</var>, </td></tr><tr><td> </td><td>void *<var class="pdparam">userdata</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">sd_bus_add_fallback</b>(</code></td><td>sd_bus *<var class="pdparam">bus</var>, </td></tr><tr><td> </td><td>sd_bus_slot **<var class="pdparam">slot</var>, </td></tr><tr><td> </td><td>const char *<var class="pdparam">path</var>, </td></tr><tr><td> </td><td>sd_bus_message_handler_t <var class="pdparam">callback</var>, </td></tr><tr><td> </td><td>void *<var class="pdparam">userdata</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">sd_bus_add_object_vtable</b>(</code></td><td>sd_bus *<var class="pdparam">bus</var>, </td></tr><tr><td> </td><td>sd_bus_slot **<var class="pdparam">slot</var>, </td></tr><tr><td> </td><td>const char *<var class="pdparam">path</var>, </td></tr><tr><td> </td><td>const char *<var class="pdparam">interface</var>, </td></tr><tr><td> </td><td>const sd_bus_vtable *<var class="pdparam">vtable</var>, </td></tr><tr><td> </td><td>void *<var class="pdparam">userdata</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">sd_bus_add_fallback_vtable</b>(</code></td><td>sd_bus *<var class="pdparam">bus</var>, </td></tr><tr><td> </td><td>sd_bus_slot **<var class="pdparam">slot</var>, </td></tr><tr><td> </td><td>const char *<var class="pdparam">prefix</var>, </td></tr><tr><td> </td><td>const char *<var class="pdparam">interface</var>, </td></tr><tr><td> </td><td>const sd_bus_vtable *<var class="pdparam">vtable</var>, </td></tr><tr><td> </td><td>sd_bus_object_find_t <var class="pdparam">find</var>, </td></tr><tr><td> </td><td>void *<var class="pdparam">userdata</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">sd_bus_add_filter</b>(</code></td><td>sd_bus *<var class="pdparam">bus</var>, </td></tr><tr><td> </td><td>sd_bus_slot **<var class="pdparam">slot</var>, </td></tr><tr><td> </td><td>sd_bus_message_handler_t <var class="pdparam">callback</var>, </td></tr><tr><td> </td><td>void *<var class="pdparam">userdata</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div><p>
        <code class="constant">SD_BUS_VTABLE_START(<em class="replaceable"><code>flags</code></em>)</code>
      </p><p>
        <code class="constant">SD_BUS_VTABLE_END</code>
      </p><p>
        <code class="constant">SD_BUS_METHOD_WITH_ARGS_OFFSET(
        <em class="replaceable"><code>member</code></em>,
        <em class="replaceable"><code>args</code></em>,
        <em class="replaceable"><code>result</code></em>,
        <em class="replaceable"><code>handler</code></em>,
        <em class="replaceable"><code>offset</code></em>,
        <em class="replaceable"><code>flags</code></em>)
        </code>
      </p><p>
        <code class="constant">SD_BUS_METHOD_WITH_ARGS(
        <em class="replaceable"><code>member</code></em>,
        <em class="replaceable"><code>args</code></em>,
        <em class="replaceable"><code>result</code></em>,
        <em class="replaceable"><code>handler</code></em>,
        <em class="replaceable"><code>flags</code></em>)
        </code>
      </p><p>
        <code class="constant">SD_BUS_METHOD_WITH_NAMES_OFFSET(
        <em class="replaceable"><code>member</code></em>,
        <em class="replaceable"><code>signature</code></em>,
        <em class="replaceable"><code>in_names</code></em>,
        <em class="replaceable"><code>result</code></em>,
        <em class="replaceable"><code>out_names</code></em>,
        <em class="replaceable"><code>handler</code></em>,
        <em class="replaceable"><code>offset</code></em>,
        <em class="replaceable"><code>flags</code></em>)
        </code>
      </p><p>
        <code class="constant">SD_BUS_METHOD_WITH_NAMES(
        <em class="replaceable"><code>member</code></em>,
        <em class="replaceable"><code>signature</code></em>,
        <em class="replaceable"><code>in_names</code></em>,
        <em class="replaceable"><code>result</code></em>,
        <em class="replaceable"><code>out_names</code></em>,
        <em class="replaceable"><code>handler</code></em>,
        <em class="replaceable"><code>flags</code></em>)
        </code>
      </p><p>
        <code class="constant">SD_BUS_METHOD_WITH_OFFSET(
        <em class="replaceable"><code>member</code></em>,
        <em class="replaceable"><code>signature</code></em>,
        <em class="replaceable"><code>result</code></em>,
        <em class="replaceable"><code>handler</code></em>,
        <em class="replaceable"><code>offset</code></em>,
        <em class="replaceable"><code>flags</code></em>)
        </code>
      </p><p>
        <code class="constant">SD_BUS_METHOD(
        <em class="replaceable"><code>member</code></em>,
        <em class="replaceable"><code>signature</code></em>,
        <em class="replaceable"><code>result</code></em>,
        <em class="replaceable"><code>handler</code></em>,
        <em class="replaceable"><code>flags</code></em>)
        </code>
      </p><p>
        <code class="constant">SD_BUS_SIGNAL_WITH_ARGS(
        <em class="replaceable"><code>member</code></em>,
        <em class="replaceable"><code>args</code></em>,
        <em class="replaceable"><code>flags</code></em>)
        </code>
      </p><p>
        <code class="constant">SD_BUS_SIGNAL_WITH_NAMES(
        <em class="replaceable"><code>member</code></em>,
        <em class="replaceable"><code>signature</code></em>,
        <em class="replaceable"><code>names</code></em>,
        <em class="replaceable"><code>flags</code></em>)
        </code>
      </p><p>
        <code class="constant">SD_BUS_SIGNAL(
        <em class="replaceable"><code>member</code></em>,
        <em class="replaceable"><code>signature</code></em>,
        <em class="replaceable"><code>flags</code></em>)
        </code>
      </p><p>
        <code class="constant">SD_BUS_WRITABLE_PROPERTY(
        <em class="replaceable"><code>member</code></em>,
        <em class="replaceable"><code>signature</code></em>,
        <em class="replaceable"><code>get</code></em>,
        <em class="replaceable"><code>set</code></em>,
        <em class="replaceable"><code>offset</code></em>,
        <em class="replaceable"><code>flags</code></em>)
        </code>
      </p><p>
        <code class="constant">SD_BUS_PROPERTY(
        <em class="replaceable"><code>member</code></em>,
        <em class="replaceable"><code>signature</code></em>,
        <em class="replaceable"><code>get</code></em>,
        <em class="replaceable"><code>offset</code></em>,
        <em class="replaceable"><code>flags</code></em>)
        </code>
      </p><p>
        <code class="constant">SD_BUS_PARAM(<em class="replaceable"><code>name</code></em>)</code>
        <code class="constant">SD_BUS_ARGS(<em class="replaceable"><code>...</code></em>)</code>
        <code class="constant">SD_BUS_RESULT(<em class="replaceable"><code>...</code></em>)</code>
        <code class="constant">SD_BUS_NO_ARGS</code>
        <code class="constant">SD_BUS_NO_RESULT</code>
      </p></div></div><div class="refsect1"><a name="id-1.5"></a><h2 id="Description">Description<a class="headerlink" title="Permalink to this headline" href="SD_BUS_SIGNAL.html#Description">¶</a></h2><p><code class="function">sd_bus_add_object_vtable()</code> is used to declare attributes for the
    object path <em class="parameter"><code>path</code></em> connected to the bus connection
    <em class="parameter"><code>bus</code></em> under the interface <em class="parameter"><code>interface</code></em>. The table
    <em class="parameter"><code>vtable</code></em> may contain property declarations using
    <code class="constant">SD_BUS_PROPERTY()</code> or <code class="constant">SD_BUS_WRITABLE_PROPERTY()</code>,
    method declarations using <code class="constant">SD_BUS_METHOD()</code>,
    <code class="constant">SD_BUS_METHOD_WITH_NAMES()</code>,
    <code class="constant">SD_BUS_METHOD_WITH_OFFSET()</code>, or
    <code class="constant">SD_BUS_METHOD_WITH_NAMES_OFFSET()</code>, and signal declarations using
    <code class="constant">SD_BUS_SIGNAL_WITH_NAMES()</code> or <code class="constant">SD_BUS_SIGNAL()</code>, see
    below. The <em class="replaceable"><code>userdata</code></em> parameter contains a pointer that will be passed
    to various callback functions. It may be specified as <code class="constant">NULL</code> if no value is
    necessary. An interface can have any number of vtables attached to it.</p><p><code class="function">sd_bus_add_fallback_vtable()</code> is similar to
    <code class="function">sd_bus_add_object_vtable()</code>, but is used to register "fallback" attributes.
    When looking for an attribute declaration, bus object paths registered with
    <code class="function">sd_bus_add_object_vtable()</code> are checked first. If no match is found, the
    fallback vtables are checked for each prefix of the bus object path, i.e. with the last
    slash-separated components successively removed. This allows the vtable to be used for an
    arbitrary number of dynamically created objects.</p><p>Parameter <em class="replaceable"><code>find</code></em> is a function which is used to locate the target
    object based on the bus object path <em class="replaceable"><code>path</code></em>. It must return
    <code class="constant">1</code> and set the <em class="parameter"><code>ret_found</code></em> output parameter if the
    object is found, return <code class="constant">0</code> if the object was not found, and return a
    negative errno-style error code or initialize the error structure
    <em class="replaceable"><code>ret_error</code></em> on error. The pointer passed in
    <em class="parameter"><code>ret_found</code></em> will be used as the <em class="parameter"><code>userdata</code></em> parameter
    for the callback functions (offset by the <em class="parameter"><code>offset</code></em> offsets as specified in
    the vtable entries).</p><p><code class="function">sd_bus_add_object()</code> attaches a callback directly to the object path
    <em class="parameter"><code>path</code></em>. An object path can have any number of callbacks attached to it.
    Each callback is prepended to the list of callbacks which are always called in order.
    <code class="function">sd_bus_add_fallback()</code> is similar to
    <code class="function">sd_bus_add_object()</code> but applies to fallback paths instead.</p><p><code class="function">sd_bus_add_filter()</code> installs a callback that is invoked for each
    incoming D-Bus message. Filters can be used to handle logic common to all messages received by
    a service (e.g. authentication or authorization).</p><p>When a request is received, any associated callbacks are called sequentially until a
    callback returns a non-zero integer. Return zero from a callback to give other callbacks the
    chance to process the request. Callbacks are called in the following order: first, global
    callbacks installed with <code class="function">sd_bus_add_filter()</code> are called. Second, callbacks
    attached directly to the request object path are called, followed by any D-Bus method callbacks
    attached to the request object path, interface and member. Finally, the property callbacks
    attached to the request object path, interface and member are called. If the final callback
    returns zero, an error reply is sent back to the caller indicating no matching object for the
    request was found.</p><p>Note that you can return a positive integer from a <em class="parameter"><code>method</code></em> callback without
    immediately sending a reply. This informs sd-bus this callback will take responsibility for
    replying to the request without forcing the callback to produce a reply immediately. This allows
    a callback to perform any number of asynchronous operations required to construct a reply.
    However, if producing a reply takes too long, the method call will time out at the caller. This is
    only available to methods and not properties.</p><p>If a callback was invoked to handle a request that expects a reply and the callback
    returns a negative value, the value is interpreted as a negative errno-style error code and sent
    back to the caller as a D-Bus error as if
    <a href="sd_bus_reply_method_errno.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_reply_method_errno</span>(3)</span></a>
    was called. Additionally, all callbacks take a <span class="structname">sd_bus_error</span> output
    parameter that can be used to provide more detailed error information. If
    <em class="parameter"><code>ret_error</code></em> is set when the callback finishes, the corresponding D-Bus
    error is sent back to the caller as if
    <a href="sd_bus_reply_method_error.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_reply_method_error</span>(3)</span></a>
    was called. Any error stored in <em class="parameter"><code>ret_error</code></em> takes priority over any
    negative values returned by the same callback when determining which error to send back to
    the caller. Use
    <a href="sd_bus_error_set.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_error_set</span>(3)</span></a>
    or one of its variants to set <em class="parameter"><code>ret_error</code></em> and return a negative integer
    from a callback with a single function call. To send an error reply after a callback has already
    finished, use
    <a href="sd_bus_reply_method_errno.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_reply_method_errno</span>(3)</span></a>
    or one of its variants.</p><p>For all functions, a match slot is created internally. If the output parameter
    <em class="replaceable"><code>slot</code></em> is <code class="constant">NULL</code>, a "floating" slot object is
    created, see
    <a href="sd_bus_slot_set_floating.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_slot_set_floating</span>(3)</span></a>.
    Otherwise, a pointer to the slot object is returned. In that case, the reference to the slot
    object should be dropped when the vtable is not needed anymore, see
    <a href="sd_bus_slot_unref.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_slot_unref</span>(3)</span></a>.
    </p><div class="refsect2"><a name="id-1.5.11"></a><h3 id="The sd_bus_vtable array">The <span class="structname">sd_bus_vtable</span> array<a class="headerlink" title="Permalink to this headline" href="SD_BUS_SIGNAL.html#The%20sd_bus_vtable%20array">¶</a></h3><p>The array consists of the structures of type <span class="structname">sd_bus_vtable</span>, but it
      should never be filled in manually, but through one of the following macros:</p><div class="variablelist"><dl class="variablelist"><dt id="SD_BUS_VTABLE_START()"><span class="term"><code class="constant">SD_BUS_VTABLE_START()</code>, </span><span class="term"><code class="constant">SD_BUS_VTABLE_END</code></span><a class="headerlink" title="Permalink to this term" href="SD_BUS_SIGNAL.html#SD_BUS_VTABLE_START()">¶</a></dt><dd><p>Those must always be the first and last element.</p></dd><dt id="SD_BUS_METHOD_WITH_ARGS_OFFSET()"><span class="term"><code class="constant">SD_BUS_METHOD_WITH_ARGS_OFFSET()</code>, </span><span class="term"><code class="constant">SD_BUS_METHOD_WITH_ARGS()</code></span><a class="headerlink" title="Permalink to this term" href="SD_BUS_SIGNAL.html#SD_BUS_METHOD_WITH_ARGS_OFFSET()">¶</a></dt><dd><p>Declare a D-Bus method with the name <em class="replaceable"><code>member</code></em>,
          arguments <em class="replaceable"><code>args</code></em> and result <em class="replaceable"><code>result</code></em>.
          <em class="replaceable"><code>args</code></em> expects a sequence of argument type/name pairs wrapped in the
          <code class="constant">SD_BUS_ARGS()</code> macro. The elements at even indices in this list describe the
          types of the method's arguments. The method's parameter signature is the concatenation of all the
          string literals at even indices in <em class="replaceable"><code>args</code></em>. If a method has no parameters,
          pass <code class="constant">SD_BUS_NO_ARGS</code> to <em class="replaceable"><code>args</code></em>. The elements at uneven
          indices describe the names of the method's arguments. <em class="replaceable"><code>result</code></em> expects a
          sequence of type/name pairs wrapped in the <code class="constant">SD_BUS_RESULT()</code> macro in the same
          format as <code class="constant">SD_BUS_ARGS()</code>. The method's result signature is the concatenation of
          all the string literals at even indices in <em class="replaceable"><code>result</code></em>. If a method has no
          result, pass <code class="constant">SD_BUS_NO_RESULT</code> to <em class="replaceable"><code>result</code></em>. Note that
          argument types are expected to be quoted string literals and argument names are expected to be
          unquoted string literals. See below for a complete example.</p><p>The handler function <em class="replaceable"><code>handler</code></em> must be of type
          <code class="function">sd_bus_message_handler_t</code>. It will be called to handle the incoming messages
          that call this method. It receives a pointer that is the <em class="replaceable"><code>userdata</code></em>
          parameter passed to the registration function offset by <em class="replaceable"><code>offset</code></em> bytes.
          This may be used to pass pointers to different fields in the same data structure to different
          methods in the same vtable. To send a reply from <em class="parameter"><code>handler</code></em>, call
          <a href="sd_bus_reply_method_return.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_reply_method_return</span>(3)</span></a>
          with the message the callback was invoked with. Parameter <em class="replaceable"><code>flags</code></em> is a
          combination of flags, see below.</p><p><code class="constant">SD_BUS_METHOD_WITH_ARGS()</code> is a shorthand for calling
          <code class="constant">SD_BUS_METHOD_WITH_ARGS_OFFSET()</code> with an offset of zero.</p></dd><dt id="SD_BUS_METHOD_WITH_NAMES_OFFSET()"><span class="term"><code class="constant">SD_BUS_METHOD_WITH_NAMES_OFFSET()</code>, </span><span class="term"><code class="constant">SD_BUS_METHOD_WITH_NAMES()</code>, </span><span class="term"><code class="constant">SD_BUS_METHOD_WITH_OFFSET()</code>, </span><span class="term"><code class="constant">SD_BUS_METHOD()</code></span><a class="headerlink" title="Permalink to this term" href="SD_BUS_SIGNAL.html#SD_BUS_METHOD_WITH_NAMES_OFFSET()">¶</a></dt><dd><p>Declare a D-Bus method with the name <em class="replaceable"><code>member</code></em>,
          parameter signature <em class="replaceable"><code>signature</code></em>, result signature
          <em class="replaceable"><code>result</code></em>. Parameters <em class="replaceable"><code>in_names</code></em> and
          <em class="replaceable"><code>out_names</code></em> specify the argument names of the input and output
          arguments in the function signature. <em class="replaceable"><code>in_names</code></em> and
          <em class="replaceable"><code>out_names</code></em> should be created using the
          <code class="constant">SD_BUS_PARAM()</code> macro, see below. In all other regards, this macro behaves
          exactly the same as <code class="constant">SD_BUS_METHOD_WITH_ARGS_OFFSET()</code>.</p><p><code class="constant">SD_BUS_METHOD_WITH_NAMES()</code>,
          <code class="constant">SD_BUS_METHOD_WITH_OFFSET()</code>, and <code class="constant">SD_BUS_METHOD()</code>
          are variants which specify zero offset (<em class="replaceable"><code>userdata</code></em> parameter is
          passed with no change), leave the names unset (i.e. no parameter names), or both.</p><p>Prefer using <code class="constant">SD_BUS_METHOD_WITH_ARGS_OFFSET()</code> and
          <code class="constant">SD_BUS_METHOD_WITH_ARGS()</code> over these macros as they allow specifying argument
          types and names next to each other which is less error-prone than first specifying all argument
          types followed by specifying all argument names.</p></dd><dt id="SD_BUS_SIGNAL_WITH_ARGS()"><span class="term"><code class="constant">SD_BUS_SIGNAL_WITH_ARGS()</code></span><a class="headerlink" title="Permalink to this term" href="SD_BUS_SIGNAL.html#SD_BUS_SIGNAL_WITH_ARGS()">¶</a></dt><dd><p>Declare a D-Bus signal with the name <em class="replaceable"><code>member</code></em> and
          arguments <em class="replaceable"><code>args</code></em>. <em class="replaceable"><code>args</code></em> expects a sequence of
          argument type/name pairs wrapped in the <code class="constant">SD_BUS_ARGS()</code> macro. The elements at
          even indices in this list describe the types of the signal's arguments. The signal's parameter
          signature is the concatenation of all the string literals at even indices in
          <em class="replaceable"><code>args</code></em>. If a signal has no parameters, pass
          <code class="constant">SD_BUS_NO_ARGS</code> to <em class="replaceable"><code>args</code></em>. The elements at uneven
          indices describe the names of the signal's arguments. Parameter <em class="replaceable"><code>flags</code></em> is
          a combination of flags. See below for a complete example.</p></dd><dt id="SD_BUS_SIGNAL_WITH_NAMES()"><span class="term"><code class="constant">SD_BUS_SIGNAL_WITH_NAMES()</code>, </span><span class="term"><code class="constant">SD_BUS_SIGNAL()</code></span><a class="headerlink" title="Permalink to this term" href="SD_BUS_SIGNAL.html#SD_BUS_SIGNAL_WITH_NAMES()">¶</a></dt><dd><p>Declare a D-Bus signal with the name <em class="replaceable"><code>member</code></em>,
          parameter signature <em class="replaceable"><code>signature</code></em>, and argument names
          <em class="replaceable"><code>names</code></em>. <em class="replaceable"><code>names</code></em> should be
          created using the <code class="constant">SD_BUS_PARAM()</code> macro, see below.
          Parameter <em class="replaceable"><code>flags</code></em> is a combination of flags, see below.
          </p><p><code class="constant">SD_BUS_SIGNAL()</code> is equivalent to
          <code class="constant">SD_BUS_SIGNAL_WITH_NAMES()</code> with the <em class="replaceable"><code>names</code></em> parameter
          unset (i.e. no parameter names).</p><p>Prefer using <code class="constant">SD_BUS_SIGNAL_WITH_ARGS()</code> over these macros as it allows
          specifying argument types and names next to each other which is less error-prone than first
          specifying all argument types followed by specifying all argument names.</p></dd><dt id="SD_BUS_WRITABLE_PROPERTY()"><span class="term"><code class="constant">SD_BUS_WRITABLE_PROPERTY()</code>, </span><span class="term"><code class="constant">SD_BUS_PROPERTY()</code></span><a class="headerlink" title="Permalink to this term" href="SD_BUS_SIGNAL.html#SD_BUS_WRITABLE_PROPERTY()">¶</a></dt><dd><p>Declare a D-Bus property with the name <em class="replaceable"><code>member</code></em>
          and value signature <em class="replaceable"><code>signature</code></em>. Parameters
          <em class="replaceable"><code>get</code></em> and <em class="replaceable"><code>set</code></em> are the getter and
          setter methods. They are called with a pointer that is the
          <em class="replaceable"><code>userdata</code></em> parameter passed to the registration function offset
          by <em class="replaceable"><code>offset</code></em> bytes. This may be used pass pointers to different
          fields in the same data structure to different setters and getters in the same vtable.
          Parameter <em class="replaceable"><code>flags</code></em> is a combination of flags, see below.</p><p>The setter and getter methods may be omitted (specified as
          <code class="constant">NULL</code>), if the property is one of the basic types or
          "<code class="literal">as</code>" in case of read-only properties. In those cases, the
          <em class="replaceable"><code>userdata</code></em> and <em class="replaceable"><code>offset</code></em> parameters must
          together point to a valid variable of the corresponding type. A default setter and getter
          will be provided, which simply copy the argument between this variable and the message.
          </p><p><code class="constant">SD_BUS_PROPERTY()</code> is used to define a read-only property.
          </p></dd><dt id="SD_BUS_PARAM()"><span class="term"><code class="constant">SD_BUS_PARAM()</code></span><a class="headerlink" title="Permalink to this term" href="SD_BUS_SIGNAL.html#SD_BUS_PARAM()">¶</a></dt><dd><p>Parameter names should be wrapped in this macro, see the example below.
          </p></dd></dl></div></div><div class="refsect2"><a name="id-1.5.12"></a><h3 id="Flags">Flags<a class="headerlink" title="Permalink to this headline" href="SD_BUS_SIGNAL.html#Flags">¶</a></h3><p>The <em class="replaceable"><code>flags</code></em> parameter is used to specify a combination of
      <a class="ulink" href="https://dbus.freedesktop.org/doc/dbus-specification.html#introspection-format" target="_top">D-Bus annotations</a>.
      </p><div class="variablelist"><dl class="variablelist"><dt id="SD_BUS_VTABLE_DEPRECATED"><span class="term"><code class="constant">SD_BUS_VTABLE_DEPRECATED</code></span><a class="headerlink" title="Permalink to this term" href="SD_BUS_SIGNAL.html#SD_BUS_VTABLE_DEPRECATED">¶</a></dt><dd><p>Mark this vtable entry as deprecated using the
          <code class="constant">org.freedesktop.DBus.Deprecated</code> annotation in introspection data. If
          specified for <code class="constant">SD_BUS_VTABLE_START()</code>, the annotation is applied to the
          enclosing interface.</p></dd><dt id="SD_BUS_VTABLE_HIDDEN"><span class="term"><code class="constant">SD_BUS_VTABLE_HIDDEN</code></span><a class="headerlink" title="Permalink to this term" href="SD_BUS_SIGNAL.html#SD_BUS_VTABLE_HIDDEN">¶</a></dt><dd><p>Make this vtable entry hidden. It will not be shown in introspection data.
          If specified for <code class="constant">SD_BUS_VTABLE_START()</code>, all entries in the array are
          hidden.</p></dd><dt id="SD_BUS_VTABLE_UNPRIVILEGED"><span class="term"><code class="constant">SD_BUS_VTABLE_UNPRIVILEGED</code></span><a class="headerlink" title="Permalink to this term" href="SD_BUS_SIGNAL.html#SD_BUS_VTABLE_UNPRIVILEGED">¶</a></dt><dd><p>Mark this vtable entry as unprivileged. If not specified, the
          <code class="constant">org.freedesktop.systemd1.Privileged</code> annotation with value
          "<code class="literal">true</code>" will be shown in introspection data.</p></dd><dt id="SD_BUS_VTABLE_METHOD_NO_REPLY"><span class="term"><code class="constant">SD_BUS_VTABLE_METHOD_NO_REPLY</code></span><a class="headerlink" title="Permalink to this term" href="SD_BUS_SIGNAL.html#SD_BUS_VTABLE_METHOD_NO_REPLY">¶</a></dt><dd><p>Mark his vtable entry as a method that will not return a reply using the
          <code class="constant">org.freedesktop.DBus.Method.NoReply</code> annotation in introspection data.
          </p></dd><dt id="SD_BUS_VTABLE_PROPERTY_CONST"><span class="term"><code class="constant">SD_BUS_VTABLE_PROPERTY_CONST</code>, </span><span class="term"><code class="constant">SD_BUS_VTABLE_PROPERTY_EMITS_CHANGE</code>, </span><span class="term"><code class="constant">SD_BUS_VTABLE_PROPERTY_EMITS_INVALIDATION</code></span><a class="headerlink" title="Permalink to this term" href="SD_BUS_SIGNAL.html#SD_BUS_VTABLE_PROPERTY_CONST">¶</a></dt><dd><p>Those three flags correspond to different values of the
          <code class="constant">org.freedesktop.DBus.Property.EmitsChangedSignal</code> annotation, which
          specifies whether the
          <code class="constant">org.freedesktop.DBus.Properties.PropertiesChanged</code> signal is emitted
          whenever the property changes. <code class="constant">SD_BUS_VTABLE_PROPERTY_CONST</code>
          corresponds to <code class="constant">const</code> and means that the property never changes during
          the lifetime of the object it belongs to, so no signal needs to be emitted.
          <code class="constant">SD_BUS_VTABLE_PROPERTY_EMITS_CHANGE</code> corresponds to
          <code class="constant">true</code> and means that the signal is emitted.
          <code class="constant">SD_BUS_VTABLE_PROPERTY_EMITS_INVALIDATION</code> corresponds to
          <code class="constant">invalidates</code> and means that the signal is emitted, but the value is
          not included in the signal.</p></dd><dt id="SD_BUS_VTABLE_PROPERTY_EXPLICIT"><span class="term"><code class="constant">SD_BUS_VTABLE_PROPERTY_EXPLICIT</code></span><a class="headerlink" title="Permalink to this term" href="SD_BUS_SIGNAL.html#SD_BUS_VTABLE_PROPERTY_EXPLICIT">¶</a></dt><dd><p>Mark this vtable property entry as requiring explicit request to for the
          value to be shown (generally because the value is large or slow to calculate). This entry
          cannot be combined with <code class="constant">SD_BUS_VTABLE_PROPERTY_EMITS_CHANGE</code>, and will
          not be shown in property listings by default (e.g. <span class="command"><strong>busctl introspect</strong></span>).
          This corresponds to the <code class="constant">org.freedesktop.systemd1.Explicit</code> annotation
          in introspection data.</p></dd><dt id="SD_BUS_VTABLE_SENSITIVE"><span class="term"><code class="constant">SD_BUS_VTABLE_SENSITIVE</code></span><a class="headerlink" title="Permalink to this term" href="SD_BUS_SIGNAL.html#SD_BUS_VTABLE_SENSITIVE">¶</a></dt><dd><p>Mark this vtable method entry as processing sensitive data. When set,
          incoming method call messages and their outgoing reply messages are marked as sensitive using
          <a href="sd_bus_message_sensitive.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_message_sensitive</span>(3)</span></a>,
          so that they are erased from memory when freed.</p></dd><dt id="SD_BUS_VTABLE_ABSOLUTE_OFFSET"><span class="term"><code class="constant">SD_BUS_VTABLE_ABSOLUTE_OFFSET</code></span><a class="headerlink" title="Permalink to this term" href="SD_BUS_SIGNAL.html#SD_BUS_VTABLE_ABSOLUTE_OFFSET">¶</a></dt><dd><p>Mark this vtable method or property entry so that the user data pointer passed to
          its associated handler functions is determined slightly differently: instead of adding the offset
          parameter of the entry to the user data pointer specified during vtable registration, the offset is
          passed directly, converted to a pointer, without taking the user data pointer specified during
          vtable registration into account.</p></dd></dl></div></div></div><div class="refsect1"><a name="id-1.6"></a><h2 id="Examples">Examples<a class="headerlink" title="Permalink to this headline" href="SD_BUS_SIGNAL.html#Examples">¶</a></h2><div class="example"><a name="id-1.6.2"></a><p class="title"><b>Example 1. Create a simple listener on the bus</b></p><div class="example-contents"><pre class="programlisting">#include &lt;errno.h&gt;
#include &lt;stdbool.h&gt;
#include &lt;stddef.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;systemd/sd-bus.h&gt;

#define _cleanup_(f) __attribute__((cleanup(f)))

typedef struct object {
  char *name;
  uint32_t number;
} object;

static int method(sd_bus_message *m, void *userdata, sd_bus_error *error) {
  printf("Got called with userdata=%p\n", userdata);
  return 1;
}

static const sd_bus_vtable vtable[] = {
        SD_BUS_VTABLE_START(0),
        SD_BUS_METHOD(
            "Method1", "s", "s", method, 0),
        SD_BUS_METHOD_WITH_NAMES_OFFSET(
            "Method2",
            "so", SD_BUS_PARAM(string) SD_BUS_PARAM(path),
            "s", SD_BUS_PARAM(returnstring),
            method, offsetof(object, number),
            SD_BUS_VTABLE_DEPRECATED),
        SD_BUS_METHOD_WITH_ARGS_OFFSET(
            "Method3",
            SD_BUS_ARGS("s", string, "o", path),
            SD_BUS_RESULT("s", returnstring),
            method, offsetof(object, number),
            SD_BUS_VTABLE_UNPRIVILEGED),
        SD_BUS_METHOD_WITH_ARGS(
            "Method4",
            SD_BUS_NO_ARGS,
            SD_BUS_NO_RESULT,
            method,
            SD_BUS_VTABLE_UNPRIVILEGED),
        SD_BUS_SIGNAL(
            "Signal1",
            "so",
            0),
        SD_BUS_SIGNAL_WITH_NAMES(
            "Signal2",
            "so", SD_BUS_PARAM(string) SD_BUS_PARAM(path),
            0),
        SD_BUS_SIGNAL_WITH_ARGS(
            "Signal3",
            SD_BUS_ARGS("s", string, "o", path),
            0),
        SD_BUS_WRITABLE_PROPERTY(
            "AutomaticStringProperty", "s", NULL, NULL,
            offsetof(object, name),
            SD_BUS_VTABLE_PROPERTY_EMITS_CHANGE),
        SD_BUS_WRITABLE_PROPERTY(
            "AutomaticIntegerProperty", "u", NULL, NULL,
            offsetof(object, number),
            SD_BUS_VTABLE_PROPERTY_EMITS_INVALIDATION),
        SD_BUS_VTABLE_END
};

#define check(x) ({                             \
  int r = x;                                    \
  errno = r &lt; 0 ? -r : 0;                       \
  printf(#x ": %m\n");                          \
  if (r &lt; 0)                                    \
    return EXIT_FAILURE;                        \
  })

int main(int argc, char **argv) {
  _cleanup_(sd_bus_flush_close_unrefp) sd_bus *bus = NULL;

  sd_bus_default(&amp;bus);

  object object = { .number = 666 };
  check((object.name = strdup("name")) != NULL);

  check(sd_bus_add_object_vtable(bus, NULL, "/object",
                                 "org.freedesktop.systemd.VtableExample",
                                 vtable,
                                 &amp;object));

  for (;;) {
    check(sd_bus_wait(bus, UINT64_MAX));
    check(sd_bus_process(bus, NULL));
  }

  free(object.name);

  return 0;
}
</pre><p>This creates a simple client on the bus (the user bus, when run as normal user). We may
      use the D-Bus <code class="constant">org.freedesktop.DBus.Introspectable.Introspect</code> call to
      acquire the XML description of the interface:</p><pre class="programlisting">&lt;!DOCTYPE node PUBLIC "-//freedesktop//DTD D-BUS Object Introspection 1.0//EN"
"http://www.freedesktop.org/standards/dbus/1.0/introspect.dtd"&gt;
&lt;node&gt;
 &lt;interface name="org.freedesktop.DBus.Peer"&gt;
  &lt;method name="Ping"/&gt;
  &lt;method name="GetMachineId"&gt;
   &lt;arg type="s" name="machine_uuid" direction="out"/&gt;
  &lt;/method&gt;
 &lt;/interface&gt;
 &lt;interface name="org.freedesktop.DBus.Introspectable"&gt;
  &lt;method name="Introspect"&gt;
   &lt;arg name="data" type="s" direction="out"/&gt;
  &lt;/method&gt;
 &lt;/interface&gt;
 &lt;interface name="org.freedesktop.DBus.Properties"&gt;
  &lt;method name="Get"&gt;
   &lt;arg name="interface" direction="in" type="s"/&gt;
   &lt;arg name="property" direction="in" type="s"/&gt;
   &lt;arg name="value" direction="out" type="v"/&gt;
  &lt;/method&gt;
  &lt;method name="GetAll"&gt;
   &lt;arg name="interface" direction="in" type="s"/&gt;
   &lt;arg name="properties" direction="out" type="a{sv}"/&gt;
  &lt;/method&gt;
  &lt;method name="Set"&gt;
   &lt;arg name="interface" direction="in" type="s"/&gt;
   &lt;arg name="property" direction="in" type="s"/&gt;
   &lt;arg name="value" direction="in" type="v"/&gt;
  &lt;/method&gt;
  &lt;signal name="PropertiesChanged"&gt;
   &lt;arg type="s" name="interface"/&gt;
   &lt;arg type="a{sv}" name="changed_properties"/&gt;
   &lt;arg type="as" name="invalidated_properties"/&gt;
  &lt;/signal&gt;
 &lt;/interface&gt;
 &lt;interface name="org.freedesktop.systemd.VtableExample"&gt;
  &lt;method name="Method1"&gt;
   &lt;arg type="s" direction="in"/&gt;
   &lt;arg type="s" direction="out"/&gt;
  &lt;/method&gt;
  &lt;method name="Method2"&gt;
   &lt;arg type="s" name="string" direction="in"/&gt;
   &lt;arg type="o" name="path" direction="in"/&gt;
   &lt;arg type="s" name="returnstring" direction="out"/&gt;
   &lt;annotation name="org.freedesktop.DBus.Deprecated" value="true"/&gt;
  &lt;/method&gt;
  &lt;property name="AutomaticStringProperty" type="s" access="readwrite"&gt;
  &lt;/property&gt;
  &lt;property name="AutomaticIntegerProperty" type="u" access="readwrite"&gt;
   &lt;annotation name="org.freedesktop.DBus.Property.EmitsChangedSignal" value="invalidates"/&gt;
  &lt;/property&gt;
 &lt;/interface&gt;
&lt;/node&gt;

</pre></div></div><br class="example-break"></div><div class="refsect1"><a name="id-1.7"></a><h2 id="Return Value">Return Value<a class="headerlink" title="Permalink to this headline" href="SD_BUS_SIGNAL.html#Return%20Value">¶</a></h2><p>On success, <code class="function">sd_bus_add_object_vtable()</code> and
    <code class="function">sd_bus_add_fallback_vtable()</code> return a non-negative integer. On
    failure, they return a negative errno-style error code.</p><div class="refsect2"><a name="id-1.7.3"></a><h3 id="Errors">Errors<a class="headerlink" title="Permalink to this headline" href="SD_BUS_SIGNAL.html#Errors">¶</a></h3><p>Returned errors may indicate the following problems:</p><div class="variablelist"><dl class="variablelist"><dt id="-EINVAL"><span class="term"><code class="constant">-EINVAL</code></span><a class="headerlink" title="Permalink to this term" href="SD_BUS_SIGNAL.html#-EINVAL">¶</a></dt><dd><p>One of the required parameters is <code class="constant">NULL</code> or invalid. A
          reserved D-Bus interface was passed as the <em class="replaceable"><code>interface</code></em> parameter.
          </p></dd><dt id="-ENOPKG"><span class="term"><code class="constant">-ENOPKG</code></span><a class="headerlink" title="Permalink to this term" href="SD_BUS_SIGNAL.html#-ENOPKG">¶</a></dt><dd><p>The bus cannot be resolved.</p></dd><dt id="-ECHILD"><span class="term"><code class="constant">-ECHILD</code></span><a class="headerlink" title="Permalink to this term" href="SD_BUS_SIGNAL.html#-ECHILD">¶</a></dt><dd><p>The bus was created in a different process.</p></dd><dt id="-ENOMEM"><span class="term"><code class="constant">-ENOMEM</code></span><a class="headerlink" title="Permalink to this term" href="SD_BUS_SIGNAL.html#-ENOMEM">¶</a></dt><dd><p>Memory allocation failed.</p></dd><dt id="-EPROTOTYPE"><span class="term"><code class="constant">-EPROTOTYPE</code></span><a class="headerlink" title="Permalink to this term" href="SD_BUS_SIGNAL.html#-EPROTOTYPE">¶</a></dt><dd><p><code class="function">sd_bus_add_object_vtable()</code> and
          <code class="function">sd_bus_add_fallback_vtable()</code> have been both called for the same bus
          object path, which is not allowed.</p></dd><dt id="-EEXIST"><span class="term"><code class="constant">-EEXIST</code></span><a class="headerlink" title="Permalink to this term" href="SD_BUS_SIGNAL.html#-EEXIST">¶</a></dt><dd><p>This vtable has already been registered for this
          <em class="replaceable"><code>interface</code></em> and <em class="replaceable"><code>path</code></em>.
          </p></dd></dl></div></div></div><div class="refsect1"><a name="id-1.8"></a><h2 id="Notes">Notes<a class="headerlink" title="Permalink to this headline" href="SD_BUS_SIGNAL.html#Notes">¶</a></h2><p><a name="pkgconfig-text"></a>These APIs are implemented as a shared
  library, which can be compiled and linked to with the
  <code class="constant">libsystemd</code> <a href="http://linux.die.net/man/1/pkg-config"><span class="citerefentry"><span class="refentrytitle">pkg-config</span>(1)</span></a>
  file.</p></div><div class="refsect1"><a name="id-1.9"></a><h2 id="See Also">See Also<a class="headerlink" title="Permalink to this headline" href="SD_BUS_SIGNAL.html#See%20Also">¶</a></h2><p>
      <a href="sd-bus.html#"><span class="citerefentry"><span class="refentrytitle">sd-bus</span>(3)</span></a>,
      <a href="busctl.html#"><span class="citerefentry"><span class="refentrytitle">busctl</span>(1)</span></a>,
      <a href="sd_bus_emit_properties_changed.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_emit_properties_changed</span>(3)</span></a>,
      <a href="sd_bus_emit_object_added.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_emit_object_added</span>(3)</span></a>
    </p></div></div></body></html>
