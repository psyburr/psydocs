<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>org.freedesktop.home1</title><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><style>
    a.headerlink {
      color: #c60f0f;
      font-size: 0.8em;
      padding: 0 4px 0 4px;
      text-decoration: none;
      visibility: hidden;
    }

    a.headerlink:hover {
      background-color: #c60f0f;
      color: white;
    }

    h1:hover > a.headerlink, h2:hover > a.headerlink, h3:hover > a.headerlink, dt:hover > a.headerlink {
      visibility: visible;
    }
  </style><a href="index.html">Index </a>·
  <a href="systemd.directives.html">Directives </a><span style="float:right">systemd 249</span><hr><div class="refentry"><a name="org.freedesktop.home1"></a><div class="titlepage"></div><div class="refnamediv"><h2>Name</h2><p>org.freedesktop.home1 — The D-Bus interface of systemd-homed</p></div><div class="refsect1"><a name="id-1.4"></a><h2 id="Introduction">Introduction<a class="headerlink" title="Permalink to this headline" href="org.freedesktop.home1.html#Introduction">¶</a></h2><p><a href="systemd-homed.service.html#"><span class="citerefentry"><span class="refentrytitle">systemd-homed.service</span>(8)</span></a>
    is a system service which may be used to create, remove, change or inspect home areas. This page
    describes the D-Bus interface.
    </p></div><div class="refsect1"><a name="id-1.5"></a><h2 id="The Manager Object">The Manager Object<a class="headerlink" title="Permalink to this headline" href="org.freedesktop.home1.html#The%20Manager%20Object">¶</a></h2><p>The service exposes the following interfaces on the Manager object on the bus:</p><pre class="programlisting">
node /org/freedesktop/home1 {
  interface org.freedesktop.home1.Manager {
    methods:
      GetHomeByName(in  s user_name,
                    out u uid,
                    out s home_state,
                    out u gid,
                    out s real_name,
                    out s home_directory,
                    out s shell,
                    out o bus_path);
      GetHomeByUID(in  u uid,
                   out s user_name,
                   out s home_state,
                   out u gid,
                   out s real_name,
                   out s home_directory,
                   out s shell,
                   out o bus_path);
      GetUserRecordByName(in  s user_name,
                          out s user_record,
                          out b incomplete,
                          out o bus_path);
      GetUserRecordByUID(in  u uid,
                         out s user_record,
                         out b incomplete,
                         out o bus_path);
      ListHomes(out a(susussso) home_areas);
      ActivateHome(in  s user_name,
                   in  s secret);
      DeactivateHome(in  s user_name);
      RegisterHome(in  s user_record);
      UnregisterHome(in  s user_name);
      CreateHome(in  s user_record);
      RealizeHome(in  s user_name,
                  in  s secret);
      RemoveHome(in  s user_name);
      FixateHome(in  s user_name,
                 in  s secret);
      AuthenticateHome(in  s user_name,
                       in  s secret);
      UpdateHome(in  s user_record);
      ResizeHome(in  s user_name,
                 in  t size,
                 in  s secret);
      ChangePasswordHome(in  s user_name,
                         in  s new_secret,
                         in  s old_secret);
      LockHome(in  s user_name);
      UnlockHome(in  s user_name,
                 in  s secret);
      AcquireHome(in  s user_name,
                  in  s secret,
                  in  b please_suspend,
                  out h send_fd);
      RefHome(in  s user_name,
              in  b please_suspend,
              out h send_fd);
      ReleaseHome(in  s user_name);
      LockAllHomes();
      DeactivateAllHomes();
    properties:
      readonly a(sso) AutoLogin = [...];
  };
  interface org.freedesktop.DBus.Peer { ... };
  interface org.freedesktop.DBus.Introspectable { ... };
  interface org.freedesktop.DBus.Properties { ... };
};
    </pre><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="refsect2"><a name="id-1.5.31"></a><h3 id="Methods">Methods<a class="headerlink" title="Permalink to this headline" href="org.freedesktop.home1.html#Methods">¶</a></h3><p><code class="function">GetHomeByName()</code> returns basic user information (a minimal subset of the full
      user record), provided a user name. The information supplied more or less matches what
      <a href="http://man7.org/linux/man-pages/man3/getpwnam.3.html"><span class="citerefentry"><span class="refentrytitle">getpwnam</span>(3)</span></a> returns:
      the numeric UID and GID, the real name, home directory and shell. In addition it returns a state
      identifier describing the state the user's home directory is in, as well as a bus path referring to the
      bus object encapsulating the user record and home directory. This object implements the
      <code class="classname">org.freedesktop.home1.Home</code> interface documented below.</p><p><code class="function">GetHomeByUID()</code> is similar to <code class="function">GetHomeByName()</code> but
      acquires the information based on the numeric UID of the user.</p><p><code class="function">GetUserRecordByName()</code> is also similar to
      <code class="function">GetHomeByName()</code> but returns the full JSON user record data instead of the broken
      down records. An additional returned boolean indicates whether the record is complete or not. A record
      is considered complete when its "<code class="literal">privileged</code>" section is included, and incomplete if it
      was removed (see <a class="ulink" href="https://systemd.io/USER_RECORD" target="_top">JSON User Records</a> for details
      about the various sections of a user record). Generally, only privileged clients and clients running
      under the identity of the user itself get access to the "<code class="literal">privileged</code>" section and will
      thus see complete records.</p><p><code class="function">GetUserRecordByUID()</code> is similar to <code class="function">GetUserRecordByName()</code>
      but returns the user record matching the specified numeric UID.</p><p><code class="function">ListHomes()</code> returns an array of all locally managed users. The array
      contains the same fields <code class="function">GetHomeByName()</code> returns: user name, numeric UID, state,
      numeric GID, real name, home directory, shell and bus path of the matching bus object.</p><p><code class="function">ActivateHome()</code> activates (i.e. mounts) the home directory of the specified
      user. The second argument shall contain a user record consisting only of a "<code class="literal">secret</code>"
      section (all other sections should be stripped, see <a class="ulink" href="https://systemd.io/USER_RECORD" target="_top">JSON
      User Records</a> for details), and should contain only the secret credentials necessary for
      unlocking the home directory. Typically a client would invoke this function first with an entirely
      empty record (which is possibly sufficient if single-factor authentication with a plugged-in security
      token is configured), and would then retry with a record populated with more information, depending on
      the returned error code, in case more credentials are necessary. This function is synchronous and
      returns only after the home directory was fully activated (or the operation failed), which might take
      some time. Clients must be prepared for that, and typically should extend the D-Bus method call
      timeout accordingly. This method is equivalent to the <code class="function">Activate()</code> method on the
      <code class="classname">org.freedesktop.home1.Home</code> interface documented below, but may be called on the
      manager object and takes a user name as additional argument, instead.</p><p><code class="function">DeactivateHome()</code> deactivates (i.e. unmounts) the home directory of the
      specified user. It is equivalent to the <code class="function">Deactivate()</code> method on the
      <code class="classname">org.freedesktop.home1.Home</code> interface documented below.</p><p><code class="function">RegisterHome()</code> registers a new home directory locally. It receives the JSON
      user record as only argument (which typically excludes the "<code class="literal">secret</code>"
      section). Registering a home directory just makes the user record known to the system, it does not
      create a home directory or such (which is expected to exist already, or created later). This operation
      is useful to register home directories locally that are not located where
      <code class="filename">systemd-homed.service</code> would find them automatically.</p><p><code class="function">UnregisterHome()</code> unregisters an existing home directory. It takes a user
      name as argument and undoes what <code class="function">RegisterHome()</code> does. It does not attempt to
      remove the home directory itself, it just unregisters it with the local system. Note that if the home
      directory is placed where <code class="filename">systemd-homed.service</code> looks for home directories anyway
      this call will only undo fixation (see below), but the record will remain known to
      <code class="filename">systemd-homed.service</code> and be listed among known records. Since the user record is
      embedded into the home directory this operation generally does not discard data belonging to the user
      or their record. This method is equivalent to
      <code class="function">Unregister()</code> on the <code class="classname">org.freedesktop.home1.Home</code>
      interface.</p><p><code class="function">CreateHome()</code> registers and creates a new home directory. This takes a fully
      specified JSON user record as argument (including the "<code class="literal">secret</code>" section). This registers
      the user record locally and creates a home directory matching it, depending on the settings specified
      in the record in combination with local configuration.</p><p><code class="function">RealizeHome()</code> creates a home directory whose user record is already
      registered locally. This takes a user name plus a user record consisting only of the
      "<code class="literal">secret</code>" section. Invoking <code class="function">RegisterHome()</code> followed by
      <code class="function">RealizeHome()</code> is mostly equivalent to calling <code class="function">CreateHome()</code>,
      except that the latter combines the two in atomic fashion. This method is equivalent to
      <code class="function">Realize()</code> on the <code class="classname">org.freedesktop.home1.Home</code>
      interface.</p><p><code class="function">RemoveHome()</code> unregisters a user record locally, and removes the home
      directory belonging to it, if it is accessible. It takes a user name as argument. This method is equivalent to
      <code class="function">Remove()</code> on the <code class="classname">org.freedesktop.home1.Home</code>
      interface.</p><p><code class="function">FixateHome()</code> "<code class="literal">fixates</code>" an automatically discovered home
      directory. <code class="filename">systemd-homed.service</code> automatically discovers home directories dropped
      in our plugged in and adds them to the runtime list of user records it manages. A user record
      discovered that way may be "<code class="literal">fixated</code>", in which case it is copied out of the home
      directory, onto persistent storage, to fixate the UID/GID assignment of the record, and extract
      additional (typically previously encrypted) user record data from the home directory. A home directory
      mus be fixated before it can be logged into. This method call takes a user name and a JSON user record
      consisting only of the "<code class="literal">secret</code>" section as argument. This method is equivalent to
      <code class="function">Fixate()</code> on the <code class="classname">org.freedesktop.home1.Home</code> interface.</p><p><code class="function">AuthenticateHome()</code> checks passwords or other authentication credentials
      associated with the home directory. It takes a user name and a JSON user record consisting only of the
      "<code class="literal">secret</code>" section as argument. Note that many of the other method calls authenticate
      the user first, in order to execute some other operation. This method call only authenticates and
      executes no further operation. Like <code class="function">ActivateHome()</code> it is usually first invoked
      with an empty JSON user record, which is then populated for subsequent tries with additional
      authentication data supplied. This method is equivalent to
      <code class="function">Authenticate()</code> on the <code class="classname">org.freedesktop.home1.Home</code>
      interface.</p><p><code class="function">UpdateHome()</code> updates a locally registered user record. Takes a fully
      specified JSON user record as argument (including the "<code class="literal">secret</code>" section). A user with a
      matching name and realm must be registered locally already, and the last change timestamp of the newly
      supplied record must be newer than the previously existing user record. Note this operation updates the
      user record only, it does not propagate passwords/authentication tokens from the user record to the
      storage back-end, or resizes the storage back-end. Typically a home directory is first updated, and then
      the password of the underlying storage updated using <code class="function">ChangePasswordHome()</code> as well
      as the storage resized using <code class="function">ResizeHome()</code>. This method is equivalent to
      <code class="function">Update()</code> on the <code class="classname">org.freedesktop.home1.Home</code> interface.</p><p><code class="function">ResizeHome()</code> resizes the storage associated with a user record. Takes a user
      name, a disk size in bytes and a user record consisting only of the "<code class="literal">secret</code>" section
      as argument. If the size is specified as <code class="constant">UINT64_MAX</code> the storage is resized to the
      size already specified in the user record. Typically, if the user record is updated using
      <code class="function">UpdateHome()</code> above this is used to propagate the size configured there-in down to
      the underlying storage back-end. This method is equivalent to
      <code class="function">Resize()</code> on the <code class="classname">org.freedesktop.home1.Home</code>
      interface.</p><p><code class="function">ChangePasswordHome()</code> changes the passwords/authentication tokens of a home
      directory. Takes a user name, and two JSON user record objects, each consisting only of the
      "<code class="literal">secret</code>" section, for the old and for the new passwords/authentication tokens. If the
      user record with the new passwords/authentication token data is specified as empty the existing user
      record's settings are propagated down to the home directory storage. This is typically used after a
      user record is updated using <code class="function">UpdateHome()</code> in order to propagate the
      secrets/authentication tokens down to the storage. This method is equivalent to
      <code class="function">ChangePassword()</code> on the <code class="classname">org.freedesktop.home1.Home</code>
      interface.</p><p><code class="function">LockHome()</code> temporarily suspends access to a home directory, flushing out any
      cryptographic keys from memory. This is only supported on some back-ends, and usually done during system
      suspend, in order to effectively secure home directories while the system is sleeping. Takes a user
      name as single argument. If an application attempts to access a home directory while it is locked it
      will typically freeze until the home directory is unlocked again. This method is equivalent to
      <code class="function">Lock()</code> on the <code class="classname">org.freedesktop.home1.Home</code> interface.</p><p><code class="function">UnlockHome()</code> undoes the effect of <code class="function">LockHome()</code>. Takes a
      user name and a user record consisting only of the "<code class="literal">secret</code>" section as arguments. This
      method is equivalent to <code class="function">Unlock()</code> on the
      <code class="classname">org.freedesktop.home1.Home</code> interface.</p><p><code class="function">AcquireHome()</code> activates or unlocks a home directory in a reference counted
      mode of operation. Takes a user name and user record consisting only of "<code class="literal">secret</code>"
      section as argument. If the home directory is not active yet, it is activated. If it is currently
      locked it is unlocked. After completion a reference to the activation/unlocking of the home directory
      is returned via a file descriptor. When the last client which acquired such a file descriptor closes it
      the home directory is automatically deactivated again. This method is typically invoked when a user
      logs in, and the file descriptor is held until the user logs out again, thus ensuring the user's home
      directory can be unmounted automatically again in a robust fashion, when the user logs out. The third
      argument is a boolean which indicates whether the client invoking the call is able to automatically
      re-authenticate when the system comes back from suspending. It should be set by all clients that
      implement a secure lock screen running outside of the user's context, that is brought up when the
      system comes back from suspend and can be used to re-acquire the credentials to unlock the user's home
      directory. If a home directory has at least one client with an open reference to the home directory
      that does not support this it is not suspended automatically at system suspend, otherwise it is. This
      method is equivalent to <code class="function">Acquire()</code> on the
      <code class="classname">org.freedesktop.home1.Home</code> interface.</p><p><code class="function">RefHome()</code> is similar to <code class="function">AcquireHome()</code> but takes no user
      record with "<code class="literal">secret</code>" section, i.e. will take an additional reference to an already
      activated/unlocked home directory without attempting to activate/unlock it itself. It will fail if the
      home directory is not already activated. This method is equivalent to
      <code class="function">Ref()</code> on the <code class="classname">org.freedesktop.home1.Home</code>
      interface.</p><p><code class="function">ReleaseHome()</code> releases a home directory again, if all file descriptors
      referencing it are already closed, that where acquired through <code class="function">AcquireHome()</code> or
      <code class="function">RefHome()</code>. Note that this call does not actually cause the deactivation of the
      home directory (which happens automatically when the last referencing file descriptor is closed), but
      is simply a synchronization mechanism that allows delaying of the user session's termination until any
      triggered deactivation is completed. This method is equivalent to <code class="function">Release()</code> on the
      <code class="classname">org.freedesktop.home1.Home</code> interface.</p><p><code class="function">LockAllHomes()</code> locks all active home directories that only have references
      that opted into automatic suspending during system suspend. This is usually invoked automatically
      shortly before system suspend.</p><p><code class="function">DeactivateAllHomes()</code> deactivates all home areas that are currently
      active. This is usually invoked automatically shortly before system shutdown.</p></div><div class="refsect2"><a name="id-1.5.32"></a><h3 id="Properties">Properties<a class="headerlink" title="Permalink to this headline" href="org.freedesktop.home1.html#Properties">¶</a></h3><p><code class="varname">AutoLogin</code> exposes an array of structures consisting of user name, seat name
      and object path of an home directory object. All locally managed users that have the
      "<code class="literal">autoLogin</code>" field set are listed here, with the seat name they are associated with. A
      display manager may watch this property and pre-fill the login screen with the users exposed this
      way.</p></div></div><div class="refsect1"><a name="id-1.6"></a><h2 id="The Home Object">The Home Object<a class="headerlink" title="Permalink to this headline" href="org.freedesktop.home1.html#The%20Home%20Object">¶</a></h2><pre class="programlisting">
node /org/freedesktop/home1/home {
  interface org.freedesktop.home1.Home {
    methods:
      Activate(in  s secret);
      Deactivate();
      Unregister();
      Realize(in  s secret);
      Remove();
      Fixate(in  s secret);
      Authenticate(in  s secret);
      Update(in  s user_record);
      Resize(in  t size,
             in  s secret);
      ChangePassword(in  s new_secret,
                     in  s old_secret);
      Lock();
      Unlock(in  s secret);
      Acquire(in  s secret,
              in  b please_suspend,
              out h send_fd);
      Ref(in  b please_suspend,
          out h send_fd);
      Release();
    properties:
      @org.freedesktop.DBus.Property.EmitsChangedSignal("const")
      readonly s UserName = '...';
      readonly u UID = ...;
      readonly (suusss) UnixRecord = ...;
      @org.freedesktop.DBus.Property.EmitsChangedSignal("false")
      readonly s State = '...';
      @org.freedesktop.DBus.Property.EmitsChangedSignal("invalidates")
      readonly (sb) UserRecord = ...;
  };
  interface org.freedesktop.DBus.Peer { ... };
  interface org.freedesktop.DBus.Introspectable { ... };
  interface org.freedesktop.DBus.Properties { ... };
  interface org.freedesktop.DBus.ObjectManager { ... };
};
    </pre><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="variablelist"><dl class="variablelist"></dl></div><div class="refsect2"><a name="id-1.6.27"></a><h3 id="Methods1">Methods<a class="headerlink" title="Permalink to this headline" href="org.freedesktop.home1.html#Methods1">¶</a></h3><p><code class="function">Activate()</code>, <code class="function">Deactivate()</code>,
      <code class="function">Unregister()</code>, <code class="function">Realize()</code>, <code class="function">Remove()</code>,
      <code class="function">Fixate()</code>, <code class="function">Authenticate()</code>, <code class="function">Update()</code>,
      <code class="function">Resize()</code>, <code class="function">ChangePassword()</code>, <code class="function">Lock()</code>,
      <code class="function">Unlock()</code>, <code class="function">Acquire()</code>, <code class="function">Ref()</code>,
      <code class="function">Release()</code> operate like their matching counterparts on the
      <code class="classname">org.freedesktop.home1.Manager</code> interface (see above). The main difference is that
      they are methods of the home directory objects, and hence carry no additional user name
      parameter. Which of the two flavors of methods to call depends on the handles to the user known on the
      client side: if only the user name is known, it's preferable to use the methods on the manager object
      since they operate with user names only. If however the home object path was already acquired some way
      it is preferable to operate on the <code class="classname">org.freedesktop.home1.Home</code> objects
      instead.</p></div><div class="refsect2"><a name="id-1.6.28"></a><h3 id="Properties1">Properties<a class="headerlink" title="Permalink to this headline" href="org.freedesktop.home1.html#Properties1">¶</a></h3><p><code class="varname">UserName</code> contains the user name of the user account/home directory.</p><p><code class="varname">UID</code> contains the numeric UNIX UID of the user account.</p><p><code class="varname">UnixRecord</code> contains a structure encapsulating the six fields a
      <span class="structname">struct passwd</span> typically contains (the password field is suppressed).</p><p><code class="varname">State</code> exposes the current state home the home directory.</p><p><code class="varname">UserRecord</code> contains the full JSON user record string of the user account.</p></div></div><div class="refsect1"><a name="id-1.7"></a><h2 id="Versioning">Versioning<a class="headerlink" title="Permalink to this headline" href="org.freedesktop.home1.html#Versioning">¶</a></h2><p>These D-Bus interfaces follow <a class="ulink" href="http://0pointer.de/blog/projects/versioning-dbus.html" target="_top">
    the usual interface versioning guidelines</a>.</p></div><div class="refsect1"><a name="id-1.8"></a><h2 id="See Also">See Also<a class="headerlink" title="Permalink to this headline" href="org.freedesktop.home1.html#See%20Also">¶</a></h2><p>
      <a href="systemd.html#"><span class="citerefentry"><span class="refentrytitle">systemd</span>(1)</span></a>,
      <a href="systemd-homed.service.html#"><span class="citerefentry"><span class="refentrytitle">systemd-homed.service</span>(8)</span></a>,
      <a href="homectl.html#"><span class="citerefentry"><span class="refentrytitle">homectl</span>(1)</span></a>
    </p></div></div></body></html>
