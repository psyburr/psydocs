<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>sd_bus_default</title><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><style>
    a.headerlink {
      color: #c60f0f;
      font-size: 0.8em;
      padding: 0 4px 0 4px;
      text-decoration: none;
      visibility: hidden;
    }

    a.headerlink:hover {
      background-color: #c60f0f;
      color: white;
    }

    h1:hover > a.headerlink, h2:hover > a.headerlink, h3:hover > a.headerlink, dt:hover > a.headerlink {
      visibility: visible;
    }
  </style><a href="index.html">Index </a>·
  <a href="systemd.directives.html">Directives </a><span style="float:right">systemd 249</span><hr><div class="refentry"><a name="sd_bus_default"></a><div class="titlepage"></div><div class="refnamediv"><h2>Name</h2><p>sd_bus_default, sd_bus_default_user, sd_bus_default_system, sd_bus_open, sd_bus_open_with_description, sd_bus_open_user, sd_bus_open_user_with_description, sd_bus_open_user_machine, sd_bus_open_system, sd_bus_open_system_with_description, sd_bus_open_system_remote, sd_bus_open_system_machine — Acquire a connection to a system or user bus</p></div><div class="refsynopsisdiv"><h2>Synopsis</h2><div class="funcsynopsis"><pre class="funcsynopsisinfo">#include &lt;systemd/sd-bus.h&gt;</pre><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">sd_bus_default</b>(</code></td><td>sd_bus **<var class="pdparam">bus</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">sd_bus_default_user</b>(</code></td><td>sd_bus **<var class="pdparam">bus</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">sd_bus_default_system</b>(</code></td><td>sd_bus **<var class="pdparam">bus</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">sd_bus_open</b>(</code></td><td>sd_bus **<var class="pdparam">bus</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">sd_bus_open_with_description</b>(</code></td><td>sd_bus **<var class="pdparam">bus</var>, </td></tr><tr><td> </td><td>const char *<var class="pdparam">description</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">sd_bus_open_user</b>(</code></td><td>sd_bus **<var class="pdparam">bus</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">sd_bus_open_user_with_description</b>(</code></td><td>sd_bus **<var class="pdparam">bus</var>, </td></tr><tr><td> </td><td>const char *<var class="pdparam">description</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">sd_bus_open_user_machine</b>(</code></td><td>sd_bus **<var class="pdparam">bus</var>, </td></tr><tr><td> </td><td>const char *<var class="pdparam">machine</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">sd_bus_open_system</b>(</code></td><td>sd_bus **<var class="pdparam">bus</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">sd_bus_open_system_with_description</b>(</code></td><td>sd_bus **<var class="pdparam">bus</var>, </td></tr><tr><td> </td><td>const char *<var class="pdparam">description</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">sd_bus_open_system_remote</b>(</code></td><td>sd_bus **<var class="pdparam">bus</var>, </td></tr><tr><td> </td><td>const char *<var class="pdparam">host</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div><table border="0" class="funcprototype-table" summary="Function synopsis" style="cellspacing: 0; cellpadding: 0;"><tr><td><code class="funcdef">int <b class="fsfunc">sd_bus_open_system_machine</b>(</code></td><td>sd_bus **<var class="pdparam">bus</var>, </td></tr><tr><td> </td><td>const char *<var class="pdparam">machine</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div></div></div><div class="refsect1"><a name="id-1.5"></a><h2 id="Description">Description<a class="headerlink" title="Permalink to this headline" href="sd_bus_open_user_with_description.html#Description">¶</a></h2><p><code class="function">sd_bus_default()</code> acquires a bus
    connection object to the user bus when invoked in user context, or
    to the system bus otherwise. The connection object is associated
    with the calling thread. Each time the function is invoked from
    the same thread, the same object is returned, but its reference
    count is increased by one, as long as at least one reference is
    kept. When the last reference to the connection is dropped (using
    the
    <a href="sd_bus_unref.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_unref</span>(3)</span></a>
    call), the connection is terminated. Note that the connection is
    not automatically terminated when the associated thread ends. It
    is important to drop the last reference to the bus connection
    explicitly before the thread ends, as otherwise, the connection will
    leak. Also, queued but unread or unwritten messages keep the
    bus referenced, see below.</p><p><code class="function">sd_bus_default_user()</code> returns a user
    bus connection object associated with the calling thread.
    <code class="function">sd_bus_default_system()</code> is similar, but
    connects to the system bus. Note that
    <code class="function">sd_bus_default()</code> is identical to these two
    calls, depending on the execution context.</p><p><code class="function">sd_bus_open()</code> creates a new,
    independent bus connection to the user bus when invoked in user
    context, or the system bus
    otherwise. <code class="function">sd_bus_open_user()</code> is similar, but
    connects only to the user bus.
    <code class="function">sd_bus_open_system()</code> does the same, but
    connects to the system bus. In contrast to
    <code class="function">sd_bus_default()</code>,
    <code class="function">sd_bus_default_user()</code>, and
    <code class="function">sd_bus_default_system()</code>, these calls return
    new, independent connection objects that are not associated with
    the invoking thread and are not shared between multiple
    invocations. It is recommended to share connections per thread to
    efficiently make use the available resources. Thus, it is
    recommended to use <code class="function">sd_bus_default()</code>,
    <code class="function">sd_bus_default_user()</code> and
    <code class="function">sd_bus_default_system()</code> to connect to the
    user or system buses.</p><p><code class="function">sd_bus_open_with_description()</code>,
    <code class="function">sd_bus_open_user_with_description()</code>, and
    <code class="function">sd_bus_open_system_with_description()</code> are similar to
    <code class="function">sd_bus_open()</code>, <code class="function">sd_bus_open_user()</code>, and
    <code class="function">sd_bus_open_system()</code>, but allow a description string to be set, see
    <a href="sd_bus_set_description.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_set_description</span>(3)</span></a>.
    <em class="parameter"><code>description</code></em> may be <code class="constant">NULL</code>, in which case this function
    is equivalent to <code class="function">sd_bus_open()</code>. This description string is used in log
    messages about the bus object, and including a "name" for the bus makes them easier to
    understand. Some messages are emitted during bus initialization, hence using this function is
    preferable to setting the description later with
    <code class="function">sd_bus_open_with_description()</code>. The argument is copied internally and will
    not be referenced after the function returns.</p><p>If the <code class="varname">$DBUS_SESSION_BUS_ADDRESS</code> environment
    variable is set
    (cf. <a href="http://man7.org/linux/man-pages/man7/environ.7.html"><span class="citerefentry"><span class="refentrytitle">environ</span>(7)</span></a>),
    it will be used as the address of the user bus. This variable can
    contain multiple addresses separated by "<code class="literal">;</code>". If
    this variable is not set, a suitable default for the default user
    D-Bus instance will be used.</p><p>If the <code class="varname">$DBUS_SYSTEM_BUS_ADDRESS</code>
    environment variable is set, it will be used as the address of the
    system bus. This variable uses the same syntax as
    <code class="varname">$DBUS_SESSION_BUS_ADDRESS</code>. If this variable is
    not set, a suitable default for the default system D-Bus instance
    will be used.</p><p><code class="function">sd_bus_open_system_remote()</code> connects to the system bus on
    the specified host using
    <a href="http://linux.die.net/man/1/ssh"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a>.
    <em class="parameter"><code>host</code></em> consists of an optional user name followed by the
    "<code class="literal">@</code>" symbol, and the hostname, optionally followed by a
    "<code class="literal">:</code>" and a port, optionally followed by a
    "<code class="literal">/</code>" and a machine name. If the machine name is given, a connection
    is created to the system bus in the specified container on the remote machine, and
    otherwise a connection to the system bus on the specified host is created.</p><p>Note that entering a container is a privileged operation, and will likely only
    work for the root user on the remote machine.</p><p><code class="function">sd_bus_open_system_machine()</code> connects to the system bus in the specified
    <em class="parameter"><code>machine</code></em>, where <em class="parameter"><code>machine</code></em> is the name of a local container,
    possibly prefixed by a user name and a separating "<code class="literal">@</code>". If the container name is
    specified as the special string "<code class="literal">.host</code>" the connection is made to the local system. This
    is useful to connect to the local system bus as specific user, e.g. "<code class="literal">foobar@.host</code>" to
    connect to the local system bus as local user "<code class="literal">foobar</code>". If the "<code class="literal">@</code>"
    syntax is used either the left-hand side or the right-hand side may be omitted (but not both) in which
    case the local user name or "<code class="literal">.host</code>" is implied. If the "<code class="literal">@</code>" syntax is
    not used the connection is always made as root user. See
    <a href="sd_bus_set_address.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_set_address</span>(3)</span></a>
    for a description of the address syntax, and
    <a href="machinectl.html#"><span class="citerefentry"><span class="refentrytitle">machinectl</span>(1)</span></a> for more
    information about the "machine" concept. Note that connections into local containers are only available
    to privileged processes at this time.</p><p><code class="function">sd_bus_open_user_machine()</code> is similar to
    <code class="function">sd_bus_open_system_machine()</code>, but connects to the user bus of the root user, or if
    the "<code class="literal">@</code>" syntax is used, of the specified user.</p><p>These calls allocate a bus connection object and initiate
    the connection to a well-known bus of some form. An alternative to
    using these high-level calls is to create an unconnected bus
    object with
    <a href="sd_bus_new.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_new</span>(3)</span></a>
    and to connect it with
    <a href="sd_bus_start.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_start</span>(3)</span></a>.
    </p></div><div class="refsect1"><a name="id-1.6"></a><h2 id="Reference ownership">Reference ownership<a class="headerlink" title="Permalink to this headline" href="sd_bus_open_user_with_description.html#Reference%20ownership">¶</a></h2><p>The functions <code class="function">sd_bus_open()</code>,
    <code class="function">sd_bus_open_user()</code>,
    <code class="function">sd_bus_open_user_machine()</code>,
    <code class="function">sd_bus_open_system()</code>,
    <code class="function">sd_bus_open_system_remote()</code>, and
    <code class="function">sd_bus_open_system_machine()</code> return a new
    connection object and the caller owns the sole reference. When not
    needed anymore, this reference should be destroyed with
    <a href="sd_bus_unref.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_unref</span>(3)</span></a>.
    </p><p>The functions <code class="function">sd_bus_default()</code>,
    <code class="function">sd_bus_default_user()</code> and
    <code class="function">sd_bus_default_system()</code> do not necessarily
    create a new object, but increase the connection reference of an
    existing connection object by one. Use
    <a href="sd_bus_unref.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_unref</span>(3)</span></a>
    to drop the reference.</p><p>Queued but unwritten/unread messages keep a reference to their bus connection object. For this reason, even
    if an application dropped all references to a bus connection, it might not get destroyed right away. Until all
    incoming queued messages are read, and until all outgoing unwritten messages are written, the bus object will stay
    alive. <code class="function">sd_bus_flush()</code> may be used to write all outgoing queued messages so they drop their
    references. To flush the unread incoming messages, use <code class="function">sd_bus_close()</code>, which will also close
    the bus connection. When using the default bus logic, it is a good idea to first invoke
    <code class="function">sd_bus_flush()</code> followed by <code class="function">sd_bus_close()</code> when a thread or process
    terminates, and thus its bus connection object should be freed.</p><p>Normally, slot objects (as created by
    <a href="sd_bus_add_match.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_add_match</span>(3)</span></a> and similar
    calls) keep a reference to their bus connection object, too. Thus, as long as a bus slot object remains referenced
    its bus object will remain allocated too. Optionally, bus slot objects may be placed in "floating" mode. When in
    floating mode the life cycle of the bus slot object is bound to the bus object, i.e. when the bus object is freed
    the bus slot object is automatically unreferenced too. The floating state of a slot object may be controlled
    explicitly with
    <a href="sd_bus_slot_set_floating.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_slot_set_floating</span>(3)</span></a>,
    though usually floating bus slot objects are created by passing <code class="constant">NULL</code> as the
    <em class="parameter"><code>slot</code></em> parameter of <code class="function">sd_bus_add_match()</code> and related calls, thus indicating
    that the caller is not directly interested in referencing and managing the bus slot object.</p><p>The life cycle of the default bus connection should be the
    responsibility of the code that creates/owns the thread the
    default bus connection object is associated with. Library code
    should neither call <code class="function">sd_bus_flush()</code> nor
    <code class="function">sd_bus_close()</code> on default bus objects unless
    it does so in its own private, self-allocated thread. Library code
    should not use the default bus object in other threads unless it
    is clear that the program using it will life cycle the bus
    connection object and flush and close it before exiting from the
    thread. In libraries where it is not clear that the calling
    program will life cycle the bus connection object, it is hence
    recommended to use <code class="function">sd_bus_open_system()</code>
    instead of <code class="function">sd_bus_default_system()</code> and
    related calls.</p></div><div class="refsect1"><a name="id-1.7"></a><h2 id="Return Value">Return Value<a class="headerlink" title="Permalink to this headline" href="sd_bus_open_user_with_description.html#Return%20Value">¶</a></h2><p>On success, these calls return 0 or a positive
    integer. On failure, these calls return a negative
    errno-style error code.</p><div class="refsect2"><a name="id-1.7.3"></a><h3 id="Errors">Errors<a class="headerlink" title="Permalink to this headline" href="sd_bus_open_user_with_description.html#Errors">¶</a></h3><p>Returned errors may indicate the following problems:</p><div class="variablelist"><dl class="variablelist"><dt id="-EINVAL"><span class="term"><code class="constant">-EINVAL</code></span><a class="headerlink" title="Permalink to this term" href="sd_bus_open_user_with_description.html#-EINVAL">¶</a></dt><dd><p>The specified parameters are invalid.</p></dd><dt id="-ENOMEDIUM"><span class="term"><code class="constant">-ENOMEDIUM</code></span><a class="headerlink" title="Permalink to this term" href="sd_bus_open_user_with_description.html#-ENOMEDIUM">¶</a></dt><dd><p>The requested bus type is not available because of invalid environment (for example
          the user session bus is not available because <code class="varname">$XDG_RUNTIME_DIR</code> is not set).
          </p></dd><dt id="-ENOMEM"><span class="term"><code class="constant">-ENOMEM</code></span><a class="headerlink" title="Permalink to this term" href="sd_bus_open_user_with_description.html#-ENOMEM">¶</a></dt><dd><p>Memory allocation failed.</p></dd><dt id="-ESOCKTNOSUPPORT"><span class="term"><code class="constant">-ESOCKTNOSUPPORT</code></span><a class="headerlink" title="Permalink to this term" href="sd_bus_open_user_with_description.html#-ESOCKTNOSUPPORT">¶</a></dt><dd><p>The protocol version required to connect to the selected bus is not
          supported.</p></dd></dl></div><p>In addition, other connection-related errors may be returned. See
      <a href="sd_bus_send.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_send</span>(3)</span></a>.</p></div></div><div class="refsect1"><a name="id-1.8"></a><h2 id="Notes">Notes<a class="headerlink" title="Permalink to this headline" href="sd_bus_open_user_with_description.html#Notes">¶</a></h2><p><a name="pkgconfig-text"></a>These APIs are implemented as a shared
  library, which can be compiled and linked to with the
  <code class="constant">libsystemd</code> <a href="http://linux.die.net/man/1/pkg-config"><span class="citerefentry"><span class="refentrytitle">pkg-config</span>(1)</span></a>
  file.</p></div><div class="refsect1"><a name="id-1.9"></a><h2 id="See Also">See Also<a class="headerlink" title="Permalink to this headline" href="sd_bus_open_user_with_description.html#See%20Also">¶</a></h2><p>
      <a href="systemd.html#"><span class="citerefentry"><span class="refentrytitle">systemd</span>(1)</span></a>,
      <a href="sd-bus.html#"><span class="citerefentry"><span class="refentrytitle">sd-bus</span>(3)</span></a>,
      <a href="sd_bus_new.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_new</span>(3)</span></a>,
      <a href="sd_bus_ref.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_ref</span>(3)</span></a>,
      <a href="sd_bus_unref.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_unref</span>(3)</span></a>,
      <a href="sd_bus_close.html#"><span class="citerefentry"><span class="refentrytitle">sd_bus_close</span>(3)</span></a>,
      <a href="http://linux.die.net/man/1/ssh"><span class="citerefentry"><span class="refentrytitle">ssh</span>(1)</span></a>,
      <a href="systemd-machined.service.html#"><span class="citerefentry"><span class="refentrytitle">systemd-machined.service</span>(8)</span></a>,
      <a href="machinectl.html#"><span class="citerefentry"><span class="refentrytitle">machinectl</span>(1)</span></a>
    </p></div></div></body></html>
